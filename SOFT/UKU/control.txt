; generated by ARM C/C++ Compiler, 4.1 [Build 644]
; commandline ArmCC [--list --debug -c --asm --interleave -o.\EXE\control.o --asm_dir=.\ --list_dir=.\ --depend=.\EXE\control.d --feedback=.\EXE\UKU2071x_GALV_IBv2.fed --cpu=Cortex-M3 --apcs=interwork -O3 -IC:\Keil\ARM\CMSIS\Include -IC:\Keil\ARM\INC\NXP\LPC17xx -D__MICROLIB -DUKU2071x -DEXT_BOARD_V_2 --omf_browse=.\EXE\control.crf control.c]
                          THUMB

                          AREA ||.text||, CODE, READONLY, ALIGN=2

                  kb_init PROC
;;;218    //-----------------------------------------------
;;;219    void kb_init(void)
000000  4805              LDR      r0,|L1.24|
;;;220    {
;;;221    main_kb_cnt=(TBAT*60)-60/*120*/;
000002  f06f013b          MVN      r1,#0x3b
000006  8800              LDRH     r0,[r0,#0]  ; TBAT
000008  ebc01000          RSB      r0,r0,r0,LSL #4
00000c  eb010080          ADD      r0,r1,r0,LSL #2
000010  4902              LDR      r1,|L1.28|
000012  8448              STRH     r0,[r1,#0x22]
;;;222    }
000014  4770              BX       lr
;;;223    
                          ENDP

000016  0000              DCW      0x0000
                  |L1.24|
                          DCD      TBAT
                  |L1.28|
                          DCD      ||area_number.24||

                          AREA ||area_number.2||, CODE, READONLY, ALIGN=2

                          EXPORTAS ||area_number.2||, ||.text||
                  samokalibr_init PROC
;;;218    //-----------------------------------------------
;;;219    void kb_init(void)
000000  4902              LDR      r1,|L2.12|
;;;220    {
;;;221    main_kb_cnt=(TBAT*60)-60/*120*/;
000002  f24060f9          MOV      r0,#0x6f9
000006  8408              STRH     r0,[r1,#0x20]
000008  4770              BX       lr
;;;222    }
;;;223    
                          ENDP

00000a  0000              DCW      0x0000
                  |L2.12|
                          DCD      ||area_number.24||

                          AREA ||area_number.3||, CODE, READONLY, ALIGN=2

                          EXPORTAS ||area_number.3||, ||.text||
                  samokalibr_hndl PROC
;;;218    //-----------------------------------------------
;;;219    void kb_init(void)
000000  b510              PUSH     {r4,lr}
;;;220    {
;;;221    main_kb_cnt=(TBAT*60)-60/*120*/;
000002  4c1a              LDR      r4,|L3.108|
000004  8c20              LDRH     r0,[r4,#0x20]  ; samokalibr_cnt
000006  1c40              ADDS     r0,r0,#1
000008  b200              SXTH     r0,r0
00000a  8420              STRH     r0,[r4,#0x20]
00000c  f5b06fe1          CMP      r0,#0x708
000010  db02              BLT      |L3.24|
000012  2000              MOVS     r0,#0
;;;222    }
000014  8420              STRH     r0,[r4,#0x20]
                  |L3.22|
000016  bd10              POP      {r4,pc}
                  |L3.24|
000018  f5b06fdf          CMP      r0,#0x6f8
00001c  d911              BLS      |L3.66|
00001e  230f              MOVS     r3,#0xf
000020  2201              MOVS     r2,#1
000022  2164              MOVS     r1,#0x64
000024  20d2              MOVS     r0,#0xd2
000026  f7fffffe          BL       mess_send
00002a  230f              MOVS     r3,#0xf
00002c  2200              MOVS     r2,#0
00002e  21d8              MOVS     r1,#0xd8
000030  20d7              MOVS     r0,#0xd7
000032  f7fffffe          BL       mess_send
000036  230f              MOVS     r3,#0xf
000038  2200              MOVS     r2,#0
00003a  21d8              MOVS     r1,#0xd8
00003c  20dc              MOVS     r0,#0xdc
00003e  f7fffffe          BL       mess_send
                  |L3.66|
000042  f9b40020          LDRSH    r0,[r4,#0x20]  ; samokalibr_cnt
000046  f5a061e0          SUB      r1,r0,#0x700
00004a  3907              SUBS     r1,#7
00004c  d1e3              BNE      |L3.22|
00004e  4808              LDR      r0,|L3.112|
000050  4a08              LDR      r2,|L3.116|
000052  8801              LDRH     r1,[r0,#0]  ; ad7705_buff_
000054  f9b22000          LDRSH    r2,[r2,#0]  ; Kiload0
000058  4291              CMP      r1,r2
00005a  d0dc              BEQ      |L3.22|
00005c  f9b01000          LDRSH    r1,[r0,#0]  ; ad7705_buff_
000060  e8bd4010          POP      {r4,lr}
000064  2014              MOVS     r0,#0x14
000066  f7ffbffe          B.W      lc640_write_int
;;;223    
                          ENDP

00006a  0000              DCW      0x0000
                  |L3.108|
                          DCD      ||area_number.24||
                  |L3.112|
                          DCD      ad7705_buff_
                  |L3.116|
                          DCD      Kiload0

                          AREA ||area_number.4||, CODE, READONLY, ALIGN=2

                          EXPORTAS ||area_number.4||, ||.text||
                  unet_drv PROC
;;;218    //-----------------------------------------------
;;;219    void kb_init(void)
000000  4aff              LDR      r2,|L4.1024|
;;;220    {
;;;221    main_kb_cnt=(TBAT*60)-60/*120*/;
000002  b430              PUSH     {r4,r5}
000004  49ff              LDR      r1,|L4.1028|
000006  f9b2400a          LDRSH    r4,[r2,#0xa]  ; adc_buff_
00000a  f64053ac          MOV      r3,#0xdac
00000e  f9b10000          LDRSH    r0,[r1,#0]
000012  429c              CMP      r4,r3
;;;222    }
000014  dc03              BGT      |L4.30|
000016  f9b22014          LDRSH    r2,[r2,#0x14]  ; adc_buff_
00001a  429a              CMP      r2,r3
00001c  dd03              BLE      |L4.38|
                  |L4.30|
00001e  2814              CMP      r0,#0x14
000020  da04              BGE      |L4.44|
000022  1c40              ADDS     r0,r0,#1
000024  e001              B        |L4.42|
                  |L4.38|
000026  b108              CBZ      r0,|L4.44|
000028  1e40              SUBS     r0,r0,#1
                  |L4.42|
00002a  8008              STRH     r0,[r1,#0]
                  |L4.44|
00002c  2214              MOVS     r2,#0x14
00002e  bc30              POP      {r4,r5}
000030  2100              MOVS     r1,#0
000032  48f4              LDR      r0,|L4.1028|
000034  f7ffbffe          B.W      gran
;;;223    
                          ENDP

                  matemat PROC
;;;234    //-----------------------------------------------
;;;235    void samokalibr_hndl(void)
;;;236    {
;;;237    if(++samokalibr_cnt>=1800)samokalibr_cnt=0;
;;;238    
;;;239    if(samokalibr_cnt>=1785U)
;;;240    	{
;;;241    	mess_send(MESS2RELE_HNDL,PARAM_RELE_SAMOKALIBR,1,15);
;;;242    	mess_send(MESS2IND_HNDL,PARAM_SAMOKALIBR,0,15);
;;;243    	mess_send(MESS2MATEMAT,PARAM_SAMOKALIBR,0,15);
000038  b5f0              PUSH     {r4-r7,lr}
00003a  48f1              LDR      r0,|L4.1024|
00003c  49f2              LDR      r1,|L4.1032|
00003e  f44f72fa          MOV      r2,#0x1f4
;;;244    	} 
;;;245    
;;;246    if(samokalibr_cnt==1799U)
000042  f9b00000          LDRSH    r0,[r0,#0]  ; adc_buff_
000046  f9b11000          LDRSH    r1,[r1,#0]  ; Kuload
00004a  4bf0              LDR      r3,|L4.1036|
00004c  4348              MULS     r0,r1,r0
;;;247    	{
;;;248    	if(Kiload0!=ad7705_buff_[0]) lc640_write_int(EE_KILOAD0,ad7705_buff_[0]);
00004e  fb90f0f2          SDIV     r0,r0,r2
000052  8018              STRH     r0,[r3,#0]
000054  48ea              LDR      r0,|L4.1024|
000056  f2413388          MOV      r3,#0x1388
00005a  3020              ADDS     r0,r0,#0x20
00005c  f9b00000          LDRSH    r0,[r0,#0]  ; adc_buff__
000060  4348              MULS     r0,r1,r0
000062  fb90f0f2          SDIV     r0,r0,r2
000066  49ea              LDR      r1,|L4.1040|
000068  4aed              LDR      r2,|L4.1056|
00006a  8008              STRH     r0,[r1,#0]
00006c  49ea              LDR      r1,|L4.1048|
00006e  48e9              LDR      r0,|L4.1044|
000070  f9b14000          LDRSH    r4,[r1,#0]  ; Kiload0
000074  49e9              LDR      r1,|L4.1052|
000076  8800              LDRH     r0,[r0,#0]  ; ad7705_buff_
000078  f9b11000          LDRSH    r1,[r1,#0]  ; Kiload1
00007c  1b00              SUBS     r0,r0,r4
00007e  4348              MULS     r0,r1,r0
000080  fb90f0f3          SDIV     r0,r0,r3
000084  8010              STRH     r0,[r2,#0]
000086  1b00              SUBS     r0,r0,r4
000088  4348              MULS     r0,r1,r0
00008a  fb90f0f3          SDIV     r0,r0,r3
00008e  49e5              LDR      r1,|L4.1060|
000090  4be7              LDR      r3,|L4.1072|
000092  8008              STRH     r0,[r1,#0]
000094  48e4              LDR      r0,|L4.1064|
000096  8801              LDRH     r1,[r0,#0]  ; I_LOAD_MODE
000098  48e4              LDR      r0,|L4.1068|
00009a  f9b04000          LDRSH    r4,[r0,#0]
00009e  b981              CBNZ     r1,|L4.194|
0000a0  2100              MOVS     r1,#0
0000a2  4608              MOV      r0,r1
0000a4  e00a              B        |L4.188|
0000a6  bf00              NOP      
                  |L4.168|
0000a8  ebc005c0          RSB      r5,r0,r0,LSL #3
0000ac  eb050545          ADD      r5,r5,r5,LSL #1
0000b0  eb030585          ADD      r5,r3,r5,LSL #2
0000b4  1c40              ADDS     r0,r0,#1
0000b6  6a2d              LDR      r5,[r5,#0x20]
0000b8  b2c0              UXTB     r0,r0
0000ba  4429              ADD      r1,r1,r5
                  |L4.188|
0000bc  42a0              CMP      r0,r4
0000be  dbf3              BLT      |L4.168|
0000c0  8011              STRH     r1,[r2,#0]
                  |L4.194|
0000c2  f9b20000          LDRSH    r0,[r2,#0]  ; load_I
0000c6  2100              MOVS     r1,#0
0000c8  2800              CMP      r0,#0
0000ca  da00              BGE      |L4.206|
0000cc  8011              STRH     r1,[r2,#0]
                  |L4.206|
0000ce  2200              MOVS     r2,#0
                  |L4.208|
0000d0  ebc200c2          RSB      r0,r2,r2,LSL #3
0000d4  eb000040          ADD      r0,r0,r0,LSL #1
0000d8  eb030080          ADD      r0,r3,r0,LSL #2
0000dc  78c5              LDRB     r5,[r0,#3]
0000de  2d19              CMP      r5,#0x19
0000e0  d21b              BCS      |L4.282|
0000e2  7985              LDRB     r5,[r0,#6]
0000e4  79c6              LDRB     r6,[r0,#7]
0000e6  eb052606          ADD      r6,r5,r6,LSL #8
0000ea  6206              STR      r6,[r0,#0x20]
0000ec  7a06              LDRB     r6,[r0,#8]
0000ee  7a47              LDRB     r7,[r0,#9]
0000f0  eb062607          ADD      r6,r6,r7,LSL #8
0000f4  61c6              STR      r6,[r0,#0x1c]
0000f6  7a86              LDRB     r6,[r0,#0xa]
0000f8  7ac7              LDRB     r7,[r0,#0xb]
0000fa  eb062607          ADD      r6,r6,r7,LSL #8
0000fe  6186              STR      r6,[r0,#0x18]
000100  7b06              LDRB     r6,[r0,#0xc]
000102  6246              STR      r6,[r0,#0x24]
000104  f880504e          STRB     r5,[r0,#0x4e]
000108  7b85              LDRB     r5,[r0,#0xe]
00010a  f880503e          STRB     r5,[r0,#0x3e]
00010e  7c05              LDRB     r5,[r0,#0x10]
000110  7c46              LDRB     r6,[r0,#0x11]
000112  eb052506          ADD      r5,r5,r6,LSL #8
000116  6485              STR      r5,[r0,#0x48]
000118  e006              B        |L4.296|
                  |L4.282|
00011a  6181              STR      r1,[r0,#0x18]
00011c  6201              STR      r1,[r0,#0x20]
00011e  61c1              STR      r1,[r0,#0x1c]
000120  6241              STR      r1,[r0,#0x24]
000122  f880103e          STRB     r1,[r0,#0x3e]
000126  6481              STR      r1,[r0,#0x48]
                  |L4.296|
000128  1c52              ADDS     r2,r2,#1
00012a  b2d2              UXTB     r2,r2
00012c  2a20              CMP      r2,#0x20
00012e  d3cf              BCC      |L4.208|
000130  48c0              LDR      r0,|L4.1076|
000132  49c1              LDR      r1,|L4.1080|
000134  8800              LDRH     r0,[r0,#0]  ; I_MAX
000136  4360              MULS     r0,r4,r0
000138  8008              STRH     r0,[r1,#0]
00013a  48c0              LDR      r0,|L4.1084|
00013c  49c0              LDR      r1,|L4.1088|
00013e  8800              LDRH     r0,[r0,#0]  ; I_MIN
000140  4360              MULS     r0,r4,r0
000142  8008              STRH     r0,[r1,#0]
000144  bdf0              POP      {r4-r7,pc}
;;;249    	}	 	
;;;250    }
;;;251    
                          ENDP

                  adc_init PROC
;;;350    //-----------------------------------------------
;;;351    void adc_init(void)
000146  48bf              LDR      r0,|L4.1092|
;;;352    {
;;;353    
;;;354    SET_REG(LPC_PINCON->PINSEL1,1,(25-16)*2,2);
000148  6841              LDR      r1,[r0,#4]
00014a  f4212140          BIC      r1,r1,#0xc0000
00014e  f4412180          ORR      r1,r1,#0x40000
000152  6041              STR      r1,[r0,#4]
;;;355    SET_REG(LPC_PINCON->PINSEL1,1,(24-16)*2,2);
000154  6841              LDR      r1,[r0,#4]
000156  f4213140          BIC      r1,r1,#0x30000
00015a  f4413180          ORR      r1,r1,#0x10000
00015e  6041              STR      r1,[r0,#4]
;;;356    SET_REG(LPC_PINCON->PINSEL1,1,(23-16)*2,2);
000160  6841              LDR      r1,[r0,#4]
000162  f4214140          BIC      r1,r1,#0xc000
000166  f4414180          ORR      r1,r1,#0x4000
00016a  6041              STR      r1,[r0,#4]
;;;357    
;;;358    
;;;359    SET_REG(LPC_PINCON->PINMODE1,2,(25-16)*2,2);
00016c  6c41              LDR      r1,[r0,#0x44]
00016e  f4212140          BIC      r1,r1,#0xc0000
000172  f4412100          ORR      r1,r1,#0x80000
000176  6441              STR      r1,[r0,#0x44]
;;;360    SET_REG(LPC_PINCON->PINMODE1,2,(24-16)*2,2);
000178  6c41              LDR      r1,[r0,#0x44]
00017a  f4213140          BIC      r1,r1,#0x30000
00017e  f4413100          ORR      r1,r1,#0x20000
000182  6441              STR      r1,[r0,#0x44]
;;;361    SET_REG(LPC_PINCON->PINMODE1,2,(23-16)*2,2);
000184  6c41              LDR      r1,[r0,#0x44]
000186  f4214140          BIC      r1,r1,#0xc000
00018a  f4414100          ORR      r1,r1,#0x8000
00018e  6441              STR      r1,[r0,#0x44]
;;;362    
;;;363    SET_REG(LPC_ADC->ADCR,0,24,3);
000190  48ad              LDR      r0,|L4.1096|
000192  6801              LDR      r1,[r0,#0]
000194  f02161e0          BIC      r1,r1,#0x7000000
000198  6001              STR      r1,[r0,#0]
;;;364    
;;;365    SET_REG(LPC_ADC->ADCR,1,21,1);
00019a  6801              LDR      r1,[r0,#0]
00019c  f4411100          ORR      r1,r1,#0x200000
0001a0  6001              STR      r1,[r0,#0]
;;;366    SET_REG(LPC_ADC->ADCR,0,16,1);
0001a2  6801              LDR      r1,[r0,#0]
0001a4  f4213180          BIC      r1,r1,#0x10000
0001a8  6001              STR      r1,[r0,#0]
;;;367    SET_REG(LPC_ADC->ADCR,1,8,8);
0001aa  6801              LDR      r1,[r0,#0]
0001ac  f421417f          BIC      r1,r1,#0xff00
0001b0  f4417180          ORR      r1,r1,#0x100
0001b4  6001              STR      r1,[r0,#0]
;;;368    
;;;369    //SET_REG(LPC_GPIO0->FIODIR,7,5,3);
;;;370    //SET_REG(LPC_GPIO0->FIOPIN,4,5,3);
;;;371    	
;;;372    	/*if(adc_ch<=7)*///SET_REG(LPC_ADC->ADCR,1<<5,0,8);
;;;373         /*else if(adc_ch==8) SET_REG(LPC_ADC->ADCR,1<<2,0,8);
;;;374         else SET_REG(LPC_ADC->ADCR,1<<4,0,8);*/
;;;375    
;;;376    LPC_ADC->ADINTEN     =  (1<< 8);      /* global enable interrupt            */
0001b6  1581              ASRS     r1,r0,#22
0001b8  60c1              STR      r1,[r0,#0xc]
0001ba  48a4              LDR      r0,|L4.1100|
0001bc  0389              LSLS     r1,r1,#14
0001be  6001              STR      r1,[r0,#0]
;;;377    
;;;378    NVIC_EnableIRQ(ADC_IRQn);             /* enable ADC Interrupt               */
;;;379    
;;;380    
;;;381    }
0001c0  4770              BX       lr
;;;382    
                          ENDP

                  adc_drv7 PROC
;;;383    //-----------------------------------------------
;;;384    void adc_drv7(void) //(Uсети - постоянка)
0001c2  e92d41f0          PUSH     {r4-r8,lr}
;;;385    {
;;;386    //int temp_S;
;;;387    //char i;
;;;388    //signed short temp_SS;
;;;389    
;;;390    adc_self_ch_disp[0]=abs_pal(adc_self_ch_buff[1]-adc_self_ch_buff[0]);//adc_self_ch_buff[0]&0x0f80;
0001c6  4ca2              LDR      r4,|L4.1104|
0001c8  8860              LDRH     r0,[r4,#2]  ; adc_self_ch_buff
0001ca  8821              LDRH     r1,[r4,#0]  ; adc_self_ch_buff
0001cc  1a40              SUBS     r0,r0,r1
0001ce  b200              SXTH     r0,r0
0001d0  f7fffffe          BL       abs_pal
0001d4  1da5              ADDS     r5,r4,#6
0001d6  8028              STRH     r0,[r5,#0]
;;;391    adc_self_ch_disp[1]=abs_pal(adc_self_ch_buff[2]-adc_self_ch_buff[1]);//adc_self_ch_buff[1]&0x0f80;
0001d8  88a0              LDRH     r0,[r4,#4]  ; adc_self_ch_buff
0001da  8861              LDRH     r1,[r4,#2]  ; adc_self_ch_buff
0001dc  1a40              SUBS     r0,r0,r1
0001de  b200              SXTH     r0,r0
0001e0  f7fffffe          BL       abs_pal
0001e4  8068              STRH     r0,[r5,#2]
;;;392    adc_self_ch_disp[2]=abs_pal(adc_self_ch_buff[2]-adc_self_ch_buff[0]);//adc_self_ch_buff[2]&0x0f80;
0001e6  88a0              LDRH     r0,[r4,#4]  ; adc_self_ch_buff
0001e8  8821              LDRH     r1,[r4,#0]  ; adc_self_ch_buff
0001ea  1a40              SUBS     r0,r0,r1
0001ec  b200              SXTH     r0,r0
0001ee  f7fffffe          BL       abs_pal
;;;393    
;;;394    //adc_self_ch_disp[0]=adc_self_ch_buff[0]&0x0ff0;
;;;395    //adc_self_ch_disp[1]=adc_self_ch_buff[1]&0x0ff0;
;;;396    //adc_self_ch_disp[2]=adc_self_ch_buff[2]&0x0ff0;
;;;397    
;;;398    
;;;399    if(adc_self_ch_disp[2]<300)//==adc_self_ch_disp[2])
0001f2  f44f7296          MOV      r2,#0x12c
0001f6  80a8              STRH     r0,[r5,#4]            ;392
;;;400    	{
;;;401    	adc_result=adc_self_ch_buff[2];
0001f8  f1a4012c          SUB      r1,r4,#0x2c
0001fc  4290              CMP      r0,r2                 ;399
0001fe  da01              BGE      |L4.516|
000200  88a0              LDRH     r0,[r4,#4]  ; adc_self_ch_buff
000202  e00a              B        |L4.538|
                  |L4.516|
;;;402    	} 
;;;403    else if(adc_self_ch_disp[1]<300)//==adc_self_ch_disp[2])
000204  f9b50002          LDRSH    r0,[r5,#2]  ; adc_self_ch_disp
000208  4290              CMP      r0,r2
00020a  da01              BGE      |L4.528|
;;;404    	{
;;;405    	adc_result=adc_self_ch_buff[1];
00020c  8860              LDRH     r0,[r4,#2]  ; adc_self_ch_buff
00020e  e004              B        |L4.538|
                  |L4.528|
;;;406    	}
;;;407    else if(adc_self_ch_disp[0]<300)//==adc_self_ch_disp[1])
000210  f9b50000          LDRSH    r0,[r5,#0]  ; adc_self_ch_disp
000214  4290              CMP      r0,r2
000216  da01              BGE      |L4.540|
;;;408    	{
;;;409    	adc_result=adc_self_ch_buff[0];
000218  8820              LDRH     r0,[r4,#0]  ; adc_self_ch_buff
                  |L4.538|
00021a  82c8              STRH     r0,[r1,#0x16]
                  |L4.540|
;;;410    	}
;;;411        //adc_result=92;
;;;412    
;;;413    if(adc_ch_net)
00021c  784c              LDRB     r4,[r1,#1]  ; adc_ch_net
00021e  2300              MOVS     r3,#0
000220  b31c              CBZ      r4,|L4.618|
;;;414    	{
;;;415    
;;;416    	main_power_buffer[0]+=(long)(adc_result);
000222  4877              LDR      r0,|L4.1024|
000224  f9b12016          LDRSH    r2,[r1,#0x16]  ; adc_result
000228  3040              ADDS     r0,r0,#0x40
00022a  6805              LDR      r5,[r0,#0]  ; main_power_buffer
00022c  4415              ADD      r5,r5,r2
;;;417    	main_power_buffer[1]+=(long)(adc_result);
00022e  6005              STR      r5,[r0,#0]  ; main_power_buffer
000230  6845              LDR      r5,[r0,#4]  ; main_power_buffer
000232  4415              ADD      r5,r5,r2
;;;418    	main_power_buffer[2]+=(long)(adc_result);
000234  6045              STR      r5,[r0,#4]  ; main_power_buffer
000236  6885              LDR      r5,[r0,#8]  ; main_power_buffer
000238  4415              ADD      r5,r5,r2
;;;419    	main_power_buffer[3]+=(long)(adc_result);
00023a  6085              STR      r5,[r0,#8]  ; main_power_buffer
00023c  68c5              LDR      r5,[r0,#0xc]  ; main_power_buffer
00023e  442a              ADD      r2,r2,r5
;;;420    
;;;421    	adc_net_buff_cnt++;
000240  60c2              STR      r2,[r0,#0xc]  ; main_power_buffer
000242  8bca              LDRH     r2,[r1,#0x1e]  ; adc_net_buff_cnt
000244  1c52              ADDS     r2,r2,#1
000246  b212              SXTH     r2,r2
000248  83ca              STRH     r2,[r1,#0x1e]
;;;422    	if(adc_net_buff_cnt>=0x1000)
00024a  f5b25f80          CMP      r2,#0x1000
00024e  db00              BLT      |L4.594|
;;;423    		{
;;;424    		adc_net_buff_cnt=0;
000250  83cb              STRH     r3,[r1,#0x1e]
                  |L4.594|
;;;425    		}
;;;426    	if((adc_net_buff_cnt&0x03ff)==0)
000252  f9b1201e          LDRSH    r2,[r1,#0x1e]  ; adc_net_buff_cnt
000256  0595              LSLS     r5,r2,#22
000258  d135              BNE      |L4.710|
;;;427    		{
;;;428    		#ifdef UKU_220
;;;429    		net_buff_=(short)((main_power_buffer[adc_net_buff_cnt>>10])>>11);
;;;430    		#else
;;;431    		net_buff_=(short)((main_power_buffer[adc_net_buff_cnt>>10])>>8);
00025a  1292              ASRS     r2,r2,#10
00025c  f8505022          LDR      r5,[r0,r2,LSL #2]
000260  122d              ASRS     r5,r5,#8
000262  828d              STRH     r5,[r1,#0x14]
;;;432    		#endif
;;;433    		main_power_buffer[adc_net_buff_cnt>>10]=0;
000264  f8403022          STR      r3,[r0,r2,LSL #2]
000268  e02d              B        |L4.710|
                  |L4.618|
;;;434    		}
;;;435    
;;;436    
;;;437    	} 
;;;438    else if(!adc_ch_net)
;;;439    	{
;;;440    	adc_buff[adc_ch][adc_ch_cnt]=(long)adc_result;
00026a  4f7a              LDR      r7,|L4.1108|
00026c  7888              LDRB     r0,[r1,#2]  ; adc_ch
00026e  f891c003          LDRB     r12,[r1,#3]  ; adc_ch_cnt
000272  eb0712c0          ADD      r2,r7,r0,LSL #7
000276  f9b1e016          LDRSH    lr,[r1,#0x16]  ; adc_result
00027a  f842e02c          STR      lr,[r2,r12,LSL #2]
;;;441    	
;;;442    	if((adc_ch_cnt&0x03)==0)
00027e  ea5f728c          LSLS     r2,r12,#30
000282  d112              BNE      |L4.682|
;;;443    		{
;;;444    		long temp_L;
;;;445    		char i;
;;;446    		temp_L=0;
000284  2500              MOVS     r5,#0
;;;447    		for(i=0;i<32;i++)
000286  462a              MOV      r2,r5
;;;448    			{
;;;449    			temp_L+=adc_buff[adc_ch][i];
000288  eb0716c0          ADD      r6,r7,r0,LSL #7
                  |L4.652|
00028c  f8567022          LDR      r7,[r6,r2,LSL #2]
000290  1c52              ADDS     r2,r2,#1              ;447
000292  b2d2              UXTB     r2,r2                 ;447
000294  443d              ADD      r5,r5,r7
000296  2a20              CMP      r2,#0x20              ;447
000298  d3f8              BCC      |L4.652|
;;;450    			}
;;;451    		adc_buff_[adc_ch]= (short)(temp_L>>5);
00029a  116a              ASRS     r2,r5,#5
00029c  4d58              LDR      r5,|L4.1024|
00029e  f8252010          STRH     r2,[r5,r0,LSL #1]
;;;452    		adc_buff__[adc_ch]= adc_buff[adc_ch][adc_ch_cnt];
0002a2  f1050220          ADD      r2,r5,#0x20
0002a6  f822e010          STRH     lr,[r2,r0,LSL #1]
                  |L4.682|
;;;453    		//adc_buff_[3]=346;
;;;454    		}
;;;455    	if(++adc_ch>=16) 
0002aa  1c40              ADDS     r0,r0,#1
0002ac  b2c0              UXTB     r0,r0
0002ae  7088              STRB     r0,[r1,#2]
0002b0  2810              CMP      r0,#0x10
0002b2  d308              BCC      |L4.710|
;;;456    		{
;;;457    		adc_ch=0;
;;;458    		adc_ch_cnt++;
0002b4  f10c0c01          ADD      r12,r12,#1
0002b8  f00c00ff          AND      r0,r12,#0xff
0002bc  708b              STRB     r3,[r1,#2]            ;457
0002be  70c8              STRB     r0,[r1,#3]
;;;459    		if(adc_ch_cnt>=32)adc_ch_cnt=0;
0002c0  2820              CMP      r0,#0x20
0002c2  d300              BCC      |L4.710|
0002c4  70cb              STRB     r3,[r1,#3]
                  |L4.710|
;;;460    		}
;;;461    	}
;;;462    
;;;463      
;;;464    
;;;465    adc_self_ch_cnt=0;
;;;466    
;;;467    adc_ch_net++;
0002c6  1c64              ADDS     r4,r4,#1
0002c8  700b              STRB     r3,[r1,#0]            ;465
;;;468    adc_ch_net&=1;
0002ca  f0140001          ANDS     r0,r4,#1
;;;469    
;;;470    //SET_REG(LPC_GPIO0->FIODIR,7,5,3);
;;;471    //SET_REG(LPC_GPIO0->FIOPIN,adc_ch,5,3);
;;;472    
;;;473    if(adc_ch_net)
;;;474    	{
;;;475    	//LPC_GPIO2->FIODIR|=(1<<7);
;;;476    	//LPC_GPIO2->FIOPIN|=(1<<7);
;;;477    	SET_REG(LPC_ADC->ADCR,1<<2,0,8);
0002ce  4a5e              LDR      r2,|L4.1096|
0002d0  7048              STRB     r0,[r1,#1]            ;468
0002d2  d005              BEQ      |L4.736|
0002d4  6810              LDR      r0,[r2,#0]
0002d6  f02000ff          BIC      r0,r0,#0xff
0002da  1d00              ADDS     r0,r0,#4
0002dc  6010              STR      r0,[r2,#0]
0002de  e034              B        |L4.842|
                  |L4.736|
;;;478    	}
;;;479    else
;;;480    	{
;;;481    	//LPC_GPIO2->FIODIR|=(1<<7);
;;;482    	//LPC_GPIO2->FIOPIN&=~(1<<7);
;;;483    	if(!(adc_ch&(1<<3)))SET_REG(LPC_ADC->ADCR,1<<0,0,8);
0002e0  7889              LDRB     r1,[r1,#2]  ; adc_ch
0002e2  0708              LSLS     r0,r1,#28
0002e4  2800              CMP      r0,#0
;;;484    	else 			SET_REG(LPC_ADC->ADCR,1<<1,0,8);
0002e6  6810              LDR      r0,[r2,#0]
0002e8  f02000ff          BIC      r0,r0,#0xff
0002ec  db02              BLT      |L4.756|
0002ee  f1000001          ADD      r0,r0,#1              ;483
0002f2  e001              B        |L4.760|
                  |L4.756|
0002f4  f1000002          ADD      r0,r0,#2
                  |L4.760|
0002f8  6010              STR      r0,[r2,#0]
;;;485    
;;;486    
;;;487    	SET_REG(LPC_GPIO0->FIODIR,1,28,1);
0002fa  4857              LDR      r0,|L4.1112|
0002fc  6803              LDR      r3,[r0,#0]
0002fe  f0435380          ORR      r3,r3,#0x10000000
000302  6003              STR      r3,[r0,#0]
;;;488    	SET_REG(LPC_GPIO1->FIODIR,1,30,1);
000304  6a03              LDR      r3,[r0,#0x20]
000306  f0434380          ORR      r3,r3,#0x40000000
00030a  6203              STR      r3,[r0,#0x20]
;;;489    	SET_REG(LPC_GPIO3->FIODIR,1,26,1);
00030c  6e03              LDR      r3,[r0,#0x60]
00030e  f0436380          ORR      r3,r3,#0x4000000
000312  6603              STR      r3,[r0,#0x60]
;;;490    
;;;491    	if(!(adc_ch&(1<<0)))SET_REG(LPC_GPIO0->FIOPIN,0,28,1);
000314  07cb              LSLS     r3,r1,#31
;;;492    	else 			SET_REG(LPC_GPIO0->FIOPIN,1,28,1);
000316  6943              LDR      r3,[r0,#0x14]
000318  d008              BEQ      |L4.812|
00031a  f0435380          ORR      r3,r3,#0x10000000
                  |L4.798|
00031e  6143              STR      r3,[r0,#0x14]
;;;493    
;;;494    	if(!(adc_ch&(1<<1)))SET_REG(LPC_GPIO1->FIOPIN,0,30,1);
000320  078b              LSLS     r3,r1,#30
;;;495    	else 			SET_REG(LPC_GPIO1->FIOPIN,1,30,1);
000322  6b43              LDR      r3,[r0,#0x34]
000324  d405              BMI      |L4.818|
000326  f0234380          BIC      r3,r3,#0x40000000     ;494
00032a  e004              B        |L4.822|
                  |L4.812|
00032c  f0235380          BIC      r3,r3,#0x10000000     ;491
000330  e7f5              B        |L4.798|
                  |L4.818|
000332  f0434380          ORR      r3,r3,#0x40000000
                  |L4.822|
000336  6343              STR      r3,[r0,#0x34]
;;;496    
;;;497    	if(!(adc_ch&(1<<2)))SET_REG(LPC_GPIO3->FIOPIN,0,26,1);
000338  0749              LSLS     r1,r1,#29
;;;498    	else 			SET_REG(LPC_GPIO3->FIOPIN,1,26,1);
00033a  6f41              LDR      r1,[r0,#0x74]
00033c  d402              BMI      |L4.836|
00033e  f0216180          BIC      r1,r1,#0x4000000      ;497
000342  e001              B        |L4.840|
                  |L4.836|
000344  f0416180          ORR      r1,r1,#0x4000000
                  |L4.840|
000348  6741              STR      r1,[r0,#0x74]         ;497
                  |L4.842|
;;;499    	}
;;;500    	
;;;501    
;;;502    
;;;503    
;;;504    LPC_ADC->ADCR |=  (1<<24);
00034a  6810              LDR      r0,[r2,#0]
00034c  f0407080          ORR      r0,r0,#0x1000000
000350  6010              STR      r0,[r2,#0]
                  |L4.850|
;;;505    
;;;506    }
000352  e8bd81f0          POP      {r4-r8,pc}
;;;507    
                          ENDP

                  avg_hndl PROC
;;;508    //-----------------------------------------------
;;;509    void avg_hndl(void)
000356  e92d4ff0          PUSH     {r4-r11,lr}
;;;510    { 
;;;511    char i;
;;;512    
;;;513    
;;;514    
;;;515    #define AVGCNTMAX	5
;;;516    if(avg_main_cnt)
00035a  4940              LDR      r1,|L4.1116|
00035c  f9b10000          LDRSH    r0,[r1,#0]  ; avg_main_cnt
000360  b118              CBZ      r0,|L4.874|
;;;517    	{
;;;518    	avg_main_cnt--;
000362  f1a00001          SUB      r0,r0,#1
000366  8008              STRH     r0,[r1,#0]
;;;519    	goto avg_hndl_end;
000368  e0f0              B        |L4.1356|
                  |L4.874|
;;;520    	}                 
;;;521    
;;;522    avg_main_cnt=10;
00036a  200a              MOVS     r0,#0xa
00036c  8008              STRH     r0,[r1,#0]
;;;523    
;;;524    avg_num=0;
00036e  493c              LDR      r1,|L4.1120|
000370  2300              MOVS     r3,#0
;;;525    num_of_dumm_src=100;
000372  f8dfb0f0          LDR      r11,|L4.1124|
;;;526    num_of_max_src=100;
000376  f8df80f0          LDR      r8,|L4.1128|
00037a  700b              STRB     r3,[r1,#0]            ;524
00037c  2064              MOVS     r0,#0x64              ;525
00037e  f88b0000          STRB     r0,[r11,#0]           ;525
000382  f8880000          STRB     r0,[r8,#0]
;;;527    
;;;528    for(i=0;i<NUMIST;i++)
000386  4829              LDR      r0,|L4.1068|
000388  461a              MOV      r2,r3
00038a  f9b04000          LDRSH    r4,[r0,#0]
;;;529    	{
;;;530    	if(/*(bps[i]._state==bsWRK)&&*/(bps[i]._cnt<20))avg_num++;
00038e  4828              LDR      r0,|L4.1072|
000390  e00e              B        |L4.944|
000392  bf00              NOP      
                  |L4.916|
000394  ebc205c2          RSB      r5,r2,r2,LSL #3
000398  eb050545          ADD      r5,r5,r5,LSL #1
00039c  eb000585          ADD      r5,r0,r5,LSL #2
0003a0  78ed              LDRB     r5,[r5,#3]
0003a2  2d14              CMP      r5,#0x14
0003a4  d202              BCS      |L4.940|
0003a6  780d              LDRB     r5,[r1,#0]  ; avg_num
0003a8  1c6d              ADDS     r5,r5,#1
0003aa  700d              STRB     r5,[r1,#0]
                  |L4.940|
0003ac  1c52              ADDS     r2,r2,#1              ;528
0003ae  b2d2              UXTB     r2,r2                 ;528
                  |L4.944|
0003b0  42a2              CMP      r2,r4                 ;528
0003b2  dbef              BLT      |L4.916|
;;;531    	}
;;;532    
;;;533    /*if((K[NUMI]>=1)&&(bps_state[0]==ssWRK))	avg_num++;
;;;534    if((K[NUMI]>=2)&&(bps_state[1]==ssWRK))	avg_num++;
;;;535    if((K[NUMI]>=3)&&(bps_state[2]==ssWRK))	avg_num++;*/
;;;536    
;;;537    	
;;;538    if(avg_num<2)
0003b4  7809              LDRB     r1,[r1,#0]  ; avg_num
0003b6  468a              MOV      r10,r1
0003b8  2902              CMP      r1,#2
0003ba  d37e              BCC      |L4.1210|
;;;539    	{
;;;540    	goto avg_hndl_end;
;;;541    	
;;;542    	}
;;;543    	
;;;544    else if(bU_VALID_VALID)
0003bc  4924              LDR      r1,|L4.1104|
0003be  392c              SUBS     r1,r1,#0x2c
0003c0  7a89              LDRB     r1,[r1,#0xa]  ; bU_VALID_VALID
0003c2  2900              CMP      r1,#0
0003c4  d079              BEQ      |L4.1210|
;;;545    	{
;;;546    	i_avg_min=5000;
0003c6  4a29              LDR      r2,|L4.1132|
0003c8  f2413188          MOV      r1,#0x1388
;;;547    	i_avg_max=0;
0003cc  f8dfc0a0          LDR      r12,|L4.1136|
0003d0  6011              STR      r1,[r2,#0]  ; i_avg_min
;;;548    	i_avg_summ=0;
0003d2  4d28              LDR      r5,|L4.1140|
0003d4  f8cc3000          STR      r3,[r12,#0]  ; i_avg_max
;;;549    	for(i=0;i<NUMIST;i++)
0003d8  2100              MOVS     r1,#0
0003da  602b              STR      r3,[r5,#0]  ; i_avg_summ
0003dc  e05d              B        |L4.1178|
;;;550    		{
;;;551    		if(bps[i]._state==bsWRK)
0003de  bf00              NOP      
                  |L4.992|
0003e0  ebc106c1          RSB      r6,r1,r1,LSL #3
0003e4  eb060646          ADD      r6,r6,r6,LSL #1
0003e8  eb000686          ADD      r6,r0,r6,LSL #2
0003ec  78b7              LDRB     r7,[r6,#2]
0003ee  2f01              CMP      r7,#1
0003f0  d151              BNE      |L4.1174|
;;;552    			{
;;;553    			if(bps[i]._Ii>i_avg_max)
0003f2  6a36              LDR      r6,[r6,#0x20]
0003f4  f8dc7000          LDR      r7,[r12,#0]  ; i_avg_max
0003f8  46b1              MOV      r9,r6
0003fa  42be              CMP      r6,r7
0003fc  dd40              BLE      |L4.1152|
;;;554    				{
;;;555    				i_avg_max=bps[i]._Ii;
;;;556    				num_of_max_src=i;
0003fe  e03b              B        |L4.1144|
                  |L4.1024|
                          DCD      ||.bss||+0x800
                  |L4.1028|
                          DCD      unet_drv_cnt
                  |L4.1032|
                          DCD      Kuload
                  |L4.1036|
                          DCD      load_U
                  |L4.1040|
                          DCD      load_U_
                  |L4.1044|
                          DCD      ad7705_buff_
                  |L4.1048|
                          DCD      Kiload0
                  |L4.1052|
                          DCD      Kiload1
                  |L4.1056|
                          DCD      load_I
                  |L4.1060|
                          DCD      load_I_
                  |L4.1064|
                          DCD      I_LOAD_MODE
                  |L4.1068|
                          DCD      NUMIST
                  |L4.1072|
                          DCD      bps
                  |L4.1076|
                          DCD      I_MAX
                  |L4.1080|
                          DCD      I_MAX_IPS
                  |L4.1084|
                          DCD      I_MIN
                  |L4.1088|
                          DCD      I_MIN_IPS
                  |L4.1092|
                          DCD      0x4002c000
                  |L4.1096|
                          DCD      0x40034000
                  |L4.1100|
                          DCD      0xe000e100
                  |L4.1104|
                          DCD      ||area_number.24||+0x2c
                  |L4.1108|
                          DCD      ||.bss||
                  |L4.1112|
                          DCD      0x2009c000
                  |L4.1116|
                          DCD      avg_main_cnt
                  |L4.1120|
                          DCD      avg_num
                  |L4.1124|
                          DCD      num_of_dumm_src
                  |L4.1128|
                          DCD      num_of_max_src
                  |L4.1132|
                          DCD      i_avg_min
                  |L4.1136|
                          DCD      i_avg_max
                  |L4.1140|
                          DCD      i_avg_summ
                  |L4.1144|
000478  f8cc9000          STR      r9,[r12,#0]  ; i_avg_max
00047c  f8881000          STRB     r1,[r8,#0]
                  |L4.1152|
;;;557    				}
;;;558    			if(bps[i]._Ii<i_avg_min)
000480  6817              LDR      r7,[r2,#0]  ; i_avg_min
000482  45b9              CMP      r9,r7
000484  da03              BGE      |L4.1166|
;;;559    				{
;;;560    				i_avg_min=bps[i]._Ii;
;;;561    				num_of_dumm_src=i;
000486  f8c29000          STR      r9,[r2,#0]  ; i_avg_min
00048a  f88b1000          STRB     r1,[r11,#0]
                  |L4.1166|
;;;562    				}
;;;563    			
;;;564    			i_avg_summ+=bps[i]._Ii;
00048e  682f              LDR      r7,[r5,#0]  ; i_avg_summ
000490  eb090607          ADD      r6,r9,r7
000494  602e              STR      r6,[r5,#0]  ; i_avg_summ
                  |L4.1174|
000496  1c49              ADDS     r1,r1,#1              ;549
000498  b2c9              UXTB     r1,r1                 ;549
                  |L4.1178|
00049a  42a1              CMP      r1,r4                 ;549
00049c  dba0              BLT      |L4.992|
;;;565    			}
;;;566    		}
;;;567    	i_avg=i_avg_summ/avg_num;	
00049e  682e              LDR      r6,[r5,#0]  ; i_avg_summ
0004a0  fb96f5fa          SDIV     r5,r6,r10
0004a4  4ef8              LDR      r6,|L4.2184|
;;;568    	
;;;569    	if(i_avg_min==0)i_avg_min=1;
0004a6  6035              STR      r5,[r6,#0]  ; i_avg
0004a8  6816              LDR      r6,[r2,#0]  ; i_avg_min
0004aa  2501              MOVS     r5,#1                 ;551
0004ac  b906              CBNZ     r6,|L4.1200|
0004ae  6015              STR      r5,[r2,#0]  ; i_avg_min
                  |L4.1200|
;;;570    
;;;571    	
;;;572    
;;;573    	avg=i_avg_max;
0004b0  f8dc6000          LDR      r6,[r12,#0]  ; i_avg_max
0004b4  f8dfc3d4          LDR      r12,|L4.2188|
;;;574    	avg*=100;
0004b8  e000              B        |L4.1212|
                  |L4.1210|
0004ba  e031              B        |L4.1312|
                  |L4.1212|
0004bc  2764              MOVS     r7,#0x64
;;;575    	avg/=i_avg_min;
0004be  6812              LDR      r2,[r2,#0]  ; i_avg_min
0004c0  437e              MULS     r6,r7,r6              ;574
0004c2  fb96f2f2          SDIV     r2,r6,r2
;;;576    	
;;;577    	if(avg>160) bAVG=1;
0004c6  4ef2              LDR      r6,|L4.2192|
0004c8  f8cc2000          STR      r2,[r12,#0]  ; avg
0004cc  2aa0              CMP      r2,#0xa0
0004ce  dd00              BLE      |L4.1234|
0004d0  7035              STRB     r5,[r6,#0]
                  |L4.1234|
;;;578    	if(avg<120) bAVG=0;
0004d2  2a78              CMP      r2,#0x78
0004d4  da01              BGE      |L4.1242|
0004d6  7033              STRB     r3,[r6,#0]
0004d8  e038              B        |L4.1356|
                  |L4.1242|
;;;579    
;;;580    	if(bAVG==1)
0004da  7832              LDRB     r2,[r6,#0]  ; bAVG
0004dc  2a01              CMP      r2,#1
0004de  d135              BNE      |L4.1356|
;;;581    		{
;;;582    		//for(i=0;i<NUMIST;i++)
;;;583    			//{
;;;584    		//	if(bps[i]._state==bsWRK)
;;;585    				//{
;;;586    				//if(bps[i]._Ii>i_avg)bps[i]._xu_--;
;;;587    				/*if(bps[i]._Ii<i_avg)*/
;;;588    				if(bAVG_CNT==0)
0004e0  4aec              LDR      r2,|L4.2196|
0004e2  7816              LDRB     r6,[r2,#0]  ; bAVG_CNT
0004e4  b1ee              CBZ      r6,|L4.1314|
;;;589    					{
;;;590    					bAVG_CNT=1;
;;;591    					if(num_of_dumm_src<NUMIST) bps[num_of_dumm_src]._xu_++;
;;;592    					}
;;;593    				else
;;;594    					{
;;;595    					bAVG_CNT=0;
0004e6  7013              STRB     r3,[r2,#0]
;;;596    					if(num_of_max_src<NUMIST) bps[num_of_max_src]._xu_--;
0004e8  f8982000          LDRB     r2,[r8,#0]  ; num_of_max_src
0004ec  42a2              CMP      r2,r4
0004ee  da09              BGE      |L4.1284|
0004f0  ebc202c2          RSB      r2,r2,r2,LSL #3
0004f4  eb020242          ADD      r2,r2,r2,LSL #1
0004f8  eb000282          ADD      r2,r0,r2,LSL #2
0004fc  f8323f50          LDRH     r3,[r2,#0x50]!
000500  1e5b              SUBS     r3,r3,#1
                  |L4.1282|
000502  8013              STRH     r3,[r2,#0]
                  |L4.1284|
;;;597    					}
;;;598    			
;;;599    				if(bps[i]._xu_<-50)bps[i]._xu_=-50;
000504  ebc101c1          RSB      r1,r1,r1,LSL #3
000508  eb010141          ADD      r1,r1,r1,LSL #1
00050c  eb000081          ADD      r0,r0,r1,LSL #2
000510  f06f0231          MVN      r2,#0x31
000514  f9b01050          LDRSH    r1,[r0,#0x50]
000518  4291              CMP      r1,r2
00051a  da11              BGE      |L4.1344|
00051c  f8a02050          STRH     r2,[r0,#0x50]
                  |L4.1312|
000520  e014              B        |L4.1356|
                  |L4.1314|
000522  7015              STRB     r5,[r2,#0]            ;590
000524  f89b2000          LDRB     r2,[r11,#0]           ;591  ; num_of_dumm_src
000528  42a2              CMP      r2,r4                 ;591
00052a  daeb              BGE      |L4.1284|
00052c  ebc202c2          RSB      r2,r2,r2,LSL #3       ;591
000530  eb020242          ADD      r2,r2,r2,LSL #1       ;591
000534  eb000282          ADD      r2,r0,r2,LSL #2       ;591
000538  f8323f50          LDRH     r3,[r2,#0x50]!        ;591
00053c  1c5b              ADDS     r3,r3,#1              ;591
00053e  e7e0              B        |L4.1282|
                  |L4.1344|
;;;600    				if(bps[i]._xu_>50)bps[i]._xu_=50;	
000540  2932              CMP      r1,#0x32
000542  dd03              BLE      |L4.1356|
000544  f04f0132          MOV      r1,#0x32
000548  f8a01050          STRH     r1,[r0,#0x50]
                  |L4.1356|
;;;601    			//	}
;;;602    			//}		
;;;603    		}			
;;;604    	}   	 
;;;605    
;;;606    
;;;607    avg_hndl_end:
;;;608    __nop();  
00054c  bf00              NOP      
;;;609    }
00054e  e8bd8ff0          POP      {r4-r11,pc}
;;;610    
                          ENDP

                  restart_off PROC
;;;1126   //-----------------------------------------------
;;;1127   void restart_off(void)
000552  b510              PUSH     {r4,lr}
;;;1128   {
;;;1129   lc640_write_long(EE_TIME_PROC_GS_RESTART,0);
000554  2100              MOVS     r1,#0
000556  20d0              MOVS     r0,#0xd0
000558  f7fffffe          BL       lc640_write_long
;;;1130   lc640_write_long(EE_TIME_PROC_PS_RESTART,0);
00055c  2100              MOVS     r1,#0
00055e  e8bd4010          POP      {r4,lr}
000562  20d4              MOVS     r0,#0xd4
000564  f7ffbffe          B.W      lc640_write_long
;;;1131   }
;;;1132   
                          ENDP

                  ach_off_hndl PROC
;;;882    //драйвер функции выключения по амперчасам
;;;883    void ach_off_hndl(void)
000568  b570              PUSH     {r4-r6,lr}
;;;884    {
;;;885    
;;;886    if((work_stat!=wsOFF)&&(ACH_OFF_EN))
00056a  4ccb              LDR      r4,|L4.2200|
;;;887    	{
;;;888    	milliAmperSecunda+=((long)load_I);
00056c  48cb              LDR      r0,|L4.2204|
00056e  2500              MOVS     r5,#0                 ;886
000570  7821              LDRB     r1,[r4,#0]            ;886  ; work_stat
000572  b351              CBZ      r1,|L4.1482|
000574  49ca              LDR      r1,|L4.2208|
000576  8809              LDRH     r1,[r1,#0]            ;886  ; ACH_OFF_EN
000578  b339              CBZ      r1,|L4.1482|
00057a  4aca              LDR      r2,|L4.2212|
00057c  6801              LDR      r1,[r0,#0]  ; milliAmperSecunda
00057e  f9b22000          LDRSH    r2,[r2,#0]  ; load_I
000582  4411              ADD      r1,r1,r2
;;;889    	if(milliAmperSecunda>=3600L)
000584  6001              STR      r1,[r0,#0]  ; milliAmperSecunda
000586  f5b16f61          CMP      r1,#0xe10
00058a  db1f              BLT      |L4.1484|
;;;890    		{
;;;891    		milliAmperSecunda-=3600L;
;;;892    		AMPERCHAS+=1;
00058c  4ec6              LDR      r6,|L4.2216|
00058e  f5a16161          SUB      r1,r1,#0xe10          ;891
000592  6001              STR      r1,[r0,#0]  ; milliAmperSecunda
000594  6831              LDR      r1,[r6,#0]  ; AMPERCHAS
;;;893    		lc640_write_long(EE_AMPERCHAS,AMPERCHAS);
000596  f44f709e          MOV      r0,#0x13c
00059a  1c49              ADDS     r1,r1,#1              ;892
00059c  6031              STR      r1,[r6,#0]  ; AMPERCHAS
00059e  f7fffffe          BL       lc640_write_long
;;;894    
;;;895    		if(AMPERCHAS>=ACH_OFF_LEVEL)
0005a2  49c2              LDR      r1,|L4.2220|
0005a4  6830              LDR      r0,[r6,#0]  ; AMPERCHAS
0005a6  f9b11000          LDRSH    r1,[r1,#0]  ; ACH_OFF_LEVEL
0005aa  4288              CMP      r0,r1
0005ac  db0e              BLT      |L4.1484|
;;;896    			{
;;;897    			work_stat=wsOFF;
0005ae  7025              STRB     r5,[r4,#0]
;;;898    			restart_off();
0005b0  f7fffffe          BL       restart_off
;;;899    			tree_up(iProcIsComplete,1,0,0);
0005b4  2300              MOVS     r3,#0
0005b6  461a              MOV      r2,r3
0005b8  2101              MOVS     r1,#1
0005ba  2078              MOVS     r0,#0x78
0005bc  f7fffffe          BL       tree_up
;;;900    			ret(0);
0005c0  e8bd4070          POP      {r4-r6,lr}
0005c4  2000              MOVS     r0,#0
0005c6  f7ffbffe          B.W      ||ret||
                  |L4.1482|
;;;901    			}
;;;902    		}
;;;903    	}
;;;904    else 
;;;905    	{
;;;906    	milliAmperSecunda=0;
0005ca  6005              STR      r5,[r0,#0]  ; milliAmperSecunda
                  |L4.1484|
;;;907    	}
;;;908    
;;;909    }
0005cc  bd70              POP      {r4-r6,pc}
;;;910     	
                          ENDP

                  curr_off_hndl PROC
;;;912    //драйвер функции выключения по снижению тока
;;;913    void curr_off_hndl(void)
0005ce  b570              PUSH     {r4-r6,lr}
;;;914    {
;;;915    
;;;916    if((work_stat!=wsOFF)&&(CURR_OFF_EN))
0005d0  4cb1              LDR      r4,|L4.2200|
;;;917    	{
;;;918    	if(curr_off_start_cnt<CUR_OFF_T_OFF)curr_off_start_cnt++;
;;;919    	else
;;;920    		{
;;;921    		signed int temp_I=0;
;;;922    		if(work_stat==wsGS)
;;;923    			{
;;;924    			temp_I=(signed int)I_ug_temp;
;;;925    			}
;;;926    		else if(work_stat==wsPS)
;;;927    			{
;;;928    			temp_I=(signed int)I_maxp;
;;;929    			}
;;;930    		temp_I*=(signed int)CUR_OFF_LEVEL_RELATIV;
;;;931    		temp_I/=100;
;;;932    		curr_off_temp=(short)temp_I;
;;;933    		if(load_I<curr_off_temp)
;;;934    			{
;;;935    			curr_off_stop_cnt++;
0005d2  4ab7              LDR      r2,|L4.2224|
0005d4  48b7              LDR      r0,|L4.2228|
0005d6  7825              LDRB     r5,[r4,#0]            ;916  ; work_stat
0005d8  2100              MOVS     r1,#0                 ;916
0005da  b3f5              CBZ      r5,|L4.1626|
0005dc  4bb6              LDR      r3,|L4.2232|
0005de  881b              LDRH     r3,[r3,#0]            ;916  ; CURR_OFF_EN
0005e0  b3db              CBZ      r3,|L4.1626|
0005e2  4eb6              LDR      r6,|L4.2236|
0005e4  f9b03000          LDRSH    r3,[r0,#0]            ;918  ; curr_off_start_cnt
0005e8  f9b66000          LDRSH    r6,[r6,#0]            ;918  ; CUR_OFF_T_OFF
0005ec  42b3              CMP      r3,r6                 ;918
0005ee  da02              BGE      |L4.1526|
0005f0  1c5b              ADDS     r3,r3,#1              ;918
0005f2  8003              STRH     r3,[r0,#0]            ;918
                  |L4.1524|
;;;936    			if(curr_off_stop_cnt>=CUR_OFF_T_ON)
;;;937    				{
;;;938    				work_stat=wsOFF;
;;;939    				restart_off();
;;;940    				tree_up(iProcIsComplete,2,0,0);
;;;941    				ret(0);
;;;942    				}
;;;943    			}
;;;944    		else curr_off_stop_cnt=0;
;;;945    		}
;;;946    	}
;;;947    else 
;;;948    	{
;;;949    	curr_off_start_cnt=0;
;;;950    	curr_off_stop_cnt=0;
;;;951    	}
;;;952    }	
0005f4  bd70              POP      {r4-r6,pc}
                  |L4.1526|
0005f6  2000              MOVS     r0,#0                 ;921
0005f8  2d01              CMP      r5,#1                 ;922
0005fa  d002              BEQ      |L4.1538|
0005fc  2d02              CMP      r5,#2                 ;926
0005fe  d002              BEQ      |L4.1542|
000600  e004              B        |L4.1548|
                  |L4.1538|
000602  48af              LDR      r0,|L4.2240|
000604  e000              B        |L4.1544|
                  |L4.1542|
000606  48af              LDR      r0,|L4.2244|
                  |L4.1544|
000608  f9b00000          LDRSH    r0,[r0,#0]            ;928  ; I_maxp
                  |L4.1548|
00060c  4bae              LDR      r3,|L4.2248|
00060e  f9b33000          LDRSH    r3,[r3,#0]            ;930  ; CUR_OFF_LEVEL_RELATIV
000612  4358              MULS     r0,r3,r0              ;930
000614  2364              MOVS     r3,#0x64              ;931
000616  fb90f0f3          SDIV     r0,r0,r3              ;931
00061a  4bac              LDR      r3,|L4.2252|
00061c  b200              SXTH     r0,r0                 ;932
00061e  8018              STRH     r0,[r3,#0]            ;932
000620  4ba0              LDR      r3,|L4.2212|
000622  f9b33000          LDRSH    r3,[r3,#0]            ;933  ; load_I
000626  4283              CMP      r3,r0                 ;933
000628  da16              BGE      |L4.1624|
00062a  8810              LDRH     r0,[r2,#0]            ;935  ; curr_off_stop_cnt
00062c  1c40              ADDS     r0,r0,#1              ;935
00062e  b200              SXTH     r0,r0                 ;935
000630  8010              STRH     r0,[r2,#0]            ;935
000632  4aa7              LDR      r2,|L4.2256|
000634  f9b22000          LDRSH    r2,[r2,#0]            ;936  ; CUR_OFF_T_ON
000638  4290              CMP      r0,r2                 ;936
00063a  dbdb              BLT      |L4.1524|
00063c  7021              STRB     r1,[r4,#0]            ;938
00063e  f7fffffe          BL       restart_off
000642  2300              MOVS     r3,#0                 ;940
000644  461a              MOV      r2,r3                 ;940
000646  2102              MOVS     r1,#2                 ;940
000648  2078              MOVS     r0,#0x78              ;940
00064a  f7fffffe          BL       tree_up
00064e  e8bd4070          POP      {r4-r6,lr}            ;941
000652  2000              MOVS     r0,#0                 ;941
000654  f7ffbffe          B.W      ||ret||
                  |L4.1624|
000658  e000              B        |L4.1628|
                  |L4.1626|
00065a  e001              B        |L4.1632|
                  |L4.1628|
00065c  8011              STRH     r1,[r2,#0]            ;944
00065e  bd70              POP      {r4-r6,pc}
                  |L4.1632|
000660  8001              STRH     r1,[r0,#0]            ;949
000662  e7f9              B        |L4.1624|
;;;953    
                          ENDP

                  time_hndl PROC
;;;954    //-----------------------------------------------
;;;955    void time_hndl(void) /*ГЦ раз в секунду*/
000664  e92d5ff0          PUSH     {r4-r12,lr}
;;;956    {
;;;957    if((REV_IS_ON)&&(AVT_REV_IS_ON))
;;;958    	{
;;;959    
;;;960    	}
;;;961    
;;;962    
;;;963    
;;;964    
;;;965    if(work_stat==wsGS)
000668  f8df822c          LDR      r8,|L4.2200|
;;;966    	{
;;;967    	time_proc++;
;;;968    	if(((time_proc%600L)==0)&&(restart_enable==reON))
;;;969    		{
;;;970    		lc640_write_long(EE_TIME_PROC_GS_RESTART,time_proc);
;;;971    		}
;;;972    	if(time_proc_remain)
;;;973    		{
;;;974    		time_proc_remain--;
;;;975    		}
;;;976    	if((!time_proc_remain)&&(!T_PROC_GS_MODE))
;;;977    		{
;;;978    		work_stat=wsOFF;
;;;979    		restart_off();
;;;980    		tree_up(iProcIsComplete,0,0,0);
;;;981    		ret(0);
;;;982    		}
;;;983    	if((REV_IS_ON)&&(AVT_REV_IS_ON)){
00066c  f8dfb264          LDR      r11,|L4.2260|
;;;984    		time_proc_phase++;
;;;985    		
;;;986    		if(proc_phase==ppFF) {
;;;987    			REV_STAT=rsFF;
000670  4d99              LDR      r5,|L4.2264|
000672  f8980000          LDRB     r0,[r8,#0]            ;965  ; work_stat
;;;988    			if(time_proc_phase>=AVT_REV_TIME_FF) {
;;;989    				proc_phase=ppFF_P_REW;	
;;;990    				time_proc_phase=0;
;;;991    			}
;;;992    		} else if(proc_phase==ppFF_P_REW) {
;;;993    			if(time_proc_phase==0)REV_STAT=rsFF;
;;;994    			else REV_STAT=rsREW;
;;;995    			if(time_proc_phase>=AVT_REV_TIME_PAUSE) {
000676  4f99              LDR      r7,|L4.2268|
000678  f8df9264          LDR      r9,|L4.2272|
00067c  2601              MOVS     r6,#1                 ;965
00067e  2400              MOVS     r4,#0                 ;972
000680  f44f7a16          MOV      r10,#0x258            ;968
000684  2801              CMP      r0,#1                 ;965
000686  d161              BNE      |L4.1868|
000688  4896              LDR      r0,|L4.2276|
00068a  6801              LDR      r1,[r0,#0]            ;967  ; time_proc
00068c  1c49              ADDS     r1,r1,#1              ;967
00068e  fb91f2fa          SDIV     r2,r1,r10             ;968
000692  6001              STR      r1,[r0,#0]            ;968  ; time_proc
000694  fb0a1012          MLS      r0,r10,r2,r1          ;968
000698  b930              CBNZ     r0,|L4.1704|
00069a  4893              LDR      r0,|L4.2280|
00069c  7800              LDRB     r0,[r0,#0]            ;968  ; restart_enable
00069e  2801              CMP      r0,#1                 ;968
0006a0  d102              BNE      |L4.1704|
0006a2  20d0              MOVS     r0,#0xd0              ;970
0006a4  f7fffffe          BL       lc640_write_long
                  |L4.1704|
0006a8  f8d91000          LDR      r1,[r9,#0]            ;972  ; time_proc_remain
0006ac  4648              MOV      r0,r9                 ;972
0006ae  b109              CBZ      r1,|L4.1716|
0006b0  1e49              SUBS     r1,r1,#1              ;974
0006b2  6001              STR      r1,[r0,#0]            ;974  ; time_proc_remain
                  |L4.1716|
0006b4  4608              MOV      r0,r1                 ;976
0006b6  498d              LDR      r1,|L4.2284|
0006b8  f9b11000          LDRSH    r1,[r1,#0]            ;976  ; T_PROC_GS_MODE
0006bc  4308              ORRS     r0,r0,r1              ;976
0006be  d10c              BNE      |L4.1754|
0006c0  f8884000          STRB     r4,[r8,#0]            ;978
0006c4  f7fffffe          BL       restart_off
0006c8  2300              MOVS     r3,#0                 ;980
0006ca  461a              MOV      r2,r3                 ;980
0006cc  4619              MOV      r1,r3                 ;980
0006ce  2078              MOVS     r0,#0x78              ;980
0006d0  f7fffffe          BL       tree_up
0006d4  2000              MOVS     r0,#0                 ;981
0006d6  f7fffffe          BL       ||ret||
                  |L4.1754|
0006da  4885              LDR      r0,|L4.2288|
0006dc  8800              LDRH     r0,[r0,#0]            ;983  ; REV_IS_ON
0006de  b3a8              CBZ      r0,|L4.1868|
0006e0  f8bb0000          LDRH     r0,[r11,#0]           ;983  ; AVT_REV_IS_ON
0006e4  b390              CBZ      r0,|L4.1868|
0006e6  4b83              LDR      r3,|L4.2292|
0006e8  8818              LDRH     r0,[r3,#0]            ;984  ; time_proc_phase
0006ea  1c40              ADDS     r0,r0,#1              ;984
0006ec  b201              SXTH     r1,r0                 ;984
0006ee  4882              LDR      r0,|L4.2296|
0006f0  8019              STRH     r1,[r3,#0]            ;984
0006f2  7802              LDRB     r2,[r0,#0]            ;986  ; proc_phase
0006f4  b132              CBZ      r2,|L4.1796|
0006f6  2a01              CMP      r2,#1                 ;992
0006f8  d00c              BEQ      |L4.1812|
;;;996    				proc_phase=ppREW;	
;;;997    				time_proc_phase=0;
;;;998    			}
;;;999    		} else if(proc_phase==ppREW) {
0006fa  2a02              CMP      r2,#2
0006fc  d014              BEQ      |L4.1832|
;;;1000   			REV_STAT=rsREW;
;;;1001   			if(time_proc_phase>=AVT_REV_TIME_REW) {
;;;1002   				proc_phase=ppREW_P_FF;	
;;;1003   				time_proc_phase=0;
;;;1004   			}
;;;1005   		} else if(proc_phase==ppREW_P_FF) {
0006fe  2a03              CMP      r2,#3
000700  d01b              BEQ      |L4.1850|
000702  e023              B        |L4.1868|
                  |L4.1796|
000704  4a7d              LDR      r2,|L4.2300|
000706  702e              STRB     r6,[r5,#0]            ;987
000708  f9b22000          LDRSH    r2,[r2,#0]            ;988  ; AVT_REV_TIME_FF
00070c  4291              CMP      r1,r2                 ;988
00070e  db1d              BLT      |L4.1868|
000710  7006              STRB     r6,[r0,#0]            ;989
000712  e01a              B        |L4.1866|
                  |L4.1812|
000714  b131              CBZ      r1,|L4.1828|
000716  702c              STRB     r4,[r5,#0]            ;994
                  |L4.1816|
000718  f9b72000          LDRSH    r2,[r7,#0]            ;995  ; AVT_REV_TIME_PAUSE
00071c  4291              CMP      r1,r2                 ;995
00071e  db15              BLT      |L4.1868|
000720  2102              MOVS     r1,#2                 ;996
000722  e008              B        |L4.1846|
                  |L4.1828|
000724  702e              STRB     r6,[r5,#0]            ;993
000726  e7f7              B        |L4.1816|
                  |L4.1832|
000728  4a75              LDR      r2,|L4.2304|
00072a  702c              STRB     r4,[r5,#0]            ;1000
00072c  f9b22000          LDRSH    r2,[r2,#0]            ;1001  ; AVT_REV_TIME_REW
000730  4291              CMP      r1,r2                 ;1001
000732  db0b              BLT      |L4.1868|
000734  2103              MOVS     r1,#3                 ;1002
                  |L4.1846|
000736  7001              STRB     r1,[r0,#0]            ;996
000738  e007              B        |L4.1866|
                  |L4.1850|
;;;1006   			if(time_proc_phase==0)REV_STAT=rsREW;
00073a  b1a9              CBZ      r1,|L4.1896|
;;;1007   			else REV_STAT=rsFF;
00073c  f8856000          STRB.W   r6,[r5,#0]
                  |L4.1856|
;;;1008   			if(time_proc_phase>=AVT_REV_TIME_PAUSE) {
000740  f9b72000          LDRSH    r2,[r7,#0]  ; AVT_REV_TIME_PAUSE
000744  4291              CMP      r1,r2
000746  db01              BLT      |L4.1868|
;;;1009   				proc_phase=ppFF;	
000748  7004              STRB     r4,[r0,#0]
                  |L4.1866|
;;;1010   				time_proc_phase=0;
00074a  801c              STRH     r4,[r3,#0]
                  |L4.1868|
;;;1011   			}
;;;1012   		}
;;;1013   	}
;;;1014   	}
;;;1015   
;;;1016   
;;;1017   if(work_stat==wsPS)
00074c  f8980000          LDRB     r0,[r8,#0]  ; work_stat
000750  2802              CMP      r0,#2
000752  d15c              BNE      |L4.2062|
;;;1018   	{
;;;1019   	time_proc++;
000754  4863              LDR      r0,|L4.2276|
000756  6801              LDR      r1,[r0,#0]  ; time_proc
000758  1c49              ADDS     r1,r1,#1
;;;1020   	if(((time_proc%600L)==0)&&(restart_enable==reON))
00075a  fb91f2fa          SDIV     r2,r1,r10
00075e  6001              STR      r1,[r0,#0]  ; time_proc
000760  fb0a1012          MLS      r0,r10,r2,r1
000764  b110              CBZ      r0,|L4.1900|
000766  e008              B        |L4.1914|
                  |L4.1896|
000768  702c              STRB     r4,[r5,#0]            ;1006
00076a  e7e9              B        |L4.1856|
                  |L4.1900|
00076c  485e              LDR      r0,|L4.2280|
00076e  7800              LDRB     r0,[r0,#0]  ; restart_enable
000770  2801              CMP      r0,#1
000772  d102              BNE      |L4.1914|
;;;1021   		{
;;;1022   		lc640_write_long(EE_TIME_PROC_PS_RESTART,time_proc);
000774  20d4              MOVS     r0,#0xd4
000776  f7fffffe          BL       lc640_write_long
                  |L4.1914|
;;;1023   		}
;;;1024   	if(time_proc_remain)
00077a  f8d91000          LDR      r1,[r9,#0]  ; time_proc_remain
00077e  4648              MOV      r0,r9
000780  b109              CBZ      r1,|L4.1926|
;;;1025   		{
;;;1026   		time_proc_remain--;
000782  1e49              SUBS     r1,r1,#1
000784  6001              STR      r1,[r0,#0]  ; time_proc_remain
                  |L4.1926|
;;;1027   		}
;;;1028   	if((!time_proc_remain)&&(!T_PROC_PS_MODE))
000786  4608              MOV      r0,r1
000788  495e              LDR      r1,|L4.2308|
00078a  f9b11000          LDRSH    r1,[r1,#0]  ; T_PROC_PS_MODE
00078e  4308              ORRS     r0,r0,r1
000790  d10c              BNE      |L4.1964|
;;;1029   		{
;;;1030   		work_stat=wsOFF;
000792  f8884000          STRB     r4,[r8,#0]
;;;1031   		restart_off();
000796  f7fffffe          BL       restart_off
;;;1032   		tree_up(iProcIsComplete,0,0,0);
00079a  2300              MOVS     r3,#0
00079c  461a              MOV      r2,r3
00079e  4619              MOV      r1,r3
0007a0  2078              MOVS     r0,#0x78
0007a2  f7fffffe          BL       tree_up
;;;1033   		ret(0);
0007a6  2000              MOVS     r0,#0
0007a8  f7fffffe          BL       ||ret||
                  |L4.1964|
;;;1034   		}
;;;1035   	if((REV_IS_ON)&&(AVT_REV_IS_ON)){
0007ac  4850              LDR      r0,|L4.2288|
0007ae  8800              LDRH     r0,[r0,#0]  ; REV_IS_ON
0007b0  2800              CMP      r0,#0
0007b2  d02c              BEQ      |L4.2062|
0007b4  f8bb0000          LDRH     r0,[r11,#0]  ; AVT_REV_IS_ON
0007b8  2800              CMP      r0,#0
0007ba  d028              BEQ      |L4.2062|
;;;1036   		time_proc_phase++;
0007bc  484d              LDR      r0,|L4.2292|
0007be  8801              LDRH     r1,[r0,#0]  ; time_proc_phase
0007c0  1c49              ADDS     r1,r1,#1
0007c2  b20a              SXTH     r2,r1
;;;1037   		
;;;1038   		if(proc_phase==ppFF) {
0007c4  494c              LDR      r1,|L4.2296|
0007c6  8002              STRH     r2,[r0,#0]            ;1036
0007c8  780b              LDRB     r3,[r1,#0]  ; proc_phase
0007ca  b16b              CBZ      r3,|L4.2024|
;;;1039   			REV_STAT=rsFF;
;;;1040   			if(time_proc_phase>=AVT_REV_TIME_FF) {
;;;1041   				proc_phase=ppFF_P_REW;	
;;;1042   				time_proc_phase=0;
;;;1043   			}
;;;1044   		} else if(proc_phase==ppFF_P_REW) {
0007cc  2b01              CMP      r3,#1
0007ce  d013              BEQ      |L4.2040|
;;;1045   			if(time_proc_phase==0)REV_STAT=rsFF;
;;;1046   			else REV_STAT=rsREW;
;;;1047   			if(time_proc_phase>=AVT_REV_TIME_PAUSE) {
;;;1048   				proc_phase=ppREW;	
;;;1049   				time_proc_phase=0;
;;;1050   			}
;;;1051   		} else if(proc_phase==ppREW) {
0007d0  2b02              CMP      r3,#2
0007d2  d01e              BEQ      |L4.2066|
;;;1052   			REV_STAT=rsREW;
;;;1053   			if(time_proc_phase>=AVT_REV_TIME_REW) {
;;;1054   				proc_phase=ppREW_P_FF;	
;;;1055   				time_proc_phase=0;
;;;1056   			}
;;;1057   		} else if(proc_phase==ppREW_P_FF) {
0007d4  2b03              CMP      r3,#3
0007d6  d11a              BNE      |L4.2062|
;;;1058   			if(time_proc_phase==0)REV_STAT=rsREW;
0007d8  b322              CBZ      r2,|L4.2084|
;;;1059   			else REV_STAT=rsFF;
0007da  702e              STRB     r6,[r5,#0]
                  |L4.2012|
;;;1060   			if(time_proc_phase>=AVT_REV_TIME_PAUSE) {
0007dc  f9b73000          LDRSH    r3,[r7,#0]  ; AVT_REV_TIME_PAUSE
0007e0  429a              CMP      r2,r3
0007e2  db14              BLT      |L4.2062|
;;;1061   				proc_phase=ppFF;	
0007e4  700c              STRB     r4,[r1,#0]
;;;1062   				time_proc_phase=0;
0007e6  e011              B        |L4.2060|
                  |L4.2024|
0007e8  4b44              LDR      r3,|L4.2300|
0007ea  702e              STRB     r6,[r5,#0]            ;1039
0007ec  f9b33000          LDRSH    r3,[r3,#0]            ;1040  ; AVT_REV_TIME_FF
0007f0  429a              CMP      r2,r3                 ;1040
0007f2  db0c              BLT      |L4.2062|
0007f4  700e              STRB     r6,[r1,#0]            ;1041
0007f6  e009              B        |L4.2060|
                  |L4.2040|
0007f8  b132              CBZ      r2,|L4.2056|
0007fa  702c              STRB     r4,[r5,#0]            ;1046
                  |L4.2044|
0007fc  f9b73000          LDRSH    r3,[r7,#0]            ;1047  ; AVT_REV_TIME_PAUSE
000800  429a              CMP      r2,r3                 ;1047
000802  db04              BLT      |L4.2062|
000804  2202              MOVS     r2,#2                 ;1048
000806  e00b              B        |L4.2080|
                  |L4.2056|
000808  702e              STRB     r6,[r5,#0]            ;1045
00080a  e7f7              B        |L4.2044|
                  |L4.2060|
00080c  8004              STRH     r4,[r0,#0]            ;1042
                  |L4.2062|
;;;1063   			}
;;;1064   		}
;;;1065   	}
;;;1066   	}
;;;1067   
;;;1068   
;;;1069   
;;;1070   }
00080e  e8bd9ff0          POP      {r4-r12,pc}
                  |L4.2066|
000812  4b3b              LDR      r3,|L4.2304|
000814  702c              STRB     r4,[r5,#0]            ;1052
000816  f9b33000          LDRSH    r3,[r3,#0]            ;1053  ; AVT_REV_TIME_REW
00081a  429a              CMP      r2,r3                 ;1053
00081c  dbf7              BLT      |L4.2062|
00081e  2203              MOVS     r2,#3                 ;1054
                  |L4.2080|
000820  700a              STRB     r2,[r1,#0]            ;1054
000822  e7f3              B        |L4.2060|
                  |L4.2084|
000824  702c              STRB     r4,[r5,#0]            ;1058
000826  e7d9              B        |L4.2012|
;;;1071   
                          ENDP

                  cap_time_hndl PROC
;;;1072   //-----------------------------------------------
;;;1073   void cap_time_hndl(void) /*10 раз в секунду*/
000828  b570              PUSH     {r4-r6,lr}
;;;1074   {
;;;1075   
;;;1076   if(work_stat==wsCAP)
00082a  481b              LDR      r0,|L4.2200|
00082c  7800              LDRB     r0,[r0,#0]  ; work_stat
00082e  2803              CMP      r0,#3
000830  d129              BNE      |L4.2182|
;;;1077   	{
;;;1078   	cap_time_proc++;
000832  4935              LDR      r1,|L4.2312|
;;;1079   	if(cap_time_proc>=(CAP_ZAR_TIME+CAP_PAUSE1_TIME+CAP_RAZR_TIME+CAP_PAUSE2_TIME))
000834  4835              LDR      r0,|L4.2316|
000836  680a              LDR      r2,[r1,#0]            ;1078  ; cap_time_proc
000838  1c52              ADDS     r2,r2,#1              ;1078
00083a  600a              STR      r2,[r1,#0]  ; cap_time_proc
00083c  f9b05000          LDRSH    r5,[r0,#0]  ; CAP_ZAR_TIME
000840  4833              LDR      r0,|L4.2320|
000842  f9b00000          LDRSH    r0,[r0,#0]  ; CAP_PAUSE1_TIME
000846  182b              ADDS     r3,r5,r0
000848  4832              LDR      r0,|L4.2324|
00084a  f9b00000          LDRSH    r0,[r0,#0]  ; CAP_RAZR_TIME
00084e  181c              ADDS     r4,r3,r0
000850  4831              LDR      r0,|L4.2328|
000852  f9b00000          LDRSH    r0,[r0,#0]  ; CAP_PAUSE2_TIME
000856  1826              ADDS     r6,r4,r0
;;;1080   		{
;;;1081   		cap_time_proc=0;
000858  2000              MOVS     r0,#0
00085a  4296              CMP      r6,r2                 ;1079
00085c  dc04              BGT      |L4.2152|
;;;1082   		CAP_COUNTER++;
00085e  4e2f              LDR      r6,|L4.2332|
000860  6008              STR      r0,[r1,#0]  ; cap_time_proc
000862  8832              LDRH     r2,[r6,#0]  ; CAP_COUNTER
000864  1c52              ADDS     r2,r2,#1
000866  8032              STRH     r2,[r6,#0]
                  |L4.2152|
;;;1083   		}
;;;1084   
;;;1085   	if(cap_time_proc>=CAP_ZAR_TIME)bOFF=1;
000868  6809              LDR      r1,[r1,#0]  ; cap_time_proc
00086a  4e2d              LDR      r6,|L4.2336|
00086c  2201              MOVS     r2,#1
00086e  42a9              CMP      r1,r5
000870  db01              BLT      |L4.2166|
000872  7032              STRB     r2,[r6,#0]
000874  e000              B        |L4.2168|
                  |L4.2166|
;;;1086   	else bOFF=0;
000876  7030              STRB     r0,[r6,#0]
                  |L4.2168|
;;;1087   
;;;1088   	if((cap_time_proc>=(CAP_ZAR_TIME+CAP_PAUSE1_TIME))&&(cap_time_proc<(CAP_ZAR_TIME+CAP_PAUSE1_TIME+CAP_RAZR_TIME)))bRAZR=1;
000878  4d2a              LDR      r5,|L4.2340|
00087a  428b              CMP      r3,r1
00087c  dc54              BGT      |L4.2344|
00087e  428c              CMP      r4,r1
000880  dd52              BLE      |L4.2344|
000882  702a              STRB     r2,[r5,#0]
000884  e051              B        |L4.2346|
                  |L4.2182|
000886  e069              B        |L4.2396|
                  |L4.2184|
                          DCD      i_avg
                  |L4.2188|
                          DCD      avg
                  |L4.2192|
                          DCD      bAVG
                  |L4.2196|
                          DCD      bAVG_CNT
                  |L4.2200|
                          DCD      work_stat
                  |L4.2204|
                          DCD      milliAmperSecunda
                  |L4.2208|
                          DCD      ACH_OFF_EN
                  |L4.2212|
                          DCD      load_I
                  |L4.2216|
                          DCD      AMPERCHAS
                  |L4.2220|
                          DCD      ACH_OFF_LEVEL
                  |L4.2224|
                          DCD      curr_off_stop_cnt
                  |L4.2228|
                          DCD      curr_off_start_cnt
                  |L4.2232|
                          DCD      CURR_OFF_EN
                  |L4.2236|
                          DCD      CUR_OFF_T_OFF
                  |L4.2240|
                          DCD      I_ug_temp
                  |L4.2244|
                          DCD      I_maxp
                  |L4.2248|
                          DCD      CUR_OFF_LEVEL_RELATIV
                  |L4.2252|
                          DCD      curr_off_temp
                  |L4.2256|
                          DCD      CUR_OFF_T_ON
                  |L4.2260|
                          DCD      AVT_REV_IS_ON
                  |L4.2264|
                          DCD      REV_STAT
                  |L4.2268|
                          DCD      AVT_REV_TIME_PAUSE
                  |L4.2272|
                          DCD      time_proc_remain
                  |L4.2276|
                          DCD      time_proc
                  |L4.2280|
                          DCD      restart_enable
                  |L4.2284|
                          DCD      T_PROC_GS_MODE
                  |L4.2288|
                          DCD      REV_IS_ON
                  |L4.2292|
                          DCD      time_proc_phase
                  |L4.2296|
                          DCD      proc_phase
                  |L4.2300|
                          DCD      AVT_REV_TIME_FF
                  |L4.2304|
                          DCD      AVT_REV_TIME_REW
                  |L4.2308|
                          DCD      T_PROC_PS_MODE
                  |L4.2312|
                          DCD      cap_time_proc
                  |L4.2316|
                          DCD      CAP_ZAR_TIME
                  |L4.2320|
                          DCD      CAP_PAUSE1_TIME
                  |L4.2324|
                          DCD      CAP_RAZR_TIME
                  |L4.2328|
                          DCD      CAP_PAUSE2_TIME
                  |L4.2332|
                          DCD      CAP_COUNTER
                  |L4.2336|
                          DCD      bOFF
                  |L4.2340|
                          DCD      bRAZR
                  |L4.2344|
;;;1089   	else bRAZR=0;
000928  7028              STRB     r0,[r5,#0]
                  |L4.2346|
;;;1090   
;;;1091   
;;;1092   	CAP_TIME_SEC++;
00092a  49ff              LDR      r1,|L4.3368|
00092c  880a              LDRH     r2,[r1,#0]  ; CAP_TIME_SEC
00092e  1c52              ADDS     r2,r2,#1
000930  b212              SXTH     r2,r2
000932  800a              STRH     r2,[r1,#0]
;;;1093   	if(CAP_TIME_SEC>=600)
000934  f5b27f16          CMP      r2,#0x258
000938  db10              BLT      |L4.2396|
;;;1094   		{
;;;1095   		CAP_TIME_SEC=0;
00093a  8008              STRH     r0,[r1,#0]
;;;1096   		
;;;1097   		CAP_TIME_MIN++;
00093c  49fb              LDR      r1,|L4.3372|
00093e  880a              LDRH     r2,[r1,#0]  ; CAP_TIME_MIN
000940  1c52              ADDS     r2,r2,#1
000942  b212              SXTH     r2,r2
000944  800a              STRH     r2,[r1,#0]
;;;1098   		if(CAP_TIME_MIN>=60)
000946  2a3c              CMP      r2,#0x3c
000948  db08              BLT      |L4.2396|
;;;1099   			{
;;;1100   			CAP_TIME_MIN=0;
00094a  8008              STRH     r0,[r1,#0]
;;;1101   	
;;;1102   			CAP_TIME_HOUR++;
00094c  49f8              LDR      r1,|L4.3376|
00094e  880a              LDRH     r2,[r1,#0]  ; CAP_TIME_HOUR
000950  1c52              ADDS     r2,r2,#1
000952  b212              SXTH     r2,r2
000954  800a              STRH     r2,[r1,#0]
;;;1103   			if(CAP_TIME_HOUR>=24)
000956  2a18              CMP      r2,#0x18
000958  db00              BLT      |L4.2396|
;;;1104   				{
;;;1105   				CAP_TIME_HOUR=0;
00095a  8008              STRH     r0,[r1,#0]
                  |L4.2396|
;;;1106   				}
;;;1107   			}
;;;1108   		}
;;;1109   	}
;;;1110   
;;;1111   }
00095c  bd70              POP      {r4-r6,pc}
;;;1112   
                          ENDP

                  restart_on_GS PROC
;;;1114   //-----------------------------------------------
;;;1115   void restart_on_GS(void)
00095e  2101              MOVS     r1,#1
;;;1116   {
;;;1117   lc640_write_long(EE_TIME_PROC_GS_RESTART,1);
000960  20d0              MOVS     r0,#0xd0
000962  f7ffbffe          B.W      lc640_write_long
;;;1118   }
;;;1119   
                          ENDP

                  restart_on_PS PROC
;;;1120   //-----------------------------------------------
;;;1121   void restart_on_PS(void)
000966  2101              MOVS     r1,#1
;;;1122   {
;;;1123   lc640_write_long(EE_TIME_PROC_PS_RESTART,1);
000968  20d4              MOVS     r0,#0xd4
00096a  f7ffbffe          B.W      lc640_write_long
;;;1124   }
;;;1125   
                          ENDP

                  start_GS PROC
;;;1133   //-----------------------------------------------
;;;1134   void start_GS(void) {
00096e  b570              PUSH     {r4-r6,lr}
;;;1135   	work_stat=wsGS;
000970  48f0              LDR      r0,|L4.3380|
000972  2501              MOVS     r5,#1
;;;1136   	time_proc=0;
000974  2400              MOVS     r4,#0
000976  7005              STRB     r5,[r0,#0]            ;1135
000978  48ef              LDR      r0,|L4.3384|
;;;1137   	time_proc_remain=T_PROC_GS;
00097a  49f1              LDR      r1,|L4.3392|
00097c  6004              STR      r4,[r0,#0]  ; time_proc
00097e  48ef              LDR      r0,|L4.3388|
000980  6800              LDR      r0,[r0,#0]  ; T_PROC_GS
;;;1138   	//index_set=0;
;;;1139   	restart_on_GS();
000982  6008              STR      r0,[r1,#0]  ; time_proc_remain
000984  f7fffffe          BL       restart_on_GS
;;;1140   	bFAST_REG=1;
000988  48ee              LDR      r0,|L4.3396|
00098a  7205              STRB     r5,[r0,#8]
;;;1141   	bU_VALID=0;
00098c  7244              STRB     r4,[r0,#9]
;;;1142   	bU_VALID_VALID=0;
00098e  7284              STRB     r4,[r0,#0xa]
;;;1143   	
;;;1144   	if((REV_IS_ON)&&(AVT_REV_IS_ON)){
000990  48ed              LDR      r0,|L4.3400|
000992  8800              LDRH     r0,[r0,#0]  ; REV_IS_ON
000994  b140              CBZ      r0,|L4.2472|
000996  48ed              LDR      r0,|L4.3404|
000998  8800              LDRH     r0,[r0,#0]  ; AVT_REV_IS_ON
00099a  b128              CBZ      r0,|L4.2472|
;;;1145   		time_proc_phase=0;
00099c  48ec              LDR      r0,|L4.3408|
00099e  8004              STRH     r4,[r0,#0]
;;;1146   		proc_phase=ppFF;
0009a0  48ec              LDR      r0,|L4.3412|
0009a2  7004              STRB     r4,[r0,#0]
;;;1147   		REV_STAT=rsFF;	
0009a4  48ec              LDR      r0,|L4.3416|
0009a6  7005              STRB     r5,[r0,#0]
                  |L4.2472|
;;;1148   	}
;;;1149   
;;;1150   	milliAmperSecunda=0L;
0009a8  48ec              LDR      r0,|L4.3420|
0009aa  4621              MOV      r1,r4
;;;1151   	AMPERCHAS=0L;
0009ac  6004              STR      r4,[r0,#0]  ; milliAmperSecunda
0009ae  48ec              LDR      r0,|L4.3424|
;;;1152   	lc640_write_long(EE_AMPERCHAS,AMPERCHAS);
0009b0  6004              STR      r4,[r0,#0]  ; AMPERCHAS
0009b2  e8bd4070          POP      {r4-r6,lr}
0009b6  f44f709e          MOV      r0,#0x13c
0009ba  f7ffbffe          B.W      lc640_write_long
;;;1153   }
;;;1154   
                          ENDP

                  start_PS PROC
;;;1156   //-----------------------------------------------
;;;1157   void start_PS(void) {
0009be  49dd              LDR      r1,|L4.3380|
0009c0  b510              PUSH     {r4,lr}
;;;1158   	work_stat=wsPS;
0009c2  2002              MOVS     r0,#2
0009c4  7008              STRB     r0,[r1,#0]
;;;1159   	time_proc=0;
0009c6  48dc              LDR      r0,|L4.3384|
0009c8  2400              MOVS     r4,#0
;;;1160   	time_proc_remain=T_PROC_PS;
0009ca  49dd              LDR      r1,|L4.3392|
0009cc  6004              STR      r4,[r0,#0]  ; time_proc
0009ce  48e5              LDR      r0,|L4.3428|
0009d0  6800              LDR      r0,[r0,#0]  ; T_PROC_PS
;;;1161   	//index_set=0;
;;;1162   	restart_on_PS();
0009d2  6008              STR      r0,[r1,#0]  ; time_proc_remain
0009d4  f7fffffe          BL       restart_on_PS
;;;1163   	bFAST_REG=1;
0009d8  48da              LDR      r0,|L4.3396|
0009da  2101              MOVS     r1,#1
0009dc  7201              STRB     r1,[r0,#8]
;;;1164   	bU_VALID=0;
0009de  7244              STRB     r4,[r0,#9]
;;;1165   	bU_VALID_VALID=0;
0009e0  7284              STRB     r4,[r0,#0xa]
;;;1166   	
;;;1167   	if((REV_IS_ON)&&(AVT_REV_IS_ON)){
0009e2  48d9              LDR      r0,|L4.3400|
0009e4  8800              LDRH     r0,[r0,#0]  ; REV_IS_ON
0009e6  b140              CBZ      r0,|L4.2554|
0009e8  48d8              LDR      r0,|L4.3404|
0009ea  8800              LDRH     r0,[r0,#0]  ; AVT_REV_IS_ON
0009ec  b128              CBZ      r0,|L4.2554|
;;;1168   		time_proc_phase=0;
0009ee  48d8              LDR      r0,|L4.3408|
0009f0  8004              STRH     r4,[r0,#0]
;;;1169   		proc_phase=ppFF;
0009f2  48d8              LDR      r0,|L4.3412|
0009f4  7004              STRB     r4,[r0,#0]
;;;1170   		REV_STAT=rsFF;	
0009f6  48d8              LDR      r0,|L4.3416|
0009f8  7001              STRB     r1,[r0,#0]
                  |L4.2554|
;;;1171   	}
;;;1172   	milliAmperSecunda=0L;
0009fa  48d8              LDR      r0,|L4.3420|
0009fc  4621              MOV      r1,r4
;;;1173   	AMPERCHAS=0L;
0009fe  6004              STR      r4,[r0,#0]  ; milliAmperSecunda
000a00  48d7              LDR      r0,|L4.3424|
;;;1174   	lc640_write_long(EE_AMPERCHAS,AMPERCHAS);
000a02  6004              STR      r4,[r0,#0]  ; AMPERCHAS
000a04  e8bd4010          POP      {r4,lr}
000a08  f44f709e          MOV      r0,#0x13c
000a0c  f7ffbffe          B.W      lc640_write_long
;;;1175   }
;;;1176   
                          ENDP

                  start_CAP PROC
;;;1177   //-----------------------------------------------
;;;1178   void start_CAP(void) {
000a10  49c8              LDR      r1,|L4.3380|
;;;1179   	work_stat=wsCAP;
000a12  2003              MOVS     r0,#3
000a14  7008              STRB     r0,[r1,#0]
;;;1180   }
000a16  4770              BX       lr
;;;1181   
                          ENDP

                  pause_CAP PROC
;;;1182   //-----------------------------------------------
;;;1183   void pause_CAP(void) {
000a18  49c6              LDR      r1,|L4.3380|
;;;1184   	work_stat=wsOFF;
000a1a  2000              MOVS     r0,#0
000a1c  7008              STRB     r0,[r1,#0]
;;;1185   }
000a1e  4770              BX       lr
;;;1186   
                          ENDP

                  stop_CAP PROC
;;;1187   //-----------------------------------------------
;;;1188   void stop_CAP(void) {
000a20  49c4              LDR      r1,|L4.3380|
;;;1189   	work_stat=wsOFF;
000a22  2000              MOVS     r0,#0
000a24  7008              STRB     r0,[r1,#0]
;;;1190   
;;;1191   }
000a26  4770              BX       lr
;;;1192   
                          ENDP

                  reset_CAP PROC
;;;1193   //-----------------------------------------------
;;;1194   void reset_CAP(void) {
000a28  49c2              LDR      r1,|L4.3380|
;;;1195   	work_stat=wsOFF;
000a2a  2000              MOVS     r0,#0
000a2c  7008              STRB     r0,[r1,#0]
;;;1196   	cap_time_proc=0;
000a2e  49ce              LDR      r1,|L4.3432|
;;;1197   	CAP_COUNTER=0;
000a30  6008              STR      r0,[r1,#0]  ; cap_time_proc
000a32  49ce              LDR      r1,|L4.3436|
000a34  8008              STRH     r0,[r1,#0]
;;;1198   	CAP_TIME_SEC=0;
000a36  49bc              LDR      r1,|L4.3368|
000a38  8008              STRH     r0,[r1,#0]
;;;1199   	CAP_TIME_MIN=0;
000a3a  49bc              LDR      r1,|L4.3372|
000a3c  8008              STRH     r0,[r1,#0]
;;;1200   	CAP_TIME_HOUR=0;
000a3e  49bc              LDR      r1,|L4.3376|
000a40  8008              STRH     r0,[r1,#0]
;;;1201   }
000a42  4770              BX       lr
;;;1202   
                          ENDP

                  stop_proc PROC
;;;1203   //-----------------------------------------------
;;;1204   void stop_proc(void)
000a44  49bb              LDR      r1,|L4.3380|
;;;1205   {
;;;1206   work_stat=wsOFF;
000a46  2000              MOVS     r0,#0
000a48  7008              STRB     r0,[r1,#0]
;;;1207   restart_off();
000a4a  e7fe              B        restart_off
;;;1208   }
;;;1209   
                          ENDP

                  find_U_curve PROC
;;;1210   //-----------------------------------------------
;;;1211   short find_U_curve(signed short in)
000a4c  e92d41f0          PUSH     {r4-r8,lr}
;;;1212   {
;;;1213   short ii,i=0,out=0;
000a50  2400              MOVS     r4,#0
000a52  4606              MOV      r6,r0                 ;1212
;;;1214   
;;;1215   ii=0;
;;;1216   
;;;1217   if(lc640_read_int(SEKTOR_KURVE_U+(ii*2)) >= in)
000a54  f44f75fa          MOV      r5,#0x1f4
000a58  46a0              MOV      r8,r4                 ;1213
000a5a  4627              MOV      r7,r4                 ;1215
000a5c  4628              MOV      r0,r5
000a5e  f7fffffe          BL       lc640_read_int
000a62  42b0              CMP      r0,r6
000a64  da29              BGE      |L4.2746|
;;;1218   	{
;;;1219   	out=0;
;;;1220   	}
;;;1221   else 
;;;1222   	{
;;;1223   	for (ii=0;ii<=200;ii+=10)
;;;1224   		{
;;;1225   		if(lc640_read_int(SEKTOR_KURVE_U+(ii*2)) <= in)
000a66  bf00              NOP      
                  |L4.2664|
000a68  eb050047          ADD      r0,r5,r7,LSL #1
000a6c  f7fffffe          BL       lc640_read_int
000a70  42b0              CMP      r0,r6
000a72  dc00              BGT      |L4.2678|
;;;1226   			{
;;;1227   			i=ii;
000a74  463c              MOV      r4,r7
                  |L4.2678|
000a76  370a              ADDS     r7,r7,#0xa            ;1223
000a78  b23f              SXTH     r7,r7                 ;1223
000a7a  2fc8              CMP      r7,#0xc8              ;1223
000a7c  ddf4              BLE      |L4.2664|
;;;1228   			}
;;;1229   		else continue;
;;;1230   		}
;;;1231   	if(i<200)
000a7e  2cc8              CMP      r4,#0xc8
000a80  da0e              BGE      |L4.2720|
;;;1232   		{
;;;1233   		for (ii=i;ii<i+10;ii++)
000a82  f104070a          ADD      r7,r4,#0xa
000a86  e008              B        |L4.2714|
                  |L4.2696|
;;;1234   			{
;;;1235   			if(lc640_read_int(SEKTOR_KURVE_U+(ii*2)) <= in)
000a88  eb050044          ADD      r0,r5,r4,LSL #1
000a8c  f7fffffe          BL       lc640_read_int
000a90  42b0              CMP      r0,r6
000a92  dc00              BGT      |L4.2710|
;;;1236   				{
;;;1237   				out=ii;
000a94  46a0              MOV      r8,r4
                  |L4.2710|
000a96  1c64              ADDS     r4,r4,#1              ;1233
000a98  b224              SXTH     r4,r4                 ;1233
                  |L4.2714|
000a9a  42bc              CMP      r4,r7                 ;1233
000a9c  dbf4              BLT      |L4.2696|
000a9e  e00c              B        |L4.2746|
                  |L4.2720|
;;;1238   				}
;;;1239   			else continue;
;;;1240   			}
;;;1241   		}
;;;1242   	else 
;;;1243   		{
;;;1244   		for (ii=200;ii<=202;ii++)
000aa0  f05f04c8          MOVS.W   r4,#0xc8
                  |L4.2724|
;;;1245   			{
;;;1246   			if(lc640_read_int(SEKTOR_KURVE_U+(ii*2)) <= in)
000aa4  eb050044          ADD      r0,r5,r4,LSL #1
000aa8  f7fffffe          BL       lc640_read_int
000aac  42b0              CMP      r0,r6
000aae  dc00              BGT      |L4.2738|
;;;1247   				{
;;;1248   				out=ii;
000ab0  46a0              MOV      r8,r4
                  |L4.2738|
000ab2  1c64              ADDS     r4,r4,#1              ;1244
000ab4  b224              SXTH     r4,r4                 ;1244
000ab6  2cca              CMP      r4,#0xca              ;1244
000ab8  ddf4              BLE      |L4.2724|
                  |L4.2746|
;;;1249   				}
;;;1250   			else continue;
;;;1251   			}
;;;1252   	
;;;1253   	
;;;1254   		}
;;;1255   	}
;;;1256   
;;;1257   return out;
000aba  4640              MOV      r0,r8
;;;1258   }
000abc  e449              B        |L4.850|
;;;1259   
                          ENDP

                  find_I_curve PROC
;;;1260   //-----------------------------------------------
;;;1261   short find_I_curve(signed short in)
000abe  e92d41f0          PUSH     {r4-r8,lr}
;;;1262   {
;;;1263   short ii,i=0,out=0;
000ac2  2400              MOVS     r4,#0
000ac4  4606              MOV      r6,r0                 ;1262
;;;1264   
;;;1265   ii=0;
;;;1266   
;;;1267   if(lc640_read_int(SEKTOR_KURVE_I+(ii*2)) >= in)
000ac6  f44f757a          MOV      r5,#0x3e8
000aca  46a0              MOV      r8,r4                 ;1263
000acc  4627              MOV      r7,r4                 ;1265
000ace  4628              MOV      r0,r5
000ad0  f7fffffe          BL       lc640_read_int
000ad4  42b0              CMP      r0,r6
000ad6  da28              BGE      |L4.2858|
                  |L4.2776|
;;;1268   	{
;;;1269   	out=0;
;;;1270   	}
;;;1271   else 
;;;1272   	{
;;;1273   	for (ii=0;ii<=200;ii+=10)
;;;1274   		{
;;;1275   		if(lc640_read_int(SEKTOR_KURVE_I+(ii*2)) <= in)
000ad8  eb050047          ADD      r0,r5,r7,LSL #1
000adc  f7fffffe          BL       lc640_read_int
000ae0  42b0              CMP      r0,r6
000ae2  dc00              BGT      |L4.2790|
;;;1276   			{
;;;1277   			i=ii;
000ae4  463c              MOV      r4,r7
                  |L4.2790|
000ae6  370a              ADDS     r7,r7,#0xa            ;1273
000ae8  b23f              SXTH     r7,r7                 ;1273
000aea  2fc8              CMP      r7,#0xc8              ;1273
000aec  ddf4              BLE      |L4.2776|
;;;1278   			}
;;;1279   		else continue;
;;;1280   		}
;;;1281   	
;;;1282   	if(i<200)
000aee  2cc8              CMP      r4,#0xc8
000af0  da0e              BGE      |L4.2832|
;;;1283   		{
;;;1284   		for (ii=i;ii<i+10;ii++)
000af2  f104070a          ADD      r7,r4,#0xa
000af6  e008              B        |L4.2826|
                  |L4.2808|
;;;1285   			{
;;;1286   			if(lc640_read_int(SEKTOR_KURVE_I+(ii*2)) <= in)
000af8  eb050044          ADD      r0,r5,r4,LSL #1
000afc  f7fffffe          BL       lc640_read_int
000b00  42b0              CMP      r0,r6
000b02  dc00              BGT      |L4.2822|
;;;1287   				{
;;;1288   				out=ii;
000b04  46a0              MOV      r8,r4
                  |L4.2822|
000b06  1c64              ADDS     r4,r4,#1              ;1284
000b08  b224              SXTH     r4,r4                 ;1284
                  |L4.2826|
000b0a  42bc              CMP      r4,r7                 ;1284
000b0c  dbf4              BLT      |L4.2808|
000b0e  e00c              B        |L4.2858|
                  |L4.2832|
;;;1289   				}
;;;1290   			else continue;
;;;1291   			}
;;;1292   		}
;;;1293   	else 
;;;1294   		{
;;;1295   		for (ii=200;ii<=202;ii++)
000b10  f05f04c8          MOVS.W   r4,#0xc8
                  |L4.2836|
;;;1296   			{
;;;1297   			if(lc640_read_int(SEKTOR_KURVE_I+(ii*2)) <= in)
000b14  eb050044          ADD      r0,r5,r4,LSL #1
000b18  f7fffffe          BL       lc640_read_int
000b1c  42b0              CMP      r0,r6
000b1e  dc00              BGT      |L4.2850|
;;;1298   				{
;;;1299   				out=ii;
000b20  46a0              MOV      r8,r4
                  |L4.2850|
000b22  1c64              ADDS     r4,r4,#1              ;1295
000b24  b224              SXTH     r4,r4                 ;1295
000b26  2cca              CMP      r4,#0xca              ;1295
000b28  ddf4              BLE      |L4.2836|
                  |L4.2858|
;;;1300   				}
;;;1301   			else continue;
;;;1302   			}
;;;1303   		}
;;;1304   	}
;;;1305   return out;
000b2a  4640              MOV      r0,r8
;;;1306   }
000b2c  e411              B        |L4.850|
;;;1307   
                          ENDP

                  viz_hndl PROC
;;;1309   //-----------------------------------------------
;;;1310   void viz_hndl(void)
000b2e  e92d5ff0          PUSH     {r4-r12,lr}
;;;1311   {
;;;1312   if(ind==iK_viz_u)
000b32  f8df923c          LDR      r9,|L4.3440|
;;;1313   	{
;;;1314   	if(viz_stat==vsON)
;;;1315   		{
;;;1316   		viz_stat_cnt++;
;;;1317   		if(viz_stat_cnt>=10221)
;;;1318   			{
;;;1319   			viz_stat=vsOFF;
;;;1320   			lc640_write_int(EE_U_CURVE_IS_ON,0xabcd);
;;;1321   			//ind=iK_viz_sel;
;;;1322   			tree_down(0,0);
;;;1323   			}
;;;1324   		tst_pwm_i=1022;
;;;1325   		tst_pwm_u=(viz_stat_cnt/50)*5;
000b36  4f8f              LDR      r7,|L4.3444|
000b38  4e8f              LDR      r6,|L4.3448|
000b3a  f8990000          LDRB     r0,[r9,#0]            ;1312  ; a_ind
000b3e  4c8f              LDR      r4,|L4.3452|
000b40  2532              MOVS     r5,#0x32
000b42  f24278ed          MOV      r8,#0x27ed            ;1317
000b46  f04f0a00          MOV      r10,#0                ;1319
000b4a  f2403bfe          MOV      r11,#0x3fe            ;1324
000b4e  2845              CMP      r0,#0x45              ;1312
000b50  d12a              BNE      |L4.2984|
000b52  7830              LDRB     r0,[r6,#0]            ;1314  ; viz_stat
000b54  2801              CMP      r0,#1                 ;1314
000b56  d158              BNE      |L4.3082|
000b58  8820              LDRH     r0,[r4,#0]            ;1316  ; viz_stat_cnt
000b5a  1c40              ADDS     r0,r0,#1              ;1316
000b5c  b200              SXTH     r0,r0                 ;1316
000b5e  8020              STRH     r0,[r4,#0]            ;1316
000b60  4540              CMP      r0,r8                 ;1317
000b62  db09              BLT      |L4.2936|
000b64  f886a000          STRB     r10,[r6,#0]           ;1319
000b68  4985              LDR      r1,|L4.3456|
000b6a  20ac              MOVS     r0,#0xac              ;1320
000b6c  f7fffffe          BL       lc640_write_int
000b70  2100              MOVS     r1,#0                 ;1322
000b72  4608              MOV      r0,r1                 ;1322
000b74  f7fffffe          BL       tree_down
                  |L4.2936|
000b78  4982              LDR      r1,|L4.3460|
000b7a  f8a1b000          STRH     r11,[r1,#0]           ;1324
000b7e  f9b41000          LDRSH    r1,[r4,#0]  ; viz_stat_cnt
000b82  fb91f0f5          SDIV     r0,r1,r5
;;;1326   		if(viz_stat_cnt%50==49)
000b86  fb051110          MLS      r1,r5,r0,r1
000b8a  eb000280          ADD      r2,r0,r0,LSL #2       ;1325
000b8e  803a              STRH     r2,[r7,#0]            ;1325
000b90  2931              CMP      r1,#0x31
000b92  d109              BNE      |L4.2984|
;;;1327   			{
;;;1328   			lc640_write_int(SEKTOR_KURVE_U+((viz_stat_cnt/50)*2),load_U);
000b94  f44f71fa          MOV      r1,#0x1f4
000b98  eb010040          ADD      r0,r1,r0,LSL #1
000b9c  497a              LDR      r1,|L4.3464|
000b9e  b200              SXTH     r0,r0
000ba0  f9b11000          LDRSH    r1,[r1,#0]  ; load_U
000ba4  f7fffffe          BL       lc640_write_int
                  |L4.2984|
;;;1329   			}
;;;1330   		}
;;;1331   	}
;;;1332   
;;;1333   if(ind==iK_viz_i)
000ba8  f8990000          LDRB     r0,[r9,#0]  ; a_ind
000bac  2844              CMP      r0,#0x44
000bae  d12c              BNE      |L4.3082|
;;;1334   	{
;;;1335   	if(viz_stat==vsON)
000bb0  7830              LDRB     r0,[r6,#0]  ; viz_stat
000bb2  2801              CMP      r0,#1
000bb4  d129              BNE      |L4.3082|
;;;1336   		{
;;;1337   		viz_stat_cnt++;
000bb6  8820              LDRH     r0,[r4,#0]  ; viz_stat_cnt
000bb8  1c40              ADDS     r0,r0,#1
000bba  b200              SXTH     r0,r0
000bbc  8020              STRH     r0,[r4,#0]
;;;1338   		if(viz_stat_cnt>=10221)
000bbe  4540              CMP      r0,r8
000bc0  db09              BLT      |L4.3030|
;;;1339   			{
;;;1340   			viz_stat=vsOFF;
000bc2  f886a000          STRB     r10,[r6,#0]
;;;1341   			lc640_write_int(EE_I_CURVE_IS_ON,0xabcd);
000bc6  496e              LDR      r1,|L4.3456|
000bc8  20ae              MOVS     r0,#0xae
000bca  f7fffffe          BL       lc640_write_int
;;;1342   			//ind=iK_viz_sel;
;;;1343   			tree_down(0,0);
000bce  2100              MOVS     r1,#0
000bd0  4608              MOV      r0,r1
000bd2  f7fffffe          BL       tree_down
                  |L4.3030|
;;;1344   			}
;;;1345   		tst_pwm_u=1022;
000bd6  f8a7b000          STRH     r11,[r7,#0]
;;;1346   		tst_pwm_i=(viz_stat_cnt/50)*5;
000bda  f9b41000          LDRSH    r1,[r4,#0]  ; viz_stat_cnt
000bde  4b69              LDR      r3,|L4.3460|
000be0  fb91f0f5          SDIV     r0,r1,r5
;;;1347   		if(viz_stat_cnt%50==49)
000be4  fb051110          MLS      r1,r5,r0,r1
000be8  eb000280          ADD      r2,r0,r0,LSL #2       ;1346
000bec  801a              STRH     r2,[r3,#0]            ;1346
000bee  2931              CMP      r1,#0x31
000bf0  d10b              BNE      |L4.3082|
;;;1348   			{
;;;1349   			lc640_write_int(SEKTOR_KURVE_I+((viz_stat_cnt/50)*2),load_I);
000bf2  f44f717a          MOV      r1,#0x3e8
000bf6  eb010040          ADD      r0,r1,r0,LSL #1
000bfa  4964              LDR      r1,|L4.3468|
000bfc  b200              SXTH     r0,r0
000bfe  f9b11000          LDRSH    r1,[r1,#0]  ; load_I
000c02  e8bd5ff0          POP      {r4-r12,lr}
000c06  f7ffbffe          B.W      lc640_write_int
                  |L4.3082|
;;;1350   			}
;;;1351   		}
;;;1352   	}
;;;1353   }
000c0a  e600              B        |L4.2062|
;;;1354   
                          ENDP

                  bps_hndl PROC
;;;1357   //-----------------------------------------------
;;;1358   void bps_hndl(void) /*ГЦ, 10 раз в секунду*/
000c0c  e92d5ffc          PUSH     {r2-r12,lr}
;;;1359   {
;;;1360   char /*ptr__,*/i;
;;;1361   
;;;1362   if((REV_IS_ON)&&(AVT_REV_IS_ON)) {
000c10  484d              LDR      r0,|L4.3400|
;;;1363   	if(work_stat==wsGS) {
000c12  f8df9120          LDR      r9,|L4.3380|
000c16  8800              LDRH     r0,[r0,#0]            ;1362  ; REV_IS_ON
000c18  b330              CBZ      r0,|L4.3176|
000c1a  484c              LDR      r0,|L4.3404|
000c1c  8800              LDRH     r0,[r0,#0]            ;1362  ; AVT_REV_IS_ON
000c1e  b318              CBZ      r0,|L4.3176|
;;;1364   		if(REV_STAT==rsFF) 	I_ug_temp=AVT_REV_I_NOM_FF;
000c20  485b              LDR      r0,|L4.3472|
000c22  f8993000          LDRB     r3,[r9,#0]            ;1363  ; work_stat
000c26  f9b01000          LDRSH    r1,[r0,#0]
000c2a  484b              LDR      r0,|L4.3416|
000c2c  2b01              CMP      r3,#1                 ;1363
000c2e  7800              LDRB     r0,[r0,#0]
000c30  d007              BEQ      |L4.3138|
;;;1365   		else if (REV_STAT==rsREW) I_ug_temp=AVT_REV_I_NOM_REW;
;;;1366   	} else if (work_stat==wsPS) {
;;;1367   		if(REV_STAT==rsFF) 	U_up_temp=AVT_REV_U_NOM_FF;
000c32  4a58              LDR      r2,|L4.3476|
000c34  2b02              CMP      r3,#2                 ;1366
000c36  f9b22000          LDRSH    r2,[r2,#0]
000c3a  d00c              BEQ      |L4.3158|
;;;1368   		else if (REV_STAT==rsREW) U_up_temp=AVT_REV_U_NOM_REW;
;;;1369   	} else {
;;;1370   		U_up_temp=AVT_REV_U_NOM_FF;
000c3c  4856              LDR      r0,|L4.3480|
000c3e  8002              STRH     r2,[r0,#0]
;;;1371   		I_ug_temp=AVT_REV_I_NOM_FF;
000c40  e003              B        |L4.3146|
                  |L4.3138|
000c42  2801              CMP      r0,#1                 ;1364
000c44  d001              BEQ      |L4.3146|
000c46  b110              CBZ      r0,|L4.3150|
000c48  e024              B        |L4.3220|
                  |L4.3146|
000c4a  4854              LDR      r0,|L4.3484|
000c4c  e0de              B        |L4.3596|
                  |L4.3150|
000c4e  4854              LDR      r0,|L4.3488|
000c50  4952              LDR      r1,|L4.3484|
000c52  8800              LDRH     r0,[r0,#0]            ;1365  ; AVT_REV_I_NOM_REW
000c54  e01d              B        |L4.3218|
                  |L4.3158|
000c56  2801              CMP      r0,#1                 ;1367
000c58  d001              BEQ      |L4.3166|
000c5a  b118              CBZ      r0,|L4.3172|
000c5c  e01a              B        |L4.3220|
                  |L4.3166|
000c5e  484e              LDR      r0,|L4.3480|
000c60  8002              STRH     r2,[r0,#0]            ;1367
000c62  e017              B        |L4.3220|
                  |L4.3172|
000c64  484f              LDR      r0,|L4.3492|
000c66  e0cf              B        |L4.3592|
                  |L4.3176|
;;;1372   	}
;;;1373   } else {
;;;1374   
;;;1375   if(fiks_stat_I==2)I_ug_temp=I_ug3;
000c68  484f              LDR      r0,|L4.3496|
000c6a  f9b00000          LDRSH    r0,[r0,#0]  ; fiks_stat_I
000c6e  2802              CMP      r0,#2
000c70  d055              BEQ      |L4.3358|
;;;1376   else if(fiks_stat_I==1)I_ug_temp=I_ug2;
000c72  2801              CMP      r0,#1
000c74  d054              BEQ      |L4.3360|
;;;1377   else I_ug_temp=I_ug;
000c76  484d              LDR      r0,|L4.3500|
                  |L4.3192|
000c78  8801              LDRH     r1,[r0,#0]            ;1376  ; I_ug2
000c7a  4848              LDR      r0,|L4.3484|
000c7c  8001              STRH     r1,[r0,#0]            ;1376
;;;1378   
;;;1379   if(fiks_stat_U==2)U_up_temp=U_up3;
000c7e  484c              LDR      r0,|L4.3504|
000c80  f9b00000          LDRSH    r0,[r0,#0]  ; fiks_stat_U
000c84  2802              CMP      r0,#2
000c86  d04c              BEQ      |L4.3362|
;;;1380   	else if(fiks_stat_U==1)U_up_temp=U_up2;
000c88  2801              CMP      r0,#1
000c8a  d04b              BEQ      |L4.3364|
;;;1381   	else U_up_temp=U_up;
000c8c  4849              LDR      r0,|L4.3508|
                  |L4.3214|
000c8e  4942              LDR      r1,|L4.3480|
000c90  8800              LDRH     r0,[r0,#0]            ;1380  ; U_up2
                  |L4.3218|
000c92  8008              STRH     r0,[r1,#0]            ;1380
                  |L4.3220|
;;;1382   
;;;1383   }
;;;1384   	
;;;1385   gran(&I_ug_temp,I_MIN_IPS,I_MAX_IPS);
000c94  4848              LDR      r0,|L4.3512|
000c96  f9b02000          LDRSH    r2,[r0,#0]  ; I_MAX_IPS
000c9a  4848              LDR      r0,|L4.3516|
000c9c  f9b01000          LDRSH    r1,[r0,#0]  ; I_MIN_IPS
000ca0  483e              LDR      r0,|L4.3484|
000ca2  f7fffffe          BL       gran
;;;1386   gran(&U_up_temp,U_MIN,U_MAX);
000ca6  4846              LDR      r0,|L4.3520|
000ca8  f9b02000          LDRSH    r2,[r0,#0]  ; U_MAX
000cac  4845              LDR      r0,|L4.3524|
000cae  f9b01000          LDRSH    r1,[r0,#0]  ; U_MIN
000cb2  4839              LDR      r0,|L4.3480|
000cb4  f7fffffe          BL       gran
;;;1387   
;;;1388   if(sh_cnt0<10) {
000cb8  4f22              LDR      r7,|L4.3396|
000cba  2601              MOVS     r6,#1                 ;1363
000cbc  2500              MOVS     r5,#0                 ;1362
000cbe  7978              LDRB     r0,[r7,#5]  ; sh_cnt0
000cc0  280a              CMP      r0,#0xa
000cc2  d210              BCS      |L4.3302|
;;;1389   	sh_cnt0++;
000cc4  1c40              ADDS     r0,r0,#1
000cc6  b2c0              UXTB     r0,r0
000cc8  7178              STRB     r0,[r7,#5]
;;;1390   	if(sh_cnt0>=10) {
000cca  280a              CMP      r0,#0xa
000ccc  d30b              BCC      |L4.3302|
;;;1391   		sh_cnt0=0;
000cce  717d              STRB     r5,[r7,#5]
;;;1392   		b1Hz_sh=1;
000cd0  71be              STRB     r6,[r7,#6]
;;;1393   		if(sh_cnt1<5) {
000cd2  79f8              LDRB     r0,[r7,#7]  ; sh_cnt1
000cd4  2805              CMP      r0,#5
000cd6  d206              BCS      |L4.3302|
;;;1394   			sh_cnt1++;
000cd8  1c40              ADDS     r0,r0,#1
000cda  b2c0              UXTB     r0,r0
000cdc  71f8              STRB     r0,[r7,#7]
;;;1395   			if(sh_cnt1>=5) {
000cde  2805              CMP      r0,#5
000ce0  d301              BCC      |L4.3302|
;;;1396   			 	sh_cnt1=0;
000ce2  71fd              STRB     r5,[r7,#7]
;;;1397   				bPRECESSION_REG=1;
000ce4  72fe              STRB     r6,[r7,#0xb]
                  |L4.3302|
;;;1398   			}
;;;1399   		}
;;;1400   	}
;;;1401   }
;;;1402   
;;;1403   if(ind==iK_load)
000ce6  4922              LDR      r1,|L4.3440|
;;;1404   	{
;;;1405   	if(sub_ind==0)
;;;1406   		{
;;;1407   		cntrl_stat_U=1022;
;;;1408   		cntrl_stat_I=1022;
;;;1409   		bps_stat=stON;
000ce8  4837              LDR      r0,|L4.3528|
;;;1410   
;;;1411   		for(i=0;i<NUMIST;i++)
;;;1412   			{
;;;1413   			bps[i]._vol_u=1022;
;;;1414   			bps[i]._vol_i=1022;
;;;1415   			bps[i]._flags_tu=0;
;;;1416   			}
;;;1417   		}
;;;1418   	else if(sub_ind==1)
;;;1419   		{
;;;1420   		if(phase==0)
000cea  4a38              LDR      r2,|L4.3532|
000cec  780b              LDRB     r3,[r1,#0]            ;1403  ; a_ind
000cee  4c38              LDR      r4,|L4.3536|
000cf0  f8df80e0          LDR      r8,|L4.3540|
000cf4  f2403afe          MOV      r10,#0x3fe            ;1407
000cf8  2b30              CMP      r3,#0x30              ;1403
000cfa  d014              BEQ      |L4.3366|
;;;1421   			{
;;;1422     			cntrl_stat_U=0;
;;;1423   			cntrl_stat_I=0;
;;;1424   			bps_stat=stOFF;
;;;1425   
;;;1426   			for(i=0;i<NUMIST;i++)
;;;1427   				{
;;;1428   				bps[i]._vol_u=0;
;;;1429   				bps[i]._vol_i=0;
;;;1430   				bps[i]._flags_tu=1;
;;;1431   				}
;;;1432   			}
;;;1433   		else if(phase==1)
;;;1434   			{
;;;1435     			cntrl_stat_U=1022;
;;;1436   			cntrl_stat_I=1022;
;;;1437   			bps_stat=stON;
;;;1438   
;;;1439   			for(i=0;i<NUMIST;i++)
;;;1440   				{
;;;1441   				bps[i]._vol_u=1022;
;;;1442   				bps[i]._vol_i=1022;
;;;1443   				bps[i]._flags_tu=0;
;;;1444   				}
;;;1445   			}
;;;1446   		}
;;;1447   	else 
;;;1448   		{
;;;1449   		bps_stat=stOFF;
;;;1450   
;;;1451   		bps[0]._vol_u=0;
;;;1452   		bps[0]._vol_i=0;
;;;1453   		bps[0]._flags_tu=1;
;;;1454   		}
;;;1455   	}
;;;1456   else if(ind==iK_bps)
000cfc  2b2b              CMP      r3,#0x2b
000cfe  d06d              BEQ      |L4.3548|
;;;1457   	{
;;;1458   	if(sub_ind==0)
;;;1459   		{
;;;1460   		cntrl_stat_U=1022;
;;;1461   		cntrl_stat_I=1022;
;;;1462   		bps_stat=stON;
;;;1463   
;;;1464   		bps[0]._vol_u=0;
;;;1465   		bps[0]._vol_i=0;
;;;1466   		bps[0]._flags_tu=1;
;;;1467   
;;;1468   		bps[1]._vol_u=0;
;;;1469   		bps[1]._vol_i=0;
;;;1470   		bps[1]._flags_tu=1;
;;;1471   
;;;1472   		bps[1]._vol_u=0;
;;;1473   		bps[1]._vol_i=0;
;;;1474   		bps[1]._flags_tu=1;
;;;1475   
;;;1476   		bps[2]._vol_u=0;
;;;1477   		bps[2]._vol_i=0;
;;;1478   		bps[2]._flags_tu=1;
;;;1479   
;;;1480   		bps[3]._vol_u=0;
;;;1481   		bps[3]._vol_i=0;
;;;1482   		bps[3]._flags_tu=1;
;;;1483   
;;;1484   		bps[4]._vol_u=0;
;;;1485   		bps[4]._vol_i=0;
;;;1486   		bps[4]._flags_tu=1;
;;;1487   
;;;1488   		bps[5]._vol_u=0;
;;;1489   		bps[5]._vol_i=0;
;;;1490   		bps[5]._flags_tu=1;
;;;1491   
;;;1492   		bps[6]._vol_u=0;
;;;1493   		bps[6]._vol_i=0;
;;;1494   		bps[6]._flags_tu=1;
;;;1495   
;;;1496   		bps[7]._vol_u=0;
;;;1497   		bps[7]._vol_i=0;
;;;1498   		bps[7]._flags_tu=1;
;;;1499   
;;;1500   		bps[8]._vol_u=0;
;;;1501   		bps[8]._vol_i=0;
;;;1502   		bps[8]._flags_tu=1;
;;;1503   		
;;;1504   		bps[9]._vol_u=0;
;;;1505   		bps[9]._vol_i=0;
;;;1506   		bps[9]._flags_tu=1;
;;;1507   
;;;1508   		bps[10]._vol_u=0;
;;;1509   		bps[10]._vol_i=0;
;;;1510   		bps[10]._flags_tu=1;
;;;1511   
;;;1512   		bps[11]._vol_u=0;
;;;1513   		bps[11]._vol_i=0;
;;;1514   		bps[11]._flags_tu=1;
;;;1515    		
;;;1516   		bps[sub_ind1]._vol_u=1022;
;;;1517   		bps[sub_ind1]._vol_i=1022;
;;;1518   		bps[sub_ind1]._flags_tu=0;
;;;1519   		}
;;;1520   
;;;1521   	else if(sub_ind==3)
;;;1522   		{
;;;1523   		if(phase==0)
;;;1524   			{
;;;1525     			cntrl_stat_U=0;
;;;1526   			cntrl_stat_I=0;
;;;1527   			bps_stat=stOFF;
;;;1528   			bps[0]._vol_u=0;
;;;1529   			bps[0]._vol_i=0;
;;;1530   			bps[0]._flags_tu=1;
;;;1531   	
;;;1532   			bps[1]._vol_u=0;
;;;1533   			bps[1]._vol_i=0;
;;;1534   			bps[1]._flags_tu=1;
;;;1535   	
;;;1536   			bps[1]._vol_u=0;
;;;1537   			bps[1]._vol_i=0;
;;;1538   			bps[1]._flags_tu=1;
;;;1539   	
;;;1540   			bps[2]._vol_u=0;
;;;1541   			bps[2]._vol_i=0;
;;;1542   			bps[2]._flags_tu=1;
;;;1543   	
;;;1544   			bps[3]._vol_u=0;
;;;1545   			bps[3]._vol_i=0;
;;;1546   			bps[3]._flags_tu=1;
;;;1547   	
;;;1548   			bps[4]._vol_u=0;
;;;1549   			bps[4]._vol_i=0;
;;;1550   			bps[4]._flags_tu=1;
;;;1551   	
;;;1552   			bps[5]._vol_u=0;
;;;1553   			bps[5]._vol_i=0;
;;;1554   			bps[5]._flags_tu=1;
;;;1555   	
;;;1556   			bps[6]._vol_u=0;
;;;1557   			bps[6]._vol_i=0;
;;;1558   			bps[6]._flags_tu=1;
;;;1559   	
;;;1560   			bps[7]._vol_u=0;
;;;1561   			bps[7]._vol_i=0;
;;;1562   			bps[7]._flags_tu=1;
;;;1563   	
;;;1564   			bps[8]._vol_u=0;
;;;1565   			bps[8]._vol_i=0;
;;;1566   			bps[8]._flags_tu=1;
;;;1567   			
;;;1568   			bps[9]._vol_u=0;
;;;1569   			bps[9]._vol_i=0;
;;;1570   			bps[9]._flags_tu=1;
;;;1571   	
;;;1572   			bps[10]._vol_u=0;
;;;1573   			bps[10]._vol_i=0;
;;;1574   			bps[10]._flags_tu=1;
;;;1575   	
;;;1576   			bps[11]._vol_u=0;
;;;1577   			bps[11]._vol_i=0;
;;;1578   			bps[11]._flags_tu=1;
;;;1579   
;;;1580   			}
;;;1581   		else if(phase==1)
;;;1582   			{
;;;1583     			cntrl_stat_U=1022;
;;;1584   			cntrl_stat_I=1022;
;;;1585   			bps_stat=stON;
;;;1586   
;;;1587   			bps[0]._vol_u=0;
;;;1588   			bps[0]._vol_i=0;
;;;1589   			bps[0]._flags_tu=1;
;;;1590   	
;;;1591   			bps[1]._vol_u=0;
;;;1592   			bps[1]._vol_i=0;
;;;1593   			bps[1]._flags_tu=1;
;;;1594   	
;;;1595   			bps[1]._vol_u=0;
;;;1596   			bps[1]._vol_i=0;
;;;1597   			bps[1]._flags_tu=1;
;;;1598   	
;;;1599   			bps[2]._vol_u=0;
;;;1600   			bps[2]._vol_i=0;
;;;1601   			bps[2]._flags_tu=1;
;;;1602   	
;;;1603   			bps[3]._vol_u=0;
;;;1604   			bps[3]._vol_i=0;
;;;1605   			bps[3]._flags_tu=1;
;;;1606   	
;;;1607   			bps[4]._vol_u=0;
;;;1608   			bps[4]._vol_i=0;
;;;1609   			bps[4]._flags_tu=1;
;;;1610   	
;;;1611   			bps[5]._vol_u=0;
;;;1612   			bps[5]._vol_i=0;
;;;1613   			bps[5]._flags_tu=1;
;;;1614   	
;;;1615   			bps[6]._vol_u=0;
;;;1616   			bps[6]._vol_i=0;
;;;1617   			bps[6]._flags_tu=1;
;;;1618   	
;;;1619   			bps[7]._vol_u=0;
;;;1620   			bps[7]._vol_i=0;
;;;1621   			bps[7]._flags_tu=1;
;;;1622   	
;;;1623   			bps[8]._vol_u=0;
;;;1624   			bps[8]._vol_i=0;
;;;1625   			bps[8]._flags_tu=1;
;;;1626   			
;;;1627   			bps[9]._vol_u=0;
;;;1628   			bps[9]._vol_i=0;
;;;1629   			bps[9]._flags_tu=1;
;;;1630   	
;;;1631   			bps[10]._vol_u=0;
;;;1632   			bps[10]._vol_i=0;
;;;1633   			bps[10]._flags_tu=1;
;;;1634   	
;;;1635   			bps[11]._vol_u=0;
;;;1636   			bps[11]._vol_i=0;
;;;1637   			bps[11]._flags_tu=1;
;;;1638   
;;;1639   
;;;1640   
;;;1641   			bps[sub_ind1]._vol_u=1022;
;;;1642   			bps[sub_ind1]._vol_i=1022;
;;;1643   			bps[sub_ind1]._flags_tu=0;
;;;1644   			}
;;;1645   		}
;;;1646   	else 
;;;1647   		{
;;;1648   		bps_stat=stOFF;
;;;1649   
;;;1650   		bps[0]._vol_u=0;
;;;1651   		bps[0]._vol_i=0;
;;;1652   		bps[0]._flags_tu=1;
;;;1653   
;;;1654   		bps[1]._vol_u=0;
;;;1655   		bps[1]._vol_i=0;
;;;1656   		bps[1]._flags_tu=1;
;;;1657   
;;;1658   		bps[1]._vol_u=0;
;;;1659   		bps[1]._vol_i=0;
;;;1660   		bps[1]._flags_tu=1;
;;;1661   
;;;1662   		bps[2]._vol_u=0;
;;;1663   		bps[2]._vol_i=0;
;;;1664   		bps[2]._flags_tu=1;
;;;1665   
;;;1666   		bps[3]._vol_u=0;
;;;1667   		bps[3]._vol_i=0;
;;;1668   		bps[3]._flags_tu=1;
;;;1669   
;;;1670   		bps[4]._vol_u=0;
;;;1671   		bps[4]._vol_i=0;
;;;1672   		bps[4]._flags_tu=1;
;;;1673   
;;;1674   		bps[5]._vol_u=0;
;;;1675   		bps[5]._vol_i=0;
;;;1676   		bps[5]._flags_tu=1;
;;;1677   
;;;1678   		bps[6]._vol_u=0;
;;;1679   		bps[6]._vol_i=0;
;;;1680   		bps[6]._flags_tu=1;
;;;1681   
;;;1682   		bps[7]._vol_u=0;
;;;1683   		bps[7]._vol_i=0;
;;;1684   		bps[7]._flags_tu=1;
;;;1685   
;;;1686   		bps[8]._vol_u=0;
;;;1687   		bps[8]._vol_i=0;
;;;1688   		bps[8]._flags_tu=1;
;;;1689   		
;;;1690   		bps[9]._vol_u=0;
;;;1691   		bps[9]._vol_i=0;
;;;1692   		bps[9]._flags_tu=1;
;;;1693   
;;;1694   		bps[10]._vol_u=0;
;;;1695   		bps[10]._vol_i=0;
;;;1696   		bps[10]._flags_tu=1;
;;;1697   
;;;1698   		bps[11]._vol_u=0;
;;;1699   		bps[11]._vol_i=0;
;;;1700   		bps[11]._flags_tu=1;
;;;1701   
;;;1702   		}
;;;1703   	}
;;;1704   
;;;1705   else if(ind==iTst_pwm)
;;;1706   	{
;;;1707   	char i;
;;;1708   
;;;1709   	for(i=0;i<NUMIST;i++)
;;;1710   		{
;;;1711   		bps[i]._vol_u=tst_pwm_u;
000d00  491c              LDR      r1,|L4.3444|
;;;1712   		bps[i]._vol_i=tst_pwm_i;
000d02  4a20              LDR      r2,|L4.3460|
000d04  2b33              CMP      r3,#0x33              ;1705
000d06  d06a              BEQ      |L4.3550|
;;;1713   		bps[i]._flags_tu=0;
;;;1714   		}
;;;1715   	}
;;;1716   
;;;1717   else if(ind==iK_viz_u)
;;;1718   	{
;;;1719   	char i;
;;;1720   
;;;1721   	if(viz_stat!=vsON)
000d08  f8dfc06c          LDR      r12,|L4.3448|
000d0c  2b45              CMP      r3,#0x45              ;1717
000d0e  d067              BEQ      |L4.3552|
;;;1722   		{
;;;1723   		for(i=0;i<NUMIST;i++)
;;;1724   			{
;;;1725   			bps[i]._vol_u=1022;
;;;1726   			bps[i]._vol_i=1022;
;;;1727   			bps[i]._flags_tu=0;
;;;1728   			}
;;;1729   		}
;;;1730   	else 
;;;1731   		{
;;;1732   		for(i=0;i<NUMIST;i++)
;;;1733   			{
;;;1734   			bps[i]._vol_u=tst_pwm_u;
;;;1735   			bps[i]._vol_i=tst_pwm_i;
;;;1736   			bps[i]._flags_tu=0;
;;;1737   			}
;;;1738   		}
;;;1739   	}
;;;1740   
;;;1741   else if(ind==iK_viz_i)
000d10  2b44              CMP      r3,#0x44
000d12  d066              BEQ      |L4.3554|
;;;1742   	{
;;;1743   	char i;
;;;1744   
;;;1745   	if(viz_stat!=vsON)
;;;1746   		{
;;;1747   		for(i=0;i<NUMIST;i++)
;;;1748   			{
;;;1749   			bps[i]._vol_u=1022;
;;;1750   			bps[i]._vol_i=1022;
;;;1751   			bps[i]._flags_tu=0;
;;;1752   			}
;;;1753   		}
;;;1754   	else 
;;;1755   		{
;;;1756   		for(i=0;i<NUMIST;i++)
;;;1757   			{
;;;1758   			bps[i]._vol_u=tst_pwm_u;
;;;1759   			bps[i]._vol_i=tst_pwm_i;
;;;1760   			bps[i]._flags_tu=0;
;;;1761   			}
;;;1762   		}
;;;1763   	}
;;;1764   
;;;1765   else if(work_stat==wsGS)
000d14  f8991000          LDRB     r1,[r9,#0]  ; work_stat
;;;1766   	{
;;;1767   	signed long temp_SL_U,temp_SL_I;
;;;1768   	
;;;1769   	if((CURR_FADE_IN) && (time_proc<CURR_FADE_IN))
;;;1770   		{
;;;1771   		signed long temp_SL_;
;;;1772   		
;;;1773   		temp_SL_=	(signed long)I_ug_temp;
;;;1774   		temp_SL_*= (signed long)time_proc;
;;;1775   		temp_SL_/= (signed long)CURR_FADE_IN;
;;;1776   
;;;1777   		//I_ug_temp= (signed short)((signed long)I_ug_temp*(signed long)time_proc)/(signed long)CURR_FADE_IN;
;;;1778   
;;;1779   		I_ug_temp= (signed short)temp_SL_;
;;;1780   		}	
;;;1781   	
;;;1782   	if(b1Hz_sh) {
;;;1783   
;;;1784   
;;;1785   
;;;1786   
;;;1787   		if(!((REV_IS_ON)&&(AVT_REV_IS_ON)&&((proc_phase==ppFF_P_REW)||(proc_phase==ppREW_P_FF)))) {
;;;1788   	 		if(load_I<I_ug_temp)_x_++;
;;;1789      			else if(load_I>I_ug_temp)_x_--;
;;;1790   			//gran(&_x_,-temp_SL_I,1022-temp_SL_I);
;;;1791   			gran(&_x_,-50,50); 
;;;1792   
;;;1793   	 		if(load_U<U_maxg)_xu_++;
000d18  f8df90bc          LDR      r9,|L4.3544|
000d1c  e062              B        |L4.3556|
                  |L4.3358|
000d1e  e06e              B        |L4.3582|
                  |L4.3360|
000d20  e06f              B        |L4.3586|
                  |L4.3362|
000d22  e070              B        |L4.3590|
                  |L4.3364|
000d24  e074              B        |L4.3600|
                  |L4.3366|
000d26  e075              B        |L4.3604|
                  |L4.3368|
                          DCD      CAP_TIME_SEC
                  |L4.3372|
                          DCD      CAP_TIME_MIN
                  |L4.3376|
                          DCD      CAP_TIME_HOUR
                  |L4.3380|
                          DCD      work_stat
                  |L4.3384|
                          DCD      time_proc
                  |L4.3388|
                          DCD      T_PROC_GS
                  |L4.3392|
                          DCD      time_proc_remain
                  |L4.3396|
                          DCD      ||area_number.24||
                  |L4.3400|
                          DCD      REV_IS_ON
                  |L4.3404|
                          DCD      AVT_REV_IS_ON
                  |L4.3408|
                          DCD      time_proc_phase
                  |L4.3412|
                          DCD      proc_phase
                  |L4.3416|
                          DCD      REV_STAT
                  |L4.3420|
                          DCD      milliAmperSecunda
                  |L4.3424|
                          DCD      AMPERCHAS
                  |L4.3428|
                          DCD      T_PROC_PS
                  |L4.3432|
                          DCD      cap_time_proc
                  |L4.3436|
                          DCD      CAP_COUNTER
                  |L4.3440|
                          DCD      a_ind
                  |L4.3444|
                          DCD      tst_pwm_u
                  |L4.3448|
                          DCD      viz_stat
                  |L4.3452|
                          DCD      viz_stat_cnt
                  |L4.3456|
                          DCD      0xffffabcd
                  |L4.3460|
                          DCD      tst_pwm_i
                  |L4.3464|
                          DCD      load_U
                  |L4.3468|
                          DCD      load_I
                  |L4.3472|
                          DCD      AVT_REV_I_NOM_FF
                  |L4.3476|
                          DCD      AVT_REV_U_NOM_FF
                  |L4.3480|
                          DCD      U_up_temp
                  |L4.3484|
                          DCD      I_ug_temp
                  |L4.3488|
                          DCD      AVT_REV_I_NOM_REW
                  |L4.3492|
                          DCD      AVT_REV_U_NOM_REW
                  |L4.3496|
                          DCD      fiks_stat_I
                  |L4.3500|
                          DCD      I_ug
                  |L4.3504|
                          DCD      fiks_stat_U
                  |L4.3508|
                          DCD      U_up
                  |L4.3512|
                          DCD      I_MAX_IPS
                  |L4.3516|
                          DCD      I_MIN_IPS
                  |L4.3520|
                          DCD      U_MAX
                  |L4.3524|
                          DCD      U_MIN
                  |L4.3528|
                          DCD      bps_stat
                  |L4.3532|
                          DCD      phase
                  |L4.3536|
                          DCD      bps
                  |L4.3540|
                          DCD      NUMIST
                  |L4.3544|
                          DCD      _xu_
                  |L4.3548|
000ddc  e075              B        |L4.3786|
                  |L4.3550|
000dde  e125              B        |L4.4140|
                  |L4.3552|
000de0  e13b              B        |L4.4186|
                  |L4.3554|
000de2  e16a              B        |L4.4282|
                  |L4.3556|
000de4  f8dfb410          LDR      r11,|L4.4600|
000de8  2901              CMP      r1,#1                 ;1765
000dea  d074              BEQ      |L4.3798|
;;;1794      			else if(load_U>U_maxg)_xu_--;
;;;1795   			//gran(&_x_,-temp_SL_U,1022-temp_SL_U);
;;;1796   			gran(&_xu_,-50,50); 
;;;1797   		}
;;;1798   	}
;;;1799   
;;;1800   	temp_SL_U=1022;
;;;1801   	temp_SL_U*=(signed long)U_maxg;
;;;1802   	temp_SL_U/=(signed long)U_MAX;
;;;1803   
;;;1804   	temp_SL_I=1022;
;;;1805   	//temp_SL_I*=NUMIST;
;;;1806   	temp_SL_I*=(signed long)I_ug_temp;
;;;1807   	temp_SL_I/=(signed long)I_MAX_IPS;
;;;1808   
;;;1809   	if(lc640_read_int(EE_U_CURVE_IS_ON)==0xabcd)
;;;1810   		{
;;;1811   		temp_SL_U=find_U_curve(U_maxg)*5;
;;;1812   		}
;;;1813   	 
;;;1814   	if(lc640_read_int(EE_I_CURVE_IS_ON)==0xabcd)
;;;1815   		{
;;;1816   		temp_SL_I=find_I_curve(I_ug_temp)*5;
;;;1817   		}
;;;1818   
;;;1819   	for(i=0;i<NUMIST;i++)
;;;1820   		{
;;;1821   		if((REV_IS_ON)&&(AVT_REV_IS_ON)&&((proc_phase==ppFF_P_REW)||(proc_phase==ppREW_P_FF))) {
;;;1822   		 	bps[i]._vol_u=0;
;;;1823   			bps[i]._vol_i=0;
;;;1824   			bps[i]._flags_tu=1;
;;;1825   		} else {
;;;1826   			bps[i]._vol_u=(short)temp_SL_U + _xu_/*+bps[i]._xu_*/;
;;;1827   			if(bps[i]._vol_u<0)bps[i]._vol_u=0;
;;;1828   			if(bps[i]._vol_u>1022)bps[i]._vol_u=1022;
;;;1829   			bps[i]._vol_i=((short)temp_SL_I + _x_);///NUMIST;
;;;1830   			if(bps[i]._vol_i<0)bps[i]._vol_i=0;
;;;1831   			if(bps[i]._vol_i>1022)bps[i]._vol_i=1022;
;;;1832   			bps[i]._flags_tu=0;
;;;1833   		}
;;;1834   	}
;;;1835   
;;;1836   	}
;;;1837   else if(work_stat==wsPS)
000dec  2902              CMP      r1,#2
000dee  d073              BEQ      |L4.3800|
;;;1838   	{
;;;1839   	signed long temp_SL_U,temp_SL_I;
;;;1840   	/*	U_up_d=U_up/100;
;;;1841   	if(U_up_d<5) U_up_d=5;
;;;1842   	*/
;;;1843   	if(load_U_>5)bU_VALID=1;
;;;1844   	else bU_VALID=0;
;;;1845   
;;;1846   	temp_SL_U=(long)U_up_temp/100L;
;;;1847   	if(temp_SL_U<=0)temp_SL_U=1;
;;;1848   	if((abs(load_U_-U_up_temp))<(signed short)temp_SL_U) bU_VALID_VALID=1;
;;;1849   	else bU_VALID_VALID=0;
;;;1850   /*	if( (load_U_>(U_up-U_up_d))&&(load_U_<(U_up+U_up_d)) )bFAST_REG=0;
;;;1851   	else bFAST_REG=1;*/
;;;1852   
;;;1853   	bFAST_REG=0;
;;;1854   
;;;1855   	if(bU_VALID_VALID)
;;;1856   		{
;;;1857   		if(bPRECESSION_REG)
;;;1858   			{
;;;1859   			bPRECESSION_REG=0;
;;;1860   			if(load_U_<U_up_temp)_xu_++;
;;;1861      			else if(load_U_>U_up_temp)_xu_--;
;;;1862   			gran(&_xu_,-50,50);
;;;1863   			}
;;;1864   		}
;;;1865   	else if((b1Hz_sh&&bU_VALID)||(bFAST_REG&&bU_VALID))
;;;1866   		{
;;;1867   	 	if(load_I<I_maxp)_x_++;
;;;1868      		else if(load_I>I_maxp)_x_--;
;;;1869   		gran(&_x_,-50,50); 
;;;1870   
;;;1871   	 	if(load_U_<U_up_temp)_xu_++;
;;;1872      		else if(load_U_>U_up_temp)_xu_--;
;;;1873   		gran(&_xu_,-50,50); 
;;;1874   
;;;1875   		}
;;;1876   
;;;1877   
;;;1878   	temp_SL_U=900;
;;;1879   	temp_SL_U*=(signed long)U_up_temp;
;;;1880   	temp_SL_U/=(signed long)U_MAX;
;;;1881   	temp_SL_U+=50;
;;;1882   
;;;1883   	if(lc640_read_int(EE_U_CURVE_IS_ON)==0xabcd)
;;;1884   		{	
;;;1885   		temp_SL_U=find_U_curve(U_up_temp)*5;
;;;1886   		}
;;;1887   	//temp_SL_U=lc640_read_int(SEKTOR_KURVE_U+(temp_SL_U*2));
;;;1888   	 
;;;1889   	temp_SL_I=1022;
;;;1890   	//temp_SL_I*=NUMIST;
;;;1891   	temp_SL_I*=(signed long)I_maxp;
;;;1892   	temp_SL_I/=(signed long)I_MAX_IPS;
;;;1893   
;;;1894   	if(lc640_read_int(EE_I_CURVE_IS_ON)==0xabcd)
;;;1895   		{
;;;1896   		temp_SL_I=find_I_curve(I_maxp)*5;
;;;1897   		}
;;;1898   
;;;1899   	for(i=0;i<NUMIST;i++) {
;;;1900   
;;;1901   		if((REV_IS_ON)&&(AVT_REV_IS_ON)&&((proc_phase==ppFF_P_REW)||(proc_phase==ppREW_P_FF))) {
;;;1902   		 	bps[i]._vol_u=0;
;;;1903   			bps[i]._vol_i=0;
;;;1904   			bps[i]._flags_tu=1;
;;;1905   		} else {
;;;1906   			bps[i]._vol_u=(short)temp_SL_U + _xu_+bps[i]._xu_;
;;;1907   			if(bps[i]._vol_u<0)bps[i]._vol_u=0;
;;;1908   			if(bps[i]._vol_u>1022)bps[i]._vol_u=1022;
;;;1909   			bps[i]._vol_i=((short)temp_SL_I + _x_);///NUMIST;
;;;1910   			if(bps[i]._vol_i<0)bps[i]._vol_i=0;
;;;1911   			if(bps[i]._vol_i>1022)bps[i]._vol_i=1022;
;;;1912   			bps[i]._flags_tu=0;
;;;1913   		}
;;;1914   	}
;;;1915   
;;;1916   
;;;1917   /*	for(i=0;i<NUMIST;i++)
;;;1918   		{
;;;1919   		bps[i]._vol_u=(short)temp_SL_U + _xu_;
;;;1920   	 	bps[i]._vol_i=((short)temp_SL_I+ _x_);//NUMIST;
;;;1921   		bps[i]._flags_tu=0;
;;;1922   		}*/
;;;1923   	//bps[0]._vol_i+= _x_;
;;;1924   	plazma_vol_u_0=temp_SL_U;
;;;1925   	plazma_vol_u_1=bps[0]._vol_u;
;;;1926   	}
;;;1927   
;;;1928   else if(work_stat==wsCAP)
000df0  2903              CMP      r1,#3
000df2  d072              BEQ      |L4.3802|
;;;1929   	{
;;;1930   	signed long temp_SL_U=0,temp_SL_I=0;
;;;1931   
;;;1932   
;;;1933   
;;;1934   
;;;1935   
;;;1936   
;;;1937   	if(b1Hz_sh) {
;;;1938   		if(!bOFF) {
;;;1939   	 		if(load_I<(CAP_WRK_CURR*10))_x_++;
;;;1940      			else if(load_I>(CAP_WRK_CURR*10))_x_--;
;;;1941   			gran(&_x_,-temp_SL_I,1022-temp_SL_I);
;;;1942   			gran(&_x_,-50,50); 
;;;1943   
;;;1944   	 		if(load_U<(CAP_MAX_VOLT*10))_xu_++;
;;;1945      			else if(load_U>(CAP_MAX_VOLT*10))_xu_--;
;;;1946   			gran(&_x_,-temp_SL_U,1022-temp_SL_U);
;;;1947   			gran(&_xu_,-50,50); 
;;;1948   		}
;;;1949   	}
;;;1950   
;;;1951   	temp_SL_U=10220L;
;;;1952   	temp_SL_U*=(signed long)CAP_MAX_VOLT;
;;;1953   	temp_SL_U/=(signed long)U_MAX;
;;;1954   
;;;1955   	temp_SL_I=10220L;
;;;1956   	//temp_SL_I*=NUMIST;
;;;1957   	temp_SL_I*=(signed long)CAP_WRK_CURR;
;;;1958   	temp_SL_I/=(signed long)I_MAX_IPS;
;;;1959   
;;;1960   	if(lc640_read_int(EE_U_CURVE_IS_ON)==0xabcd)
;;;1961   		{
;;;1962   		temp_SL_U=find_U_curve(CAP_MAX_VOLT*10)*5;
;;;1963   		}
;;;1964   	 
;;;1965   	if(lc640_read_int(EE_I_CURVE_IS_ON)==0xabcd)
;;;1966   		{
;;;1967   		temp_SL_I=find_I_curve(CAP_WRK_CURR*10)*5;
;;;1968   		} 
;;;1969   
;;;1970   //temp_SL_U=1000;
;;;1971   
;;;1972   	for(i=0;i<NUMIST;i++)
;;;1973   		{
;;;1974   		if(bOFF) {
;;;1975   		 	bps[i]._vol_u=0;
;;;1976   			bps[i]._vol_i=0;
;;;1977   			bps[i]._flags_tu=1;
;;;1978   		} else {
;;;1979   			bps[i]._vol_u=(short)temp_SL_U + _xu_;
;;;1980   			if(bps[i]._vol_u<0)bps[i]._vol_u=0;
;;;1981   			if(bps[i]._vol_u>1022)bps[i]._vol_u=1022;
;;;1982   			bps[i]._vol_i=((short)temp_SL_I + _x_);///NUMIST;
;;;1983   			if(bps[i]._vol_i<0)bps[i]._vol_i=0;
;;;1984   			if(bps[i]._vol_i>1022)bps[i]._vol_i=1022;
;;;1985   			bps[i]._flags_tu=0;
;;;1986   		}
;;;1987   	}
;;;1988   
;;;1989   	}
;;;1990   else 
;;;1991   	{
;;;1992   	bps_stat=stOFF;
000df4  7005              STRB     r5,[r0,#0]
;;;1993   
;;;1994   	for(i=0;i<NUMIST;i++)
000df6  2000              MOVS     r0,#0
000df8  f9b82000          LDRSH    r2,[r8,#0]            ;1411
000dfc  e3f1              B        |L4.5602|
                  |L4.3582|
000dfe  48ff              LDR      r0,|L4.4604|
000e00  e73a              B        |L4.3192|
                  |L4.3586|
000e02  48ff              LDR      r0,|L4.4608|
000e04  e738              B        |L4.3192|
                  |L4.3590|
000e06  48ff              LDR      r0,|L4.4612|
                  |L4.3592|
000e08  8801              LDRH     r1,[r0,#0]            ;1368  ; AVT_REV_U_NOM_REW
000e0a  48ff              LDR      r0,|L4.4616|
                  |L4.3596|
000e0c  8001              STRH     r1,[r0,#0]            ;1379
000e0e  e741              B        |L4.3220|
                  |L4.3600|
000e10  48fe              LDR      r0,|L4.4620|
000e12  e73c              B        |L4.3214|
                  |L4.3604|
000e14  f9911001          LDRSB    r1,[r1,#1]            ;1405  ; a_ind
000e18  b139              CBZ      r1,|L4.3626|
000e1a  2901              CMP      r1,#1                 ;1418
000e1c  d01f              BEQ      |L4.3678|
000e1e  7005              STRB     r5,[r0,#0]            ;1449
000e20  62e5              STR      r5,[r4,#0x2c]         ;1452  ; bps
000e22  6325              STR      r5,[r4,#0x30]         ;1453  ; bps
000e24  f8846028          STRB     r6,[r4,#0x28]         ;1453
000e28  e265              B        |L4.4854|
                  |L4.3626|
000e2a  f8a7a010          STRH     r10,[r7,#0x10]        ;1407
000e2e  f8a7a012          STRH     r10,[r7,#0x12]        ;1408
000e32  7006              STRB     r6,[r0,#0]            ;1409
000e34  4651              MOV      r1,r10                ;1407
000e36  2000              MOVS     r0,#0                 ;1411
000e38  f9b82000          LDRSH    r2,[r8,#0]            ;1411
000e3c  e00c              B        |L4.3672|
000e3e  bf00              NOP                            ;1413
                  |L4.3648|
000e40  ebc003c0          RSB      r3,r0,r0,LSL #3       ;1413
000e44  eb030343          ADD      r3,r3,r3,LSL #1       ;1413
000e48  eb040383          ADD      r3,r4,r3,LSL #2       ;1413
000e4c  1c40              ADDS     r0,r0,#1              ;1411
000e4e  62d9              STR      r1,[r3,#0x2c]         ;1414
000e50  6319              STR      r1,[r3,#0x30]         ;1415
000e52  f8835028          STRB     r5,[r3,#0x28]         ;1415
000e56  b2c0              UXTB     r0,r0                 ;1411
                  |L4.3672|
000e58  4290              CMP      r0,r2                 ;1411
000e5a  dbf1              BLT      |L4.3648|
000e5c  e24b              B        |L4.4854|
                  |L4.3678|
000e5e  7811              LDRB     r1,[r2,#0]            ;1420  ; phase
000e60  b111              CBZ      r1,|L4.3688|
000e62  2901              CMP      r1,#1                 ;1433
000e64  d017              BEQ      |L4.3734|
000e66  e246              B        |L4.4854|
                  |L4.3688|
000e68  823d              STRH     r5,[r7,#0x10]         ;1422
000e6a  827d              STRH     r5,[r7,#0x12]         ;1423
000e6c  7005              STRB     r5,[r0,#0]            ;1424
000e6e  2000              MOVS     r0,#0                 ;1426
000e70  f9b82000          LDRSH    r2,[r8,#0]            ;1411
000e74  e00c              B        |L4.3728|
000e76  bf00              NOP                            ;1428
                  |L4.3704|
000e78  ebc001c0          RSB      r1,r0,r0,LSL #3       ;1428
000e7c  eb010141          ADD      r1,r1,r1,LSL #1       ;1428
000e80  eb040181          ADD      r1,r4,r1,LSL #2       ;1428
000e84  1c40              ADDS     r0,r0,#1              ;1426
000e86  62cd              STR      r5,[r1,#0x2c]         ;1429
000e88  630d              STR      r5,[r1,#0x30]         ;1430
000e8a  f8816028          STRB     r6,[r1,#0x28]         ;1430
000e8e  b2c0              UXTB     r0,r0                 ;1426
                  |L4.3728|
000e90  4290              CMP      r0,r2                 ;1426
000e92  dbf1              BLT      |L4.3704|
000e94  e22f              B        |L4.4854|
                  |L4.3734|
000e96  f8a7a010          STRH     r10,[r7,#0x10]        ;1435
000e9a  f8a7a012          STRH     r10,[r7,#0x12]        ;1436
000e9e  7006              STRB     r6,[r0,#0]            ;1437
000ea0  4651              MOV      r1,r10                ;1435
000ea2  2000              MOVS     r0,#0                 ;1439
000ea4  f9b82000          LDRSH    r2,[r8,#0]            ;1411
000ea8  e00c              B        |L4.3780|
000eaa  bf00              NOP                            ;1441
                  |L4.3756|
000eac  ebc003c0          RSB      r3,r0,r0,LSL #3       ;1441
000eb0  eb030343          ADD      r3,r3,r3,LSL #1       ;1441
000eb4  eb040383          ADD      r3,r4,r3,LSL #2       ;1441
000eb8  1c40              ADDS     r0,r0,#1              ;1439
000eba  62d9              STR      r1,[r3,#0x2c]         ;1442
000ebc  6319              STR      r1,[r3,#0x30]         ;1443
000ebe  f8835028          STRB     r5,[r3,#0x28]         ;1443
000ec2  b2c0              UXTB     r0,r0                 ;1439
                  |L4.3780|
000ec4  4290              CMP      r0,r2                 ;1439
000ec6  dbf1              BLT      |L4.3756|
000ec8  e3fe              B        |L4.5832|
                  |L4.3786|
000eca  f9913001          LDRSB    r3,[r1,#1]            ;1458  ; a_ind
000ece  b12b              CBZ      r3,|L4.3804|
000ed0  2b03              CMP      r3,#3                 ;1521
000ed2  d05d              BEQ      |L4.3984|
000ed4  e063              B        |L4.3998|
                  |L4.3798|
000ed6  e120              B        |L4.4378|
                  |L4.3800|
000ed8  e20e              B        |L4.4856|
                  |L4.3802|
000eda  e2fa              B        |L4.5330|
                  |L4.3804|
000edc  f8a7a010          STRH     r10,[r7,#0x10]        ;1460
000ee0  f8a7a012          STRH     r10,[r7,#0x12]        ;1461
000ee4  f1040428          ADD      r4,r4,#0x28           ;1462
000ee8  7006              STRB     r6,[r0,#0]            ;1462
000eea  6065              STR      r5,[r4,#4]            ;1465  ; bps
000eec  60a5              STR      r5,[r4,#8]            ;1466  ; bps
000eee  7026              STRB     r6,[r4,#0]            ;1466
000ef0  65a5              STR      r5,[r4,#0x58]         ;1469  ; bps
000ef2  65e5              STR      r5,[r4,#0x5c]         ;1470  ; bps
000ef4  f8846054          STRB     r6,[r4,#0x54]         ;1470
000ef8  f8c450ac          STR      r5,[r4,#0xac]         ;1477  ; bps
000efc  f8c450b0          STR      r5,[r4,#0xb0]         ;1478  ; bps
000f00  f88460a8          STRB     r6,[r4,#0xa8]         ;1478
000f04  f8c45100          STR      r5,[r4,#0x100]        ;1481  ; bps
000f08  f8c45104          STR      r5,[r4,#0x104]        ;1482  ; bps
000f0c  f88460fc          STRB     r6,[r4,#0xfc]         ;1482
000f10  f8c45154          STR      r5,[r4,#0x154]        ;1485  ; bps
000f14  f8c45158          STR      r5,[r4,#0x158]        ;1486  ; bps
000f18  f8846150          STRB     r6,[r4,#0x150]        ;1486
000f1c  f8c451a8          STR      r5,[r4,#0x1a8]        ;1489  ; bps
000f20  f8c451ac          STR      r5,[r4,#0x1ac]        ;1490  ; bps
000f24  f88461a4          STRB     r6,[r4,#0x1a4]        ;1490
000f28  f8c451fc          STR      r5,[r4,#0x1fc]        ;1493  ; bps
000f2c  f8c45200          STR      r5,[r4,#0x200]        ;1494  ; bps
000f30  f88461f8          STRB     r6,[r4,#0x1f8]        ;1494
000f34  f8c45250          STR      r5,[r4,#0x250]        ;1497  ; bps
000f38  f8c45254          STR      r5,[r4,#0x254]        ;1498  ; bps
000f3c  f884624c          STRB     r6,[r4,#0x24c]        ;1498
000f40  f8c452a4          STR      r5,[r4,#0x2a4]        ;1501  ; bps
000f44  f8c452a8          STR      r5,[r4,#0x2a8]        ;1502  ; bps
000f48  f88462a0          STRB     r6,[r4,#0x2a0]        ;1502
000f4c  f8c452f8          STR      r5,[r4,#0x2f8]        ;1505  ; bps
000f50  f8c452fc          STR      r5,[r4,#0x2fc]        ;1506  ; bps
000f54  f88462f4          STRB     r6,[r4,#0x2f4]        ;1506
000f58  f8c4534c          STR      r5,[r4,#0x34c]        ;1509  ; bps
000f5c  f8c45350          STR      r5,[r4,#0x350]        ;1510  ; bps
000f60  f8846348          STRB     r6,[r4,#0x348]        ;1510
000f64  f8c453a0          STR      r5,[r4,#0x3a0]        ;1513  ; bps
000f68  f8c453a4          STR      r5,[r4,#0x3a4]        ;1514  ; bps
000f6c  f884639c          STRB     r6,[r4,#0x39c]        ;1514
000f70  f9910002          LDRSB    r0,[r1,#2]            ;1516  ; a_ind
000f74  f1a40428          SUB      r4,r4,#0x28           ;1514
000f78  ebc000c0          RSB      r0,r0,r0,LSL #3       ;1516
000f7c  eb000040          ADD      r0,r0,r0,LSL #1       ;1516
000f80  eb040080          ADD      r0,r4,r0,LSL #2       ;1516
000f84  4652              MOV      r2,r10                ;1460
000f86  62c2              STR      r2,[r0,#0x2c]         ;1517
000f88  6302              STR      r2,[r0,#0x30]         ;1518
000f8a  f8805028          STRB     r5,[r0,#0x28]         ;1518
000f8e  e39b              B        |L4.5832|
                  |L4.3984|
000f90  7812              LDRB     r2,[r2,#0]            ;1523  ; phase
000f92  b112              CBZ      r2,|L4.3994|
000f94  2a01              CMP      r2,#1                 ;1581
000f96  d0a1              BEQ      |L4.3804|
000f98  e396              B        |L4.5832|
                  |L4.3994|
000f9a  823d              STRH     r5,[r7,#0x10]         ;1525
000f9c  827d              STRH     r5,[r7,#0x12]         ;1526
                  |L4.3998|
000f9e  f1040428          ADD      r4,r4,#0x28           ;1648
000fa2  7005              STRB     r5,[r0,#0]            ;1648
000fa4  6065              STR      r5,[r4,#4]            ;1651  ; bps
000fa6  60a5              STR      r5,[r4,#8]            ;1652  ; bps
000fa8  7026              STRB     r6,[r4,#0]            ;1652
000faa  65a5              STR      r5,[r4,#0x58]         ;1655  ; bps
000fac  65e5              STR      r5,[r4,#0x5c]         ;1656  ; bps
000fae  f8846054          STRB     r6,[r4,#0x54]         ;1656
000fb2  f8c450ac          STR      r5,[r4,#0xac]         ;1663  ; bps
000fb6  f8c450b0          STR      r5,[r4,#0xb0]         ;1664  ; bps
000fba  f88460a8          STRB     r6,[r4,#0xa8]         ;1664
000fbe  f8c45100          STR      r5,[r4,#0x100]        ;1667  ; bps
000fc2  f8c45104          STR      r5,[r4,#0x104]        ;1668  ; bps
000fc6  f88460fc          STRB     r6,[r4,#0xfc]         ;1668
000fca  f8c45154          STR      r5,[r4,#0x154]        ;1671  ; bps
000fce  f8c45158          STR      r5,[r4,#0x158]        ;1672  ; bps
000fd2  f8846150          STRB     r6,[r4,#0x150]        ;1672
000fd6  f8c451a8          STR      r5,[r4,#0x1a8]        ;1675  ; bps
000fda  f8c451ac          STR      r5,[r4,#0x1ac]        ;1676  ; bps
000fde  f88461a4          STRB     r6,[r4,#0x1a4]        ;1676
000fe2  f8c451fc          STR      r5,[r4,#0x1fc]        ;1679  ; bps
000fe6  f8c45200          STR      r5,[r4,#0x200]        ;1680  ; bps
000fea  f88461f8          STRB     r6,[r4,#0x1f8]        ;1680
000fee  f8c45250          STR      r5,[r4,#0x250]        ;1683  ; bps
000ff2  f8c45254          STR      r5,[r4,#0x254]        ;1684  ; bps
000ff6  f884624c          STRB     r6,[r4,#0x24c]        ;1684
000ffa  f8c452a4          STR      r5,[r4,#0x2a4]        ;1687  ; bps
000ffe  f8c452a8          STR      r5,[r4,#0x2a8]        ;1688  ; bps
001002  f88462a0          STRB     r6,[r4,#0x2a0]        ;1688
001006  f8c452f8          STR      r5,[r4,#0x2f8]        ;1691  ; bps
00100a  f8c452fc          STR      r5,[r4,#0x2fc]        ;1692  ; bps
00100e  f88462f4          STRB     r6,[r4,#0x2f4]        ;1692
001012  f8c4534c          STR      r5,[r4,#0x34c]        ;1695  ; bps
001016  f8c45350          STR      r5,[r4,#0x350]        ;1696  ; bps
00101a  f8846348          STRB     r6,[r4,#0x348]        ;1696
00101e  f8c453a0          STR      r5,[r4,#0x3a0]        ;1699  ; bps
001022  f8c453a4          STR      r5,[r4,#0x3a4]        ;1700  ; bps
001026  f884639c          STRB     r6,[r4,#0x39c]        ;1700
00102a  e34d              B        |L4.5832|
                  |L4.4140|
00102c  2000              MOVS     r0,#0                 ;1709
00102e  f9b11000          LDRSH    r1,[r1,#0]            ;1711
001032  f9b22000          LDRSH    r2,[r2,#0]            ;1712
001036  f9b83000          LDRSH    r3,[r8,#0]            ;1411
00103a  e00b              B        |L4.4180|
                  |L4.4156|
00103c  ebc006c0          RSB      r6,r0,r0,LSL #3       ;1711
001040  eb060646          ADD      r6,r6,r6,LSL #1       ;1711
001044  eb040686          ADD      r6,r4,r6,LSL #2       ;1711
001048  1c40              ADDS     r0,r0,#1              ;1709
00104a  e9c6120b          STRD     r1,r2,[r6,#0x2c]      ;1711
00104e  f8865028          STRB     r5,[r6,#0x28]         ;1713
001052  b2c0              UXTB     r0,r0                 ;1709
                  |L4.4180|
001054  4298              CMP      r0,r3                 ;1709
001056  dbf1              BLT      |L4.4156|
001058  e336              B        |L4.5832|
                  |L4.4186|
00105a  f89c0000          LDRB     r0,[r12,#0]           ;1721  ; viz_stat
00105e  2801              CMP      r0,#1                 ;1721
001060  f04f0000          MOV      r0,#0                 ;1732
001064  d013              BEQ      |L4.4238|
001066  4651              MOV      r1,r10                ;1407
001068  f9b82000          LDRSH    r2,[r8,#0]            ;1411
00106c  e00c              B        |L4.4232|
00106e  bf00              NOP                            ;1725
                  |L4.4208|
001070  ebc003c0          RSB      r3,r0,r0,LSL #3       ;1725
001074  eb030343          ADD      r3,r3,r3,LSL #1       ;1725
001078  eb040383          ADD      r3,r4,r3,LSL #2       ;1725
00107c  1c40              ADDS     r0,r0,#1              ;1723
00107e  62d9              STR      r1,[r3,#0x2c]         ;1726
001080  6319              STR      r1,[r3,#0x30]         ;1727
001082  f8835028          STRB     r5,[r3,#0x28]         ;1727
001086  b2c0              UXTB     r0,r0                 ;1723
                  |L4.4232|
001088  4290              CMP      r0,r2                 ;1723
00108a  dbf1              BLT      |L4.4208|
00108c  e31c              B        |L4.5832|
                  |L4.4238|
00108e  f9b11000          LDRSH    r1,[r1,#0]            ;1711
001092  f9b22000          LDRSH    r2,[r2,#0]            ;1712
001096  f9b83000          LDRSH    r3,[r8,#0]            ;1411
00109a  e00b              B        |L4.4276|
                  |L4.4252|
00109c  ebc006c0          RSB      r6,r0,r0,LSL #3       ;1734
0010a0  eb060646          ADD      r6,r6,r6,LSL #1       ;1734
0010a4  eb040686          ADD      r6,r4,r6,LSL #2       ;1734
0010a8  1c40              ADDS     r0,r0,#1              ;1732
0010aa  e9c6120b          STRD     r1,r2,[r6,#0x2c]      ;1734
0010ae  f8865028          STRB     r5,[r6,#0x28]         ;1736
0010b2  b2c0              UXTB     r0,r0                 ;1732
                  |L4.4276|
0010b4  4298              CMP      r0,r3                 ;1732
0010b6  dbf1              BLT      |L4.4252|
0010b8  e306              B        |L4.5832|
                  |L4.4282|
0010ba  f89c0000          LDRB     r0,[r12,#0]           ;1745  ; viz_stat
0010be  2801              CMP      r0,#1                 ;1745
0010c0  f04f0000          MOV      r0,#0                 ;1756
0010c4  d013              BEQ      |L4.4334|
0010c6  4651              MOV      r1,r10                ;1407
0010c8  f9b83000          LDRSH    r3,[r8,#0]            ;1411
0010cc  e00c              B        |L4.4328|
0010ce  bf00              NOP                            ;1749
                  |L4.4304|
0010d0  ebc002c0          RSB      r2,r0,r0,LSL #3       ;1749
0010d4  eb020242          ADD      r2,r2,r2,LSL #1       ;1749
0010d8  eb040282          ADD      r2,r4,r2,LSL #2       ;1749
0010dc  1c40              ADDS     r0,r0,#1              ;1747
0010de  62d1              STR      r1,[r2,#0x2c]         ;1750
0010e0  6311              STR      r1,[r2,#0x30]         ;1751
0010e2  f8825028          STRB     r5,[r2,#0x28]         ;1751
0010e6  b2c0              UXTB     r0,r0                 ;1747
                  |L4.4328|
0010e8  4298              CMP      r0,r3                 ;1747
0010ea  dbf1              BLT      |L4.4304|
0010ec  e2ec              B        |L4.5832|
                  |L4.4334|
0010ee  f9b11000          LDRSH    r1,[r1,#0]            ;1711
0010f2  f9b22000          LDRSH    r2,[r2,#0]            ;1712
0010f6  f9b83000          LDRSH    r3,[r8,#0]            ;1411
0010fa  e00b              B        |L4.4372|
                  |L4.4348|
0010fc  ebc006c0          RSB      r6,r0,r0,LSL #3       ;1758
001100  eb060646          ADD      r6,r6,r6,LSL #1       ;1758
001104  eb040686          ADD      r6,r4,r6,LSL #2       ;1758
001108  1c40              ADDS     r0,r0,#1              ;1756
00110a  e9c6120b          STRD     r1,r2,[r6,#0x2c]      ;1758
00110e  f8865028          STRB     r5,[r6,#0x28]         ;1760
001112  b2c0              UXTB     r0,r0                 ;1756
                  |L4.4372|
001114  4298              CMP      r0,r3                 ;1756
001116  dbf1              BLT      |L4.4348|
001118  e2d6              B        |L4.5832|
                  |L4.4378|
00111a  483d              LDR      r0,|L4.4624|
00111c  f9b01000          LDRSH    r1,[r0,#0]            ;1769  ; CURR_FADE_IN
001120  b151              CBZ      r1,|L4.4408|
001122  483c              LDR      r0,|L4.4628|
001124  6803              LDR      r3,[r0,#0]            ;1769  ; time_proc
001126  428b              CMP      r3,r1                 ;1769
001128  da06              BGE      |L4.4408|
00112a  483b              LDR      r0,|L4.4632|
00112c  f9b02000          LDRSH    r2,[r0,#0]            ;1773  ; I_ug_temp
001130  435a              MULS     r2,r3,r2              ;1774
001132  fb92f1f1          SDIV     r1,r2,r1              ;1775
001136  8001              STRH     r1,[r0,#0]            ;1779
                  |L4.4408|
001138  79b8              LDRB     r0,[r7,#6]            ;1782  ; b1Hz_sh
00113a  b388              CBZ      r0,|L4.4512|
00113c  4837              LDR      r0,|L4.4636|
00113e  8800              LDRH     r0,[r0,#0]            ;1787  ; REV_IS_ON
001140  b140              CBZ      r0,|L4.4436|
001142  4837              LDR      r0,|L4.4640|
001144  8800              LDRH     r0,[r0,#0]            ;1787  ; AVT_REV_IS_ON
001146  b128              CBZ      r0,|L4.4436|
001148  4836              LDR      r0,|L4.4644|
00114a  7800              LDRB     r0,[r0,#0]            ;1787  ; proc_phase
00114c  2801              CMP      r0,#1                 ;1787
00114e  d034              BEQ      |L4.4538|
001150  2803              CMP      r0,#3                 ;1787
001152  d032              BEQ      |L4.4538|
                  |L4.4436|
001154  4834              LDR      r0,|L4.4648|
001156  f9b01000          LDRSH    r1,[r0,#0]            ;1788  ; load_I
00115a  482f              LDR      r0,|L4.4632|
00115c  f9b00000          LDRSH    r0,[r0,#0]            ;1788  ; I_ug_temp
001160  4281              CMP      r1,r0                 ;1788
001162  da04              BGE      |L4.4462|
001164  f8bb1000          LDRH     r1,[r11,#0]           ;1788  ; _x_
001168  f1010101          ADD      r1,r1,#1              ;1788
00116c  e004              B        |L4.4472|
                  |L4.4462|
00116e  dd05              BLE      |L4.4476|
001170  f8bb1000          LDRH     r1,[r11,#0]           ;1789  ; _x_
001174  f1a10101          SUB      r1,r1,#1              ;1789
                  |L4.4472|
001178  f8ab1000          STRH     r1,[r11,#0]           ;1789
                  |L4.4476|
00117c  2232              MOVS     r2,#0x32              ;1791
00117e  4251              RSBS     r1,r2,#0              ;1791
001180  481d              LDR      r0,|L4.4600|
001182  f7fffffe          BL       gran
001186  4829              LDR      r0,|L4.4652|
001188  f9b01000          LDRSH    r1,[r0,#0]            ;1793  ; load_U
00118c  4828              LDR      r0,|L4.4656|
00118e  f9b00000          LDRSH    r0,[r0,#0]            ;1793  ; U_maxg
001192  4281              CMP      r1,r0                 ;1793
001194  da05              BGE      |L4.4514|
001196  f8b91000          LDRH     r1,[r9,#0]            ;1793  ; _xu_
00119a  f1010101          ADD      r1,r1,#1              ;1793
00119e  e005              B        |L4.4524|
                  |L4.4512|
0011a0  e00b              B        |L4.4538|
                  |L4.4514|
0011a2  dd05              BLE      |L4.4528|
0011a4  f8b91000          LDRH     r1,[r9,#0]            ;1794  ; _xu_
0011a8  f1a10101          SUB      r1,r1,#1              ;1794
                  |L4.4524|
0011ac  f8a91000          STRH     r1,[r9,#0]            ;1794
                  |L4.4528|
0011b0  2232              MOVS     r2,#0x32              ;1796
0011b2  4251              RSBS     r1,r2,#0              ;1796
0011b4  481f              LDR      r0,|L4.4660|
0011b6  f7fffffe          BL       gran
                  |L4.4538|
0011ba  481d              LDR      r0,|L4.4656|
0011bc  491e              LDR      r1,|L4.4664|
0011be  f9b00000          LDRSH    r0,[r0,#0]            ;1801  ; U_maxg
0011c2  f9b11000          LDRSH    r1,[r1,#0]            ;1802  ; U_MAX
0011c6  ebc02040          RSB      r0,r0,r0,LSL #9       ;1801
0011ca  0040              LSLS     r0,r0,#1              ;1801
0011cc  fb90f0f1          SDIV     r0,r0,r1              ;1802
0011d0  9000              STR      r0,[sp,#0]            ;1806
0011d2  4811              LDR      r0,|L4.4632|
0011d4  4919              LDR      r1,|L4.4668|
0011d6  f9b00000          LDRSH    r0,[r0,#0]            ;1806  ; I_ug_temp
0011da  f9b11000          LDRSH    r1,[r1,#0]            ;1807  ; I_MAX_IPS
0011de  ebc02040          RSB      r0,r0,r0,LSL #9       ;1806
0011e2  0040              LSLS     r0,r0,#1              ;1806
0011e4  fb90f0f1          SDIV     r0,r0,r1              ;1807
0011e8  4682              MOV      r10,r0                ;1807
0011ea  20ac              MOVS     r0,#0xac              ;1809
0011ec  f7fffffe          BL       lc640_read_int
0011f0  f5a0412b          SUB      r1,r0,#0xab00         ;1809
0011f4  39cd              SUBS     r1,r1,#0xcd           ;1809
0011f6  e023              B        |L4.4672|
                  |L4.4600|
                          DCD      _x_
                  |L4.4604|
                          DCD      I_ug3
                  |L4.4608|
                          DCD      I_ug2
                  |L4.4612|
                          DCD      U_up3
                  |L4.4616|
                          DCD      U_up_temp
                  |L4.4620|
                          DCD      U_up2
                  |L4.4624|
                          DCD      CURR_FADE_IN
                  |L4.4628|
                          DCD      time_proc
                  |L4.4632|
                          DCD      I_ug_temp
                  |L4.4636|
                          DCD      REV_IS_ON
                  |L4.4640|
                          DCD      AVT_REV_IS_ON
                  |L4.4644|
                          DCD      proc_phase
                  |L4.4648|
                          DCD      load_I
                  |L4.4652|
                          DCD      load_U
                  |L4.4656|
                          DCD      U_maxg
                  |L4.4660|
                          DCD      _xu_
                  |L4.4664|
                          DCD      U_MAX
                  |L4.4668|
                          DCD      I_MAX_IPS
                  |L4.4672|
001240  d107              BNE      |L4.4690|
001242  48f8              LDR      r0,|L4.5668|
001244  f9b00000          LDRSH    r0,[r0,#0]            ;1811  ; U_maxg
001248  f7fffffe          BL       find_U_curve
00124c  eb000080          ADD      r0,r0,r0,LSL #2       ;1811
001250  9000              STR      r0,[sp,#0]            ;1811
                  |L4.4690|
001252  20ae              MOVS     r0,#0xae              ;1814
001254  f7fffffe          BL       lc640_read_int
001258  f5a0412b          SUB      r1,r0,#0xab00         ;1814
00125c  39cd              SUBS     r1,r1,#0xcd           ;1814
00125e  d107              BNE      |L4.4720|
001260  48f1              LDR      r0,|L4.5672|
001262  f9b00000          LDRSH    r0,[r0,#0]            ;1816  ; I_ug_temp
001266  f7fffffe          BL       find_I_curve
00126a  eb000080          ADD      r0,r0,r0,LSL #2       ;1816
00126e  4682              MOV      r10,r0                ;1816
                  |L4.4720|
001270  2000              MOVS     r0,#0                 ;1819
001272  f9b8c000          LDRSH    r12,[r8,#0]           ;1411
001276  e03c              B        |L4.4850|
                  |L4.4728|
001278  49ec              LDR      r1,|L4.5676|
00127a  8809              LDRH     r1,[r1,#0]            ;1821  ; REV_IS_ON
00127c  b141              CBZ      r1,|L4.4752|
00127e  49ec              LDR      r1,|L4.5680|
001280  8809              LDRH     r1,[r1,#0]            ;1821  ; AVT_REV_IS_ON
001282  b129              CBZ      r1,|L4.4752|
001284  49eb              LDR      r1,|L4.5684|
001286  7809              LDRB     r1,[r1,#0]            ;1821  ; proc_phase
001288  2901              CMP      r1,#1                 ;1821
00128a  d010              BEQ      |L4.4782|
00128c  2903              CMP      r1,#3                 ;1821
00128e  d00e              BEQ      |L4.4782|
                  |L4.4752|
001290  9900              LDR      r1,[sp,#0]            ;1826
001292  b20a              SXTH     r2,r1                 ;1826
001294  f9b91000          LDRSH    r1,[r9,#0]            ;1826  ; _xu_
001298  1852              ADDS     r2,r2,r1              ;1826
00129a  ebc001c0          RSB      r1,r0,r0,LSL #3       ;1826
00129e  eb010141          ADD      r1,r1,r1,LSL #1       ;1826
0012a2  eb040181          ADD      r1,r4,r1,LSL #2       ;1826
0012a6  62ca              STR      r2,[r1,#0x2c]         ;1827
0012a8  d50c              BPL      |L4.4804|
0012aa  62cd              STR      r5,[r1,#0x2c]         ;1827
0012ac  e00f              B        |L4.4814|
                  |L4.4782|
0012ae  ebc001c0          RSB      r1,r0,r0,LSL #3       ;1822
0012b2  eb010141          ADD      r1,r1,r1,LSL #1       ;1822
0012b6  eb040181          ADD      r1,r4,r1,LSL #2       ;1822
0012ba  62cd              STR      r5,[r1,#0x2c]         ;1823
0012bc  630d              STR      r5,[r1,#0x30]         ;1824
0012be  f8816028          STRB     r6,[r1,#0x28]         ;1824
0012c2  e014              B        |L4.4846|
                  |L4.4804|
0012c4  f24033fe          MOV      r3,#0x3fe             ;1828
0012c8  429a              CMP      r2,r3                 ;1828
0012ca  dd00              BLE      |L4.4814|
0012cc  62cb              STR      r3,[r1,#0x2c]         ;1828
                  |L4.4814|
0012ce  f9bb2000          LDRSH    r2,[r11,#0]           ;1829  ; _x_
0012d2  fa0ff38a          SXTH     r3,r10                ;1829
0012d6  189a              ADDS     r2,r3,r2              ;1829
0012d8  630a              STR      r2,[r1,#0x30]         ;1830
0012da  d501              BPL      |L4.4832|
0012dc  630d              STR      r5,[r1,#0x30]         ;1830
0012de  e004              B        |L4.4842|
                  |L4.4832|
0012e0  f24033fe          MOV      r3,#0x3fe             ;1831
0012e4  429a              CMP      r2,r3                 ;1831
0012e6  dd00              BLE      |L4.4842|
0012e8  630b              STR      r3,[r1,#0x30]         ;1831
                  |L4.4842|
0012ea  f8815028          STRB     r5,[r1,#0x28]         ;1832
                  |L4.4846|
0012ee  1c40              ADDS     r0,r0,#1              ;1819
0012f0  b2c0              UXTB     r0,r0                 ;1819
                  |L4.4850|
0012f2  4560              CMP      r0,r12                ;1819
0012f4  dbc0              BLT      |L4.4728|
                  |L4.4854|
0012f6  e1e7              B        |L4.5832|
                  |L4.4856|
0012f8  f8dfc33c          LDR      r12,|L4.5688|
0012fc  f9bc1000          LDRSH    r1,[r12,#0]           ;1843  ; load_U_
001300  2905              CMP      r1,#5                 ;1843
001302  dd01              BLE      |L4.4872|
001304  727e              STRB     r6,[r7,#9]            ;1843
001306  e000              B        |L4.4874|
                  |L4.4872|
001308  727d              STRB     r5,[r7,#9]            ;1844
                  |L4.4874|
00130a  48cc              LDR      r0,|L4.5692|
00130c  2364              MOVS     r3,#0x64              ;1846
00130e  f9b02000          LDRSH    r2,[r0,#0]            ;1846  ; U_up_temp
001312  fb92f3f3          SDIV     r3,r2,r3              ;1846
001316  9300              STR      r3,[sp,#0]            ;1847
001318  2b00              CMP      r3,#0                 ;1847
00131a  dc01              BGT      |L4.4896|
00131c  2301              MOVS     r3,#1                 ;1847
00131e  9300              STR      r3,[sp,#0]            ;1847
                  |L4.4896|
001320  1a88              SUBS     r0,r1,r2              ;1848
001322  b200              SXTH     r0,r0                 ;1848
001324  f7fffffe          BL       abs
001328  9900              LDR      r1,[sp,#0]            ;1848
00132a  b209              SXTH     r1,r1                 ;1848
00132c  4288              CMP      r0,r1                 ;1848
00132e  da01              BGE      |L4.4916|
001330  72be              STRB     r6,[r7,#0xa]          ;1848
001332  e000              B        |L4.4918|
                  |L4.4916|
001334  72bd              STRB     r5,[r7,#0xa]          ;1849
                  |L4.4918|
001336  723d              STRB     r5,[r7,#8]            ;1853
001338  7ab8              LDRB     r0,[r7,#0xa]          ;1855  ; bU_VALID_VALID
00133a  b180              CBZ      r0,|L4.4958|
00133c  7af8              LDRB     r0,[r7,#0xb]          ;1857  ; bPRECESSION_REG
00133e  b3b8              CBZ      r0,|L4.5040|
001340  48bd              LDR      r0,|L4.5688|
001342  72fd              STRB     r5,[r7,#0xb]          ;1859
001344  f9b01000          LDRSH    r1,[r0,#0]            ;1860  ; load_U_
001348  48bc              LDR      r0,|L4.5692|
00134a  f9b00000          LDRSH    r0,[r0,#0]            ;1860  ; U_up_temp
00134e  4281              CMP      r1,r0                 ;1860
001350  db2a              BLT      |L4.5032|
001352  dc2f              BGT      |L4.5044|
001354  e032              B        |L4.5052|
001356  bf00              NOP                            ;1861
                  |L4.4952|
001358  f8a91000          STRH     r1,[r9,#0]            ;1861
00135c  e02e              B        |L4.5052|
                  |L4.4958|
00135e  79b8              LDRB     r0,[r7,#6]            ;1865  ; b1Hz_sh
001360  b330              CBZ      r0,|L4.5040|
001362  7a78              LDRB     r0,[r7,#9]            ;1865  ; bU_VALID
001364  b320              CBZ      r0,|L4.5040|
001366  48b6              LDR      r0,|L4.5696|
001368  f9b01000          LDRSH    r1,[r0,#0]            ;1867  ; load_I
00136c  48b5              LDR      r0,|L4.5700|
00136e  f9b00000          LDRSH    r0,[r0,#0]            ;1867  ; I_maxp
001372  4281              CMP      r1,r0                 ;1867
001374  da04              BGE      |L4.4992|
001376  f8bb1000          LDRH     r1,[r11,#0]           ;1867  ; _x_
00137a  f1010101          ADD      r1,r1,#1              ;1867
00137e  e004              B        |L4.5002|
                  |L4.4992|
001380  dd05              BLE      |L4.5006|
001382  f8bb1000          LDRH     r1,[r11,#0]           ;1868  ; _x_
001386  f1a10101          SUB      r1,r1,#1              ;1868
                  |L4.5002|
00138a  f8ab1000          STRH     r1,[r11,#0]           ;1868
                  |L4.5006|
00138e  2232              MOVS     r2,#0x32              ;1869
001390  4251              RSBS     r1,r2,#0              ;1869
001392  48ad              LDR      r0,|L4.5704|
001394  f7fffffe          BL       gran
001398  48a7              LDR      r0,|L4.5688|
00139a  f9b01000          LDRSH    r1,[r0,#0]            ;1871  ; load_U_
00139e  48a7              LDR      r0,|L4.5692|
0013a0  f9b00000          LDRSH    r0,[r0,#0]            ;1871  ; U_up_temp
0013a4  4281              CMP      r1,r0                 ;1871
0013a6  da04              BGE      |L4.5042|
                  |L4.5032|
0013a8  f8b91000          LDRH     r1,[r9,#0]            ;1871  ; _xu_
0013ac  1c49              ADDS     r1,r1,#1              ;1871
0013ae  e7d3              B        |L4.4952|
                  |L4.5040|
0013b0  e009              B        |L4.5062|
                  |L4.5042|
0013b2  dd03              BLE      |L4.5052|
                  |L4.5044|
0013b4  f8b91000          LDRH     r1,[r9,#0]            ;1872  ; _xu_
0013b8  1e49              SUBS     r1,r1,#1              ;1872
0013ba  e7cd              B        |L4.4952|
                  |L4.5052|
0013bc  2232              MOVS     r2,#0x32              ;1873
0013be  4251              RSBS     r1,r2,#0              ;1873
0013c0  48a2              LDR      r0,|L4.5708|
0013c2  f7fffffe          BL       gran
                  |L4.5062|
0013c6  489d              LDR      r0,|L4.5692|
0013c8  f44f7161          MOV      r1,#0x384             ;1879
0013cc  f9b00000          LDRSH    r0,[r0,#0]            ;1879  ; U_up_temp
0013d0  4348              MULS     r0,r1,r0              ;1879
0013d2  499f              LDR      r1,|L4.5712|
0013d4  f9b11000          LDRSH    r1,[r1,#0]            ;1880  ; U_MAX
0013d8  fb90f0f1          SDIV     r0,r0,r1              ;1880
0013dc  3032              ADDS     r0,r0,#0x32           ;1881
0013de  9000              STR      r0,[sp,#0]            ;1883
0013e0  20ac              MOVS     r0,#0xac              ;1883
0013e2  f7fffffe          BL       lc640_read_int
0013e6  f5a0412b          SUB      r1,r0,#0xab00         ;1883
0013ea  39cd              SUBS     r1,r1,#0xcd           ;1883
0013ec  d107              BNE      |L4.5118|
0013ee  4893              LDR      r0,|L4.5692|
0013f0  f9b00000          LDRSH    r0,[r0,#0]            ;1885  ; U_up_temp
0013f4  f7fffffe          BL       find_U_curve
0013f8  eb000080          ADD      r0,r0,r0,LSL #2       ;1885
0013fc  9000              STR      r0,[sp,#0]            ;1885
                  |L4.5118|
0013fe  4891              LDR      r0,|L4.5700|
001400  4994              LDR      r1,|L4.5716|
001402  f9b00000          LDRSH    r0,[r0,#0]            ;1891  ; I_maxp
001406  f9b11000          LDRSH    r1,[r1,#0]            ;1892  ; I_MAX_IPS
00140a  ebc02040          RSB      r0,r0,r0,LSL #9       ;1891
00140e  0040              LSLS     r0,r0,#1              ;1891
001410  fb90f0f1          SDIV     r0,r0,r1              ;1892
001414  4682              MOV      r10,r0                ;1892
001416  20ae              MOVS     r0,#0xae              ;1894
001418  f7fffffe          BL       lc640_read_int
00141c  f5a0412b          SUB      r1,r0,#0xab00         ;1894
001420  39cd              SUBS     r1,r1,#0xcd           ;1894
001422  d107              BNE      |L4.5172|
001424  4887              LDR      r0,|L4.5700|
001426  f9b00000          LDRSH    r0,[r0,#0]            ;1896  ; I_maxp
00142a  f7fffffe          BL       find_I_curve
00142e  eb000080          ADD      r0,r0,r0,LSL #2       ;1896
001432  4682              MOV      r10,r0                ;1896
                  |L4.5172|
001434  f9b80000          LDRSH    r0,[r8,#0]            ;1411
001438  2100              MOVS     r1,#0                 ;1899
00143a  4680              MOV      r8,r0                 ;1411
00143c  e040              B        |L4.5312|
                  |L4.5182|
00143e  487b              LDR      r0,|L4.5676|
001440  8800              LDRH     r0,[r0,#0]            ;1901  ; REV_IS_ON
001442  b140              CBZ      r0,|L4.5206|
001444  487a              LDR      r0,|L4.5680|
001446  8800              LDRH     r0,[r0,#0]            ;1901  ; AVT_REV_IS_ON
001448  b128              CBZ      r0,|L4.5206|
00144a  487a              LDR      r0,|L4.5684|
00144c  7800              LDRB     r0,[r0,#0]            ;1901  ; proc_phase
00144e  2801              CMP      r0,#1                 ;1901
001450  d014              BEQ      |L4.5244|
001452  2803              CMP      r0,#3                 ;1901
001454  d012              BEQ      |L4.5244|
                  |L4.5206|
001456  ebc100c1          RSB      r0,r1,r1,LSL #3       ;1906
00145a  9a00              LDR      r2,[sp,#0]            ;1906
00145c  eb000040          ADD      r0,r0,r0,LSL #1       ;1906
001460  eb040080          ADD      r0,r4,r0,LSL #2       ;1906
001464  fa0ffc82          SXTH     r12,r2                ;1906
001468  f9b92000          LDRSH    r2,[r9,#0]            ;1906  ; _xu_
00146c  f9b03050          LDRSH    r3,[r0,#0x50]         ;1906
001470  4462              ADD      r2,r2,r12             ;1906
001472  189a              ADDS     r2,r3,r2              ;1906
001474  62c2              STR      r2,[r0,#0x2c]         ;1907
001476  d50c              BPL      |L4.5266|
001478  62c5              STR      r5,[r0,#0x2c]         ;1907
00147a  e00f              B        |L4.5276|
                  |L4.5244|
00147c  ebc100c1          RSB      r0,r1,r1,LSL #3       ;1902
001480  eb000040          ADD      r0,r0,r0,LSL #1       ;1902
001484  eb040080          ADD      r0,r4,r0,LSL #2       ;1902
001488  62c5              STR      r5,[r0,#0x2c]         ;1903
00148a  6305              STR      r5,[r0,#0x30]         ;1904
00148c  f8806028          STRB     r6,[r0,#0x28]         ;1904
001490  e014              B        |L4.5308|
                  |L4.5266|
001492  f24033fe          MOV      r3,#0x3fe             ;1908
001496  429a              CMP      r2,r3                 ;1908
001498  dd00              BLE      |L4.5276|
00149a  62c3              STR      r3,[r0,#0x2c]         ;1908
                  |L4.5276|
00149c  f9bb2000          LDRSH    r2,[r11,#0]           ;1909  ; _x_
0014a0  fa0ff38a          SXTH     r3,r10                ;1909
0014a4  189a              ADDS     r2,r3,r2              ;1909
0014a6  6302              STR      r2,[r0,#0x30]         ;1910
0014a8  d501              BPL      |L4.5294|
0014aa  6305              STR      r5,[r0,#0x30]         ;1910
0014ac  e004              B        |L4.5304|
                  |L4.5294|
0014ae  f24033fe          MOV      r3,#0x3fe             ;1911
0014b2  429a              CMP      r2,r3                 ;1911
0014b4  dd00              BLE      |L4.5304|
0014b6  6303              STR      r3,[r0,#0x30]         ;1911
                  |L4.5304|
0014b8  f8805028          STRB     r5,[r0,#0x28]         ;1912
                  |L4.5308|
0014bc  1c49              ADDS     r1,r1,#1              ;1899
0014be  b2c9              UXTB     r1,r1                 ;1899
                  |L4.5312|
0014c0  4541              CMP      r1,r8                 ;1899
0014c2  dbbc              BLT      |L4.5182|
0014c4  4964              LDR      r1,|L4.5720|
0014c6  9800              LDR      r0,[sp,#0]            ;1924
0014c8  8008              STRH     r0,[r1,#0]            ;1924
0014ca  4964              LDR      r1,|L4.5724|
0014cc  6ae0              LDR      r0,[r4,#0x2c]         ;1925  ; bps
0014ce  8008              STRH     r0,[r1,#0]            ;1925
0014d0  e0fa              B        |L4.5832|
                  |L4.5330|
0014d2  79b8              LDRB     r0,[r7,#6]            ;1937  ; b1Hz_sh
0014d4  b398              CBZ      r0,|L4.5438|
0014d6  4862              LDR      r0,|L4.5728|
0014d8  7800              LDRB     r0,[r0,#0]            ;1938  ; bOFF
0014da  bb80              CBNZ     r0,|L4.5438|
0014dc  4861              LDR      r0,|L4.5732|
0014de  f9b00000          LDRSH    r0,[r0,#0]            ;1939  ; CAP_WRK_CURR
0014e2  eb000180          ADD      r1,r0,r0,LSL #2       ;1939
0014e6  4856              LDR      r0,|L4.5696|
0014e8  f9b00000          LDRSH    r0,[r0,#0]            ;1939  ; load_I
0014ec  ebb00f41          CMP      r0,r1,LSL #1          ;1939
0014f0  da04              BGE      |L4.5372|
0014f2  f8bb1000          LDRH     r1,[r11,#0]           ;1939  ; _x_
0014f6  f1010101          ADD      r1,r1,#1              ;1939
0014fa  e004              B        |L4.5382|
                  |L4.5372|
0014fc  dd05              BLE      |L4.5386|
0014fe  f8bb1000          LDRH     r1,[r11,#0]           ;1940  ; _x_
001502  f1a10101          SUB      r1,r1,#1              ;1940
                  |L4.5382|
001506  f8ab1000          STRH     r1,[r11,#0]           ;1940
                  |L4.5386|
00150a  4652              MOV      r2,r10                ;1941
00150c  4629              MOV      r1,r5                 ;1941
00150e  484e              LDR      r0,|L4.5704|
001510  f7fffffe          BL       gran
001514  2232              MOVS     r2,#0x32              ;1942
001516  4251              RSBS     r1,r2,#0              ;1942
001518  484b              LDR      r0,|L4.5704|
00151a  f7fffffe          BL       gran
00151e  4852              LDR      r0,|L4.5736|
001520  f9b00000          LDRSH    r0,[r0,#0]            ;1944  ; CAP_MAX_VOLT
001524  eb000180          ADD      r1,r0,r0,LSL #2       ;1944
001528  4850              LDR      r0,|L4.5740|
00152a  f9b00000          LDRSH    r0,[r0,#0]            ;1944  ; load_U
00152e  ebb00f41          CMP      r0,r1,LSL #1          ;1944
001532  da05              BGE      |L4.5440|
001534  f8b91000          LDRH     r1,[r9,#0]            ;1944  ; _xu_
001538  f1010101          ADD      r1,r1,#1              ;1944
00153c  e005              B        |L4.5450|
                  |L4.5438|
00153e  e010              B        |L4.5474|
                  |L4.5440|
001540  dd05              BLE      |L4.5454|
001542  f8b91000          LDRH     r1,[r9,#0]            ;1945  ; _xu_
001546  f1a10101          SUB      r1,r1,#1              ;1945
                  |L4.5450|
00154a  f8a91000          STRH     r1,[r9,#0]            ;1945
                  |L4.5454|
00154e  4652              MOV      r2,r10                ;1946
001550  4629              MOV      r1,r5                 ;1946
001552  483d              LDR      r0,|L4.5704|
001554  f7fffffe          BL       gran
001558  2232              MOVS     r2,#0x32              ;1947
00155a  4251              RSBS     r1,r2,#0              ;1947
00155c  483b              LDR      r0,|L4.5708|
00155e  f7fffffe          BL       gran
                  |L4.5474|
001562  4841              LDR      r0,|L4.5736|
001564  f24271ec          MOV      r1,#0x27ec            ;1952
001568  f9b00000          LDRSH    r0,[r0,#0]            ;1952  ; CAP_MAX_VOLT
00156c  4348              MULS     r0,r1,r0              ;1952
00156e  4938              LDR      r1,|L4.5712|
001570  f9b11000          LDRSH    r1,[r1,#0]            ;1953  ; U_MAX
001574  fb90f0f1          SDIV     r0,r0,r1              ;1953
001578  9000              STR      r0,[sp,#0]            ;1957
00157a  483a              LDR      r0,|L4.5732|
00157c  f24271ec          MOV      r1,#0x27ec            ;1957
001580  f9b00000          LDRSH    r0,[r0,#0]            ;1957  ; CAP_WRK_CURR
001584  4348              MULS     r0,r1,r0              ;1957
001586  4933              LDR      r1,|L4.5716|
001588  f9b11000          LDRSH    r1,[r1,#0]            ;1958  ; I_MAX_IPS
00158c  fb90f0f1          SDIV     r0,r0,r1              ;1958
001590  9001              STR      r0,[sp,#4]            ;1960
001592  20ac              MOVS     r0,#0xac              ;1960
001594  f7fffffe          BL       lc640_read_int
001598  f5a0412b          SUB      r1,r0,#0xab00         ;1960
00159c  39cd              SUBS     r1,r1,#0xcd           ;1960
00159e  d10a              BNE      |L4.5558|
0015a0  4831              LDR      r0,|L4.5736|
0015a2  8800              LDRH     r0,[r0,#0]            ;1962  ; CAP_MAX_VOLT
0015a4  eb000080          ADD      r0,r0,r0,LSL #2       ;1962
0015a8  0040              LSLS     r0,r0,#1              ;1962
0015aa  b200              SXTH     r0,r0                 ;1962
0015ac  f7fffffe          BL       find_U_curve
0015b0  eb000080          ADD      r0,r0,r0,LSL #2       ;1962
0015b4  9000              STR      r0,[sp,#0]            ;1962
                  |L4.5558|
0015b6  20ae              MOVS     r0,#0xae              ;1965
0015b8  f7fffffe          BL       lc640_read_int
0015bc  f5a0412b          SUB      r1,r0,#0xab00         ;1965
0015c0  39cd              SUBS     r1,r1,#0xcd           ;1965
0015c2  d10a              BNE      |L4.5594|
0015c4  4827              LDR      r0,|L4.5732|
0015c6  8800              LDRH     r0,[r0,#0]            ;1967  ; CAP_WRK_CURR
0015c8  eb000080          ADD      r0,r0,r0,LSL #2       ;1967
0015cc  0040              LSLS     r0,r0,#1              ;1967
0015ce  b200              SXTH     r0,r0                 ;1967
0015d0  f7fffffe          BL       find_I_curve
0015d4  eb000080          ADD      r0,r0,r0,LSL #2       ;1967
0015d8  9001              STR      r0,[sp,#4]            ;1967
                  |L4.5594|
0015da  2000              MOVS     r0,#0                 ;1972
0015dc  f9b81000          LDRSH    r1,[r8,#0]            ;1411
0015e0  e05d              B        |L4.5790|
                  |L4.5602|
0015e2  e06b              B        |L4.5820|
                  |L4.5604|
0015e4  4a1e              LDR      r2,|L4.5728|
0015e6  7812              LDRB     r2,[r2,#0]            ;1974  ; bOFF
0015e8  b152              CBZ      r2,|L4.5632|
0015ea  ebc002c0          RSB      r2,r0,r0,LSL #3       ;1975
0015ee  eb020242          ADD      r2,r2,r2,LSL #1       ;1975
0015f2  eb040282          ADD      r2,r4,r2,LSL #2       ;1975
0015f6  62d5              STR      r5,[r2,#0x2c]         ;1976
0015f8  6315              STR      r5,[r2,#0x30]         ;1977
0015fa  f8826028          STRB     r6,[r2,#0x28]         ;1977
0015fe  e04c              B        |L4.5786|
                  |L4.5632|
001600  9a00              LDR      r2,[sp,#0]            ;1979
001602  b213              SXTH     r3,r2                 ;1979
001604  f9b92000          LDRSH    r2,[r9,#0]            ;1979  ; _xu_
001608  189a              ADDS     r2,r3,r2              ;1979
00160a  ebc003c0          RSB      r3,r0,r0,LSL #3       ;1979
00160e  eb030343          ADD      r3,r3,r3,LSL #1       ;1979
001612  eb040c83          ADD      r12,r4,r3,LSL #2      ;1979
001616  f8cc202c          STR      r2,[r12,#0x2c]        ;1980
00161a  d529              BPL      |L4.5744|
00161c  f8cc502c          STR      r5,[r12,#0x2c]        ;1980
001620  e02a              B        |L4.5752|
001622  0000              DCW      0x0000
                  |L4.5668|
                          DCD      U_maxg
                  |L4.5672|
                          DCD      I_ug_temp
                  |L4.5676|
                          DCD      REV_IS_ON
                  |L4.5680|
                          DCD      AVT_REV_IS_ON
                  |L4.5684|
                          DCD      proc_phase
                  |L4.5688|
                          DCD      load_U_
                  |L4.5692|
                          DCD      U_up_temp
                  |L4.5696|
                          DCD      load_I
                  |L4.5700|
                          DCD      I_maxp
                  |L4.5704|
                          DCD      _x_
                  |L4.5708|
                          DCD      _xu_
                  |L4.5712|
                          DCD      U_MAX
                  |L4.5716|
                          DCD      I_MAX_IPS
                  |L4.5720|
                          DCD      plazma_vol_u_0
                  |L4.5724|
                          DCD      plazma_vol_u_1
                  |L4.5728|
                          DCD      bOFF
                  |L4.5732|
                          DCD      CAP_WRK_CURR
                  |L4.5736|
                          DCD      CAP_MAX_VOLT
                  |L4.5740|
                          DCD      load_U
                  |L4.5744|
001670  4552              CMP      r2,r10                ;1981
001672  dd01              BLE      |L4.5752|
001674  f8cca02c          STR      r10,[r12,#0x2c]       ;1981
                  |L4.5752|
001678  9a01              LDR      r2,[sp,#4]            ;1982
00167a  b213              SXTH     r3,r2                 ;1982
00167c  f9bb2000          LDRSH    r2,[r11,#0]           ;1982  ; _x_
001680  189a              ADDS     r2,r3,r2              ;1982
001682  f8cc2030          STR      r2,[r12,#0x30]        ;1983
001686  d502              BPL      |L4.5774|
001688  f8cc5030          STR      r5,[r12,#0x30]        ;1983
00168c  e003              B        |L4.5782|
                  |L4.5774|
00168e  4552              CMP      r2,r10                ;1984
001690  dd01              BLE      |L4.5782|
001692  f8cca030          STR      r10,[r12,#0x30]       ;1984
                  |L4.5782|
001696  f88c5028          STRB     r5,[r12,#0x28]        ;1985
                  |L4.5786|
00169a  1c40              ADDS     r0,r0,#1              ;1972
00169c  b2c0              UXTB     r0,r0                 ;1972
                  |L4.5790|
00169e  4288              CMP      r0,r1                 ;1972
0016a0  dba0              BLT      |L4.5604|
0016a2  e011              B        |L4.5832|
                  |L4.5796|
;;;1995   		{
;;;1996   		bps[i]._vol_u=0;
0016a4  ebc001c0          RSB      r1,r0,r0,LSL #3
0016a8  eb010141          ADD      r1,r1,r1,LSL #1
0016ac  eb040181          ADD      r1,r4,r1,LSL #2
0016b0  1c40              ADDS     r0,r0,#1              ;1994
;;;1997   		bps[i]._vol_i=0;
0016b2  62cd              STR      r5,[r1,#0x2c]
;;;1998   		bps[i]._flags_tu=1;
0016b4  630d              STR      r5,[r1,#0x30]
0016b6  f8816028          STRB     r6,[r1,#0x28]
0016ba  b2c0              UXTB     r0,r0                 ;1994
                  |L4.5820|
0016bc  4290              CMP      r0,r2                 ;1994
0016be  dbf1              BLT      |L4.5796|
;;;1999   		}
;;;2000   	_x_=0;
0016c0  f8ab5000          STRH     r5,[r11,#0]
;;;2001   	_xu_=0;
0016c4  f8a95000          STRH     r5,[r9,#0]
                  |L4.5832|
;;;2002   	}
;;;2003   
;;;2004   //gran(&bps[0]._vol_u,10,1010);
;;;2005   //gran(&bps[0]._vol_i,10,1010);
;;;2006   
;;;2007   b1Hz_sh=0;
0016c8  71bd              STRB     r5,[r7,#6]
;;;2008   }
0016ca  e8bd9ffc          POP      {r2-r12,pc}
;;;2009   
                          ENDP

                  bps_drv PROC
;;;2018   //-----------------------------------------------
;;;2019   void bps_drv(char in)
0016ce  b510              PUSH     {r4,lr}
;;;2020   {
;;;2021   char temp;
;;;2022   
;;;2023   if (bps[in]._device!=dSRC) return;
0016d0  ebc000c0          RSB      r0,r0,r0,LSL #3
0016d4  eb000140          ADD      r1,r0,r0,LSL #1
0016d8  48ff              LDR      r0,|L4.6872|
0016da  f8102021          LDRB     r2,[r0,r1,LSL #2]
0016de  2a03              CMP      r2,#3
0016e0  d174              BNE      |L4.6092|
;;;2024   temp=bps[in]._flags_tm;
0016e2  eb000081          ADD      r0,r0,r1,LSL #2
0016e6  f890103e          LDRB     r1,[r0,#0x3e]
;;;2025   if(temp&(1<<AV_T))
0016ea  078a              LSLS     r2,r1,#30
;;;2026   	{
;;;2027   	if(bps[in]._temp_av_cnt<1200) 
;;;2028   		{
;;;2029   		bps[in]._temp_av_cnt++;
;;;2030   		if(bps[in]._temp_av_cnt>=1200)
;;;2031   			{
;;;2032   			bps[in]._temp_av_cnt=1200;
;;;2033   		   	//if(!(bps[in]._av&(1<<0)))avar_bps_hndl(in,0,1);
;;;2034   			}
;;;2035   		}
;;;2036   	}
;;;2037   
;;;2038   else if(!(temp&(1<<AV_T)))
;;;2039   	{
;;;2040   	if(bps[in]._temp_av_cnt) 
0016ec  f9b02042          LDRSH    r2,[r0,#0x42]
0016f0  d50c              BPL      |L4.5900|
0016f2  f44f6396          MOV      r3,#0x4b0             ;2027
0016f6  429a              CMP      r2,r3                 ;2027
0016f8  da0d              BGE      |L4.5910|
0016fa  1c52              ADDS     r2,r2,#1              ;2029
0016fc  b212              SXTH     r2,r2                 ;2029
0016fe  f8a02042          STRH     r2,[r0,#0x42]         ;2029
001702  429a              CMP      r2,r3                 ;2030
001704  db07              BLT      |L4.5910|
001706  f8a03042          STRH     r3,[r0,#0x42]         ;2032
00170a  e004              B        |L4.5910|
                  |L4.5900|
00170c  b11a              CBZ      r2,|L4.5910|
;;;2041   		{
;;;2042   		bps[in]._temp_av_cnt--;
00170e  f1a20201          SUB      r2,r2,#1
001712  f8a02042          STRH     r2,[r0,#0x42]
                  |L4.5910|
;;;2043   		if(!bps[in]._temp_av_cnt)
;;;2044   			{
;;;2045   			//if(bps[in]._av&(1<<0))avar_bps_hndl(in,0,0);
;;;2046   			}
;;;2047   		} 	
;;;2048   
;;;2049   	}
;;;2050   
;;;2051   if((temp&(1<<AVUMAX)))
001716  070a              LSLS     r2,r1,#28
;;;2052   	{
;;;2053   	if(bps[in]._umax_av_cnt<10) 
;;;2054   		{
;;;2055   		bps[in]._umax_av_cnt++;
;;;2056   		if(bps[in]._umax_av_cnt>=10)
;;;2057   			{ 
;;;2058   			bps[in]._umax_av_cnt=10;
;;;2059   			//if(!(bps[in]._av&(1<<1)))avar_bps_hndl(in,1,1);
;;;2060   		  	/*if((K[APV]!=ON)||((apv_cnt[in,0]==0)&&(apv_cnt[in,1]==0)&&(apv_cnt[in,2]==0)&&(apv_flags[in]==afOFF)))avar_s_hndl(in,1,1);
;;;2061   			if((apv_cnt[in,0]==0)&&(apv_cnt[in,1]==0)&&(apv_cnt[in,2]==0)&&(apv_flags[in]==afON))
;;;2062   				{
;;;2063   				apv_cnt[in,0]=APV_INIT;
;;;2064   				apv_cnt[in,1]=APV_INIT;
;;;2065   				apv_cnt[in,2]=APV_INIT;
;;;2066   				apv_flags[in]=afOFF;
;;;2067   				}				*/
;;;2068   						
;;;2069   			}
;;;2070   		} 
;;;2071   	}		
;;;2072   else if(!(temp&(1<<AVUMAX)))
;;;2073   	{
;;;2074   	if(bps[in]._umax_av_cnt>0) 
001718  f9b02044          LDRSH    r2,[r0,#0x44]
00171c  f04f030a          MOV      r3,#0xa               ;2058
001720  f04f0400          MOV      r4,#0                 ;2027
001724  d50a              BPL      |L4.5948|
001726  2a0a              CMP      r2,#0xa               ;2053
001728  da13              BGE      |L4.5970|
00172a  1c52              ADDS     r2,r2,#1              ;2055
00172c  b212              SXTH     r2,r2                 ;2055
00172e  f8a02044          STRH     r2,[r0,#0x44]         ;2055
001732  2a0a              CMP      r2,#0xa               ;2056
001734  db0d              BLT      |L4.5970|
001736  f8a03044          STRH     r3,[r0,#0x44]         ;2058
00173a  e00a              B        |L4.5970|
                  |L4.5948|
00173c  2a00              CMP      r2,#0
00173e  dd05              BLE      |L4.5964|
;;;2075   		{
;;;2076   		bps[in]._umax_av_cnt--;
001740  f1a20201          SUB      r2,r2,#1
001744  b212              SXTH     r2,r2
001746  f8a02044          STRH     r2,[r0,#0x44]
;;;2077   		if(bps[in]._umax_av_cnt==0)
00174a  e002              B        |L4.5970|
                  |L4.5964|
;;;2078   			{
;;;2079   			bps[in]._umax_av_cnt=0;
;;;2080   			//avar_bps_hndl(in,1,0);
;;;2081   	 //		apv_cnt[in,0]=0;
;;;2082   	//		apv_cnt[in,1]=0;
;;;2083   	 //		apv_cnt[in,2]=0;			
;;;2084   			}
;;;2085   		}
;;;2086   	else if(bps[in]._umax_av_cnt<0) bps[in]._umax_av_cnt=0;		 
00174c  da01              BGE      |L4.5970|
00174e  f8a04044          STRH     r4,[r0,#0x44]
                  |L4.5970|
;;;2087   	}
;;;2088   
;;;2089   if(temp&(1<<AVUMIN))
001752  06ca              LSLS     r2,r1,#27
;;;2090   	{
;;;2091   	if(bps[in]._umin_av_cnt<10) 
;;;2092   		{
;;;2093   		bps[in]._umin_av_cnt++;
;;;2094   		if(bps[in]._umin_av_cnt>=10)
;;;2095   			{ 
;;;2096   			bps[in]._umin_av_cnt=10;
;;;2097   			//if(!(bps[in]._av&(1<<2)))avar_bps_hndl(in,2,1);
;;;2098   		  	/*	if((K[APV]!=ON)||((apv_cnt[in,0]==0)&&(apv_cnt[in,1]==0)&&(apv_cnt[in,2]==0)&&(apv_flags[in]==afOFF)))avar_s_hndl(in,2,1);
;;;2099   			if((apv_cnt[in,0]==0)&&(apv_cnt[in,1]==0)&&(apv_cnt[in,2]==0)&&(apv_flags[in]==afON))
;;;2100   				{
;;;2101   				apv_cnt[in,0]=APV_INIT;
;;;2102   				apv_cnt[in,1]=APV_INIT;
;;;2103   				apv_cnt[in,2]=APV_INIT;
;;;2104   				apv_flags[in]=afOFF;
;;;2105   				}*/				
;;;2106   			}
;;;2107   		} 
;;;2108   	}	
;;;2109   	
;;;2110   else if(!(temp&(1<<AVUMIN)))
;;;2111   	{
;;;2112   	if(bps[in]._umin_av_cnt) 
001754  f9b02046          LDRSH    r2,[r0,#0x46]
001758  d50a              BPL      |L4.6000|
00175a  2a0a              CMP      r2,#0xa               ;2091
00175c  da0d              BGE      |L4.6010|
00175e  1c52              ADDS     r2,r2,#1              ;2093
001760  b212              SXTH     r2,r2                 ;2093
001762  f8a02046          STRH     r2,[r0,#0x46]         ;2093
001766  2a0a              CMP      r2,#0xa               ;2094
001768  db07              BLT      |L4.6010|
00176a  f8a03046          STRH     r3,[r0,#0x46]         ;2096
00176e  e004              B        |L4.6010|
                  |L4.6000|
001770  b11a              CBZ      r2,|L4.6010|
;;;2113   		{
;;;2114   		bps[in]._umin_av_cnt--;
001772  1e52              SUBS     r2,r2,#1
001774  b212              SXTH     r2,r2
001776  f8a02046          STRH     r2,[r0,#0x46]
                  |L4.6010|
;;;2115   		if(bps[in]._umin_av_cnt==0)
;;;2116   			{
;;;2117   			bps[in]._umin_av_cnt=0;
;;;2118   		//	avar_bps_hndl(in,2,0);
;;;2119   		//	apv_cnt[in,0]=0;
;;;2120   		//	apv_cnt[in,1]=0;
;;;2121   		//	apv_cnt[in,2]=0;
;;;2122   			}
;;;2123   		}
;;;2124   	else if(bps[in]._umin_av_cnt>10)bps[in]._umin_av_cnt--;	 
;;;2125   	}
;;;2126   
;;;2127   //bps[in]._state=bsOFF;
;;;2128   
;;;2129   if (bps[in]._av&0x0f)					bps[in]._state=bsAV;
00177a  7842              LDRB     r2,[r0,#1]
00177c  0712              LSLS     r2,r2,#28
00177e  d001              BEQ      |L4.6020|
001780  2104              MOVS     r1,#4
001782  e00f              B        |L4.6052|
                  |L4.6020|
;;;2130   else if ( (net_av) && (bps[in]._cnt>20)/*&& 
001784  4ad5              LDR      r2,|L4.6876|
001786  7812              LDRB     r2,[r2,#0]  ; net_av
001788  b122              CBZ      r2,|L4.6036|
00178a  78c2              LDRB     r2,[r0,#3]
00178c  2a14              CMP      r2,#0x14
00178e  d901              BLS      |L4.6036|
;;;2131   		(bps[in]._Uii<200)*/)				bps[in]._state=bsOFF_AV_NET;
001790  2105              MOVS     r1,#5
001792  e007              B        |L4.6052|
                  |L4.6036|
;;;2132   else if (bps[in]._flags_tm&BIN8(100000))	bps[in]._state=bsRDY;
001794  0689              LSLS     r1,r1,#26
001796  d501              BPL      |L4.6044|
001798  2102              MOVS     r1,#2
00179a  e003              B        |L4.6052|
                  |L4.6044|
;;;2133   else if (bps[in]._cnt<20)				bps[in]._state=bsWRK;
00179c  78c1              LDRB     r1,[r0,#3]
00179e  2914              CMP      r1,#0x14
0017a0  d201              BCS      |L4.6054|
0017a2  2101              MOVS     r1,#1
                  |L4.6052|
0017a4  7081              STRB     r1,[r0,#2]
                  |L4.6054|
;;;2134   
;;;2135   
;;;2136   
;;;2137   //else if(bps[in]._flags_tm&BIN8(100000)) bps[in]._state=ssBL;
;;;2138   //else if((!(bps[in]._flags_tm&BIN8(100000)))&&(net_U>100))bps[in]._state=ssWRK;
;;;2139   //else bps[0]._state=ssNOT;
;;;2140   
;;;2141   //bps[in]._is_ready=0;
;;;2142   //bps[in]._is_wrk=0;
;;;2143   //if(bps[in]._av_net) bps[in]._flags_bp='N';// не подключен
;;;2144   //else if(bps[in]._av_u_max) bps[in]._flags_bp='P';// завышено напряжение(u_.av_.bAS1T)) bps_state[0]=ssAV;
;;;2145   //else if(bps[in]._av_u_min) bps[in]._flags_bp='M';// занижено напряжение
;;;2146   //else if(bps[in]._av_temper) bps[in]._flags_bp='T';// температура
;;;2147   //else if(bps[in]._flags_tm&BIN8(100000)) 
;;;2148   //	{
;;;2149   //	bps[in]._flags_bp='B';// заблокирован
;;;2150   //	bps[in]._is_ready=1;
;;;2151   //	}
;;;2152   //else if((!(bps[in]._flags_tm&BIN8(100000)))&&(net_U>100))
;;;2153   //     {
;;;2154   //     bps[in]._flags_bp='W';// работает
;;;2155   //     bps[in]._is_ready=1;
;;;2156   //     bps[in]._is_wrk=1;
;;;2157        
;;;2158   //     }
;;;2159   //else bps[in]._is_ready=1;     
;;;2160   
;;;2161   
;;;2162   
;;;2163   
;;;2164   
;;;2165   /*
;;;2166   bps[in]._flags_tu&=BIN8(11111110);
;;;2167   if(bps[in]._ist_blok_cnt)
;;;2168   	{
;;;2169   	bps[in]._ist_blok_cnt--;
;;;2170   	bps[in]._flags_tu|=BIN8(1);
;;;2171   	}
;;;2172   
;;;2173   	   */ 
;;;2174   
;;;2175   //Пересброс БПСа при потере связи
;;;2176   if(bps[in]._cnt>=10) bps[in]._flags_tu|=BIN8(10000000);
0017a6  78c1              LDRB     r1,[r0,#3]
0017a8  290a              CMP      r1,#0xa
;;;2177   else bps[in]._flags_tu&=BIN8(1111111);
0017aa  f8901028          LDRB     r1,[r0,#0x28]
0017ae  d302              BCC      |L4.6070|
0017b0  f0410180          ORR      r1,r1,#0x80           ;2176
0017b4  e001              B        |L4.6074|
                  |L4.6070|
0017b6  f001017f          AND      r1,r1,#0x7f
                  |L4.6074|
0017ba  f8801028          STRB     r1,[r0,#0x28]
;;;2178   	
;;;2179   bps[in]._vol_u=cntrl_stat_U;	
0017be  49c8              LDR      r1,|L4.6880|
0017c0  f9b12010          LDRSH    r2,[r1,#0x10]  ; cntrl_stat_U
;;;2180   bps[in]._vol_i=cntrl_stat_I;
0017c4  62c2              STR      r2,[r0,#0x2c]
0017c6  f9b11012          LDRSH    r1,[r1,#0x12]  ; cntrl_stat_I
0017ca  6301              STR      r1,[r0,#0x30]
                  |L4.6092|
;;;2181    
;;;2182   }
0017cc  bd10              POP      {r4,pc}
;;;2183   
                          ENDP

                  volt_contr_hndl PROC
;;;2196   //-----------------------------------------------
;;;2197   void volt_contr_hndl(void)
0017ce  e92d47f0          PUSH     {r4-r10,lr}
;;;2198   {
;;;2199   if(work_stat==wsOFF)
0017d2  48c4              LDR      r0,|L4.6884|
;;;2200   	{
;;;2201   	cnt_volt_contr=0;
;;;2202   	}
;;;2203   else 
;;;2204   	{
;;;2205   	if(cnt_volt_contr<(T_DEL_REL_VOLT_START*10))
0017d4  4ec4              LDR      r6,|L4.6888|
0017d6  4cc2              LDR      r4,|L4.6880|
0017d8  7800              LDRB     r0,[r0,#0]            ;2199  ; work_stat
0017da  2500              MOVS     r5,#0                 ;2199
0017dc  b310              CBZ      r0,|L4.6180|
0017de  f9b60000          LDRSH    r0,[r6,#0]  ; T_DEL_REL_VOLT_START
0017e2  eb000180          ADD      r1,r0,r0,LSL #2
0017e6  f9b40024          LDRSH    r0,[r4,#0x24]  ; cnt_volt_contr
0017ea  ebb00f41          CMP      r0,r1,LSL #1
0017ee  da01              BGE      |L4.6132|
;;;2206   		{
;;;2207   		cnt_volt_contr++;
0017f0  1c40              ADDS     r0,r0,#1
0017f2  84a0              STRH     r0,[r4,#0x24]
                  |L4.6132|
;;;2208   		}
;;;2209   	}
;;;2210   
;;;2211   	
;;;2212   	if(load_U>REL_VOLT_UMIN*10)
0017f4  48bd              LDR      r0,|L4.6892|
0017f6  f8df82f8          LDR      r8,|L4.6896|
;;;2213   		{
;;;2214   		cnt_rel_volt_umin++;
;;;2215   		gran(&cnt_rel_volt_umin,0,30000);
0017fa  f2475a30          MOV      r10,#0x7530
0017fe  f9b00000          LDRSH    r0,[r0,#0]            ;2212  ; REL_VOLT_UMIN
001802  eb000180          ADD      r1,r0,r0,LSL #2       ;2212
001806  f9b80000          LDRSH    r0,[r8,#0]            ;2212  ; load_U
00180a  ebb00f41          CMP      r0,r1,LSL #1          ;2212
00180e  dd0b              BLE      |L4.6184|
001810  8ce0              LDRH     r0,[r4,#0x26]         ;2214  ; cnt_rel_volt_umin
001812  4652              MOV      r2,r10
001814  1c40              ADDS     r0,r0,#1              ;2214
001816  84e0              STRH     r0,[r4,#0x26]         ;2214
001818  48b1              LDR      r0,|L4.6880|
00181a  2100              MOVS     r1,#0
00181c  3026              ADDS     r0,r0,#0x26
00181e  f7fffffe          BL       gran
001822  e002              B        |L4.6186|
                  |L4.6180|
001824  84a5              STRH     r5,[r4,#0x24]         ;2201
001826  e7e5              B        |L4.6132|
                  |L4.6184|
;;;2216   		}
;;;2217   	else cnt_rel_volt_umin=0;
001828  84e5              STRH     r5,[r4,#0x26]
                  |L4.6186|
;;;2218   	if((cnt_rel_volt_umin>=T_DEL_REL_VOLT_WRK*10)&&(cnt_volt_contr>=(T_DEL_REL_VOLT_START*10))) 	bVOLT_IS_NOT_DOWN=1;
00182a  f8df92c8          LDR      r9,|L4.6900|
00182e  2701              MOVS     r7,#1
001830  f9b90000          LDRSH    r0,[r9,#0]  ; T_DEL_REL_VOLT_WRK
001834  eb000180          ADD      r1,r0,r0,LSL #2
001838  f9b40026          LDRSH    r0,[r4,#0x26]  ; cnt_rel_volt_umin
00183c  ebb00f41          CMP      r0,r1,LSL #1
001840  db0a              BLT      |L4.6232|
001842  f9b61000          LDRSH    r1,[r6,#0]  ; T_DEL_REL_VOLT_START
001846  f9b42024          LDRSH    r2,[r4,#0x24]  ; cnt_volt_contr
00184a  eb010181          ADD      r1,r1,r1,LSL #2
00184e  ebb20f41          CMP      r2,r1,LSL #1
001852  db01              BLT      |L4.6232|
001854  7327              STRB     r7,[r4,#0xc]
001856  e001              B        |L4.6236|
                  |L4.6232|
;;;2219   	else if(cnt_rel_volt_umin==0)							  							bVOLT_IS_NOT_DOWN=0;
001858  b900              CBNZ     r0,|L4.6236|
00185a  7325              STRB     r5,[r4,#0xc]
                  |L4.6236|
;;;2220   
;;;2221   	if(load_U<REL_VOLT_UMAX*10)
00185c  48a6              LDR      r0,|L4.6904|
00185e  f9b00000          LDRSH    r0,[r0,#0]  ; REL_VOLT_UMAX
001862  eb000180          ADD      r1,r0,r0,LSL #2
001866  f9b80000          LDRSH    r0,[r8,#0]  ; load_U
00186a  ebb00f41          CMP      r0,r1,LSL #1
00186e  da09              BGE      |L4.6276|
;;;2222   		{
;;;2223   		cnt_rel_volt_umax++;
001870  8d20              LDRH     r0,[r4,#0x28]  ; cnt_rel_volt_umax
;;;2224   		gran(&cnt_rel_volt_umax,0,30000);
001872  4652              MOV      r2,r10
001874  1c40              ADDS     r0,r0,#1              ;2223
001876  8520              STRH     r0,[r4,#0x28]         ;2223
001878  4899              LDR      r0,|L4.6880|
00187a  2100              MOVS     r1,#0
00187c  3028              ADDS     r0,r0,#0x28
00187e  f7fffffe          BL       gran
001882  e000              B        |L4.6278|
                  |L4.6276|
;;;2225   		}
;;;2226   	else cnt_rel_volt_umax=0;
001884  8525              STRH     r5,[r4,#0x28]
                  |L4.6278|
;;;2227   	if((cnt_rel_volt_umax>=T_DEL_REL_VOLT_WRK*10)&&(cnt_volt_contr>=(T_DEL_REL_VOLT_START*10))) 	bVOLT_IS_NOT_UP=1;
001886  f9b90000          LDRSH    r0,[r9,#0]  ; T_DEL_REL_VOLT_WRK
00188a  eb000180          ADD      r1,r0,r0,LSL #2
00188e  f9b40028          LDRSH    r0,[r4,#0x28]  ; cnt_rel_volt_umax
001892  ebb00f41          CMP      r0,r1,LSL #1
001896  db0a              BLT      |L4.6318|
001898  f9b61000          LDRSH    r1,[r6,#0]  ; T_DEL_REL_VOLT_START
00189c  f9b42024          LDRSH    r2,[r4,#0x24]  ; cnt_volt_contr
0018a0  eb010181          ADD      r1,r1,r1,LSL #2
0018a4  ebb20f41          CMP      r2,r1,LSL #1
0018a8  db01              BLT      |L4.6318|
0018aa  7367              STRB     r7,[r4,#0xd]
0018ac  e002              B        |L4.6324|
                  |L4.6318|
;;;2228   	else if(cnt_rel_volt_umax==0)							  							bVOLT_IS_NOT_UP=0;
0018ae  b130              CBZ      r0,|L4.6334|
;;;2229   	
;;;2230   	if(bVOLT_IS_NOT_UP && bVOLT_IS_NOT_DOWN) bVOLT_IS_NORM=1;
0018b0  7b60              LDRB     r0,[r4,#0xd]  ; bVOLT_IS_NOT_UP
0018b2  b128              CBZ      r0,|L4.6336|
                  |L4.6324|
0018b4  7b20              LDRB     r0,[r4,#0xc]  ; bVOLT_IS_NOT_DOWN
0018b6  b118              CBZ      r0,|L4.6336|
0018b8  73a7              STRB     r7,[r4,#0xe]
                  |L4.6330|
;;;2231   	else bVOLT_IS_NORM=0;
;;;2232   
;;;2233   
;;;2234   }
0018ba  e8bd87f0          POP      {r4-r10,pc}
                  |L4.6334|
0018be  7365              STRB     r5,[r4,#0xd]          ;2228
                  |L4.6336|
0018c0  73a5              STRB     r5,[r4,#0xe]          ;2231
0018c2  e7fa              B        |L4.6330|
;;;2235   
                          ENDP

                  current_stab_hndl PROC
;;;2236   //-----------------------------------------------
;;;2237   void current_stab_hndl(void)
0018c4  e92d5ff0          PUSH     {r4-r12,lr}
;;;2238   {
;;;2239   
;;;2240   if(work_stat==wsPS)
0018c8  4886              LDR      r0,|L4.6884|
;;;2241   	{
;;;2242   	delta_U_abs=abs_pal(load_U-U_up);
0018ca  f8df8230          LDR      r8,|L4.6908|
;;;2243   	delta_U_rel=(delta_U_abs*100)/U_up;
;;;2244   
;;;2245   	delta_I_abs=abs_pal(load_I-I_maxp);
0018ce  f8dfb230          LDR      r11,|L4.6912|
0018d2  7801              LDRB     r1,[r0,#0]            ;2240  ; work_stat
0018d4  4886              LDR      r0,|L4.6896|
0018d6  f8dfa22c          LDR      r10,|L4.6916|
0018da  4d8b              LDR      r5,|L4.6920|
0018dc  f9b00000          LDRSH    r0,[r0,#0]            ;2242
;;;2246   	delta_I_rel=(delta_I_abs*100)/I_maxp;
0018e0  4e8a              LDR      r6,|L4.6924|
;;;2247   	}
;;;2248   
;;;2249   else if(work_stat==wsGS)
;;;2250   	{
;;;2251   	delta_U_abs=abs_pal(load_U-U_maxg);
;;;2252   	delta_U_rel=(delta_U_abs*100)/U_maxg;
;;;2253   
;;;2254   	delta_I_abs=abs_pal(load_I-I_ug_temp);
;;;2255   	delta_I_rel=(delta_I_abs*100)/I_ug_temp;
;;;2256   	}
;;;2257   else 
;;;2258   	{
;;;2259   	cnt_del_rel=0;
0018e2  2700              MOVS     r7,#0
0018e4  4c8a              LDR      r4,|L4.6928|
0018e6  2902              CMP      r1,#2                 ;2240
0018e8  d011              BEQ      |L4.6414|
0018ea  2901              CMP      r1,#1                 ;2249
0018ec  d025              BEQ      |L4.6458|
0018ee  8027              STRH     r7,[r4,#0]
                  |L4.6384|
;;;2260   	}
;;;2261   
;;;2262   if((delta_U_rel>DELT_REL_CURR_U)&&(delta_I_rel<DELT_REL_CURR_I))
0018f0  4988              LDR      r1,|L4.6932|
0018f2  6828              LDR      r0,[r5,#0]  ; delta_U_rel
0018f4  f9b11000          LDRSH    r1,[r1,#0]  ; DELT_REL_CURR_U
0018f8  4288              CMP      r0,r1
0018fa  dd43              BLE      |L4.6532|
0018fc  4986              LDR      r1,|L4.6936|
0018fe  6830              LDR      r0,[r6,#0]  ; delta_I_rel
001900  f9b11000          LDRSH    r1,[r1,#0]  ; DELT_REL_CURR_I
001904  4288              CMP      r0,r1
001906  da3d              BGE      |L4.6532|
;;;2263   	{
;;;2264   	cnt_del_rel++;
001908  8820              LDRH     r0,[r4,#0]  ; cnt_del_rel
00190a  1c40              ADDS     r0,r0,#1
00190c  e03c              B        |L4.6536|
                  |L4.6414|
00190e  f8df920c          LDR      r9,|L4.6940|
001912  f8b91000          LDRH     r1,[r9,#0]            ;2242  ; U_up
001916  1a40              SUBS     r0,r0,r1              ;2242
001918  b200              SXTH     r0,r0                 ;2242
00191a  f7fffffe          BL       abs_pal
00191e  f8c80000          STR      r0,[r8,#0]            ;2243  ; delta_U_abs
001922  2164              MOVS     r1,#0x64              ;2243
001924  4348              MULS     r0,r1,r0              ;2243
001926  f9b91000          LDRSH    r1,[r9,#0]            ;2243  ; U_up
00192a  f8df81f4          LDR      r8,|L4.6944|
00192e  fb90f0f1          SDIV     r0,r0,r1              ;2243
001932  6028              STR      r0,[r5,#0]            ;2245  ; delta_U_rel
001934  f8bb1000          LDRH     r1,[r11,#0]           ;2245  ; load_I
001938  e014              B        |L4.6500|
                  |L4.6458|
00193a  f8df91e8          LDR      r9,|L4.6948|
00193e  f8b91000          LDRH     r1,[r9,#0]            ;2251  ; U_maxg
001942  1a40              SUBS     r0,r0,r1              ;2251
001944  b200              SXTH     r0,r0                 ;2251
001946  f7fffffe          BL       abs_pal
00194a  f8c80000          STR      r0,[r8,#0]            ;2252  ; delta_U_abs
00194e  2164              MOVS     r1,#0x64              ;2252
001950  4348              MULS     r0,r1,r0              ;2252
001952  f9b91000          LDRSH    r1,[r9,#0]            ;2252  ; U_maxg
001956  f8df81d0          LDR      r8,|L4.6952|
00195a  fb90f0f1          SDIV     r0,r0,r1              ;2252
00195e  6028              STR      r0,[r5,#0]            ;2254  ; delta_U_rel
001960  f8bb1000          LDRH     r1,[r11,#0]           ;2254  ; load_I
                  |L4.6500|
001964  f8b80000          LDRH     r0,[r8,#0]            ;2254  ; I_ug_temp
001968  1a08              SUBS     r0,r1,r0              ;2254
00196a  b200              SXTH     r0,r0                 ;2254
00196c  f7fffffe          BL       abs_pal
001970  2164              MOVS     r1,#0x64              ;2255
001972  f8ca0000          STR      r0,[r10,#0]           ;2255  ; delta_I_abs
001976  4348              MULS     r0,r1,r0              ;2255
001978  f9b81000          LDRSH    r1,[r8,#0]            ;2255  ; I_ug_temp
00197c  fb90f0f1          SDIV     r0,r0,r1              ;2255
001980  6030              STR      r0,[r6,#0]            ;2255  ; delta_I_rel
001982  e7b5              B        |L4.6384|
                  |L4.6532|
;;;2265   	}
;;;2266   else
;;;2267   	{
;;;2268   	cnt_del_rel--;
001984  8820              LDRH     r0,[r4,#0]  ; cnt_del_rel
001986  1e40              SUBS     r0,r0,#1
                  |L4.6536|
;;;2269   	}
;;;2270   
;;;2271   gran(&cnt_del_rel,0,(T_DEL_REL_CURR_WRK*10)+10);
001988  4d68              LDR      r5,|L4.6956|
00198a  8020              STRH     r0,[r4,#0]            ;2268
00198c  210a              MOVS     r1,#0xa
00198e  8828              LDRH     r0,[r5,#0]  ; T_DEL_REL_CURR_WRK
001990  eb000080          ADD      r0,r0,r0,LSL #2
001994  eb010040          ADD      r0,r1,r0,LSL #1
001998  b202              SXTH     r2,r0
00199a  2100              MOVS     r1,#0
00199c  485c              LDR      r0,|L4.6928|
00199e  f7fffffe          BL       gran
;;;2272   
;;;2273   if(work_stat==wsOFF) cnt_del_rel=0;
0019a2  4850              LDR      r0,|L4.6884|
0019a4  7800              LDRB     r0,[r0,#0]  ; work_stat
0019a6  b900              CBNZ     r0,|L4.6570|
0019a8  8027              STRH     r7,[r4,#0]
                  |L4.6570|
;;;2274   
;;;2275   
;;;2276   if ( (time_proc>=(T_DEL_REL_CURR_START)) &&
0019aa  4861              LDR      r0,|L4.6960|
0019ac  4961              LDR      r1,|L4.6964|
;;;2277   	(cnt_del_rel>(T_DEL_REL_CURR_WRK*10)) )
;;;2278   	{
;;;2279   	bCURRENT_STAB=1;
0019ae  4a62              LDR      r2,|L4.6968|
0019b0  6800              LDR      r0,[r0,#0]            ;2276  ; time_proc
0019b2  f9b11000          LDRSH    r1,[r1,#0]            ;2276  ; T_DEL_REL_CURR_START
0019b6  4288              CMP      r0,r1                 ;2276
0019b8  db0a              BLT      |L4.6608|
0019ba  f9b53000          LDRSH    r3,[r5,#0]            ;2277  ; T_DEL_REL_CURR_WRK
0019be  f9b46000          LDRSH    r6,[r4,#0]            ;2277  ; cnt_del_rel
0019c2  eb030383          ADD      r3,r3,r3,LSL #2       ;2277
0019c6  ebb60f43          CMP      r6,r3,LSL #1          ;2277
0019ca  dd01              BLE      |L4.6608|
0019cc  2301              MOVS     r3,#1
0019ce  7013              STRB     r3,[r2,#0]
                  |L4.6608|
;;;2280   	}
;;;2281   if ( (time_proc<(T_DEL_REL_CURR_START)) ||
0019d0  4288              CMP      r0,r1
0019d2  db08              BLT      |L4.6630|
;;;2282   	(cnt_del_rel<=(T_DEL_REL_CURR_WRK*10)) )
0019d4  f9b50000          LDRSH    r0,[r5,#0]  ; T_DEL_REL_CURR_WRK
0019d8  f9b41000          LDRSH    r1,[r4,#0]  ; cnt_del_rel
0019dc  eb000080          ADD      r0,r0,r0,LSL #2
0019e0  ebb10f40          CMP      r1,r0,LSL #1
0019e4  dc00              BGT      |L4.6632|
                  |L4.6630|
;;;2283   	{
;;;2284   	bCURRENT_STAB=0;
0019e6  7017              STRB     r7,[r2,#0]
                  |L4.6632|
;;;2285   	}
;;;2286   
;;;2287   /*
;;;2288   SET_REG(LPC_PINCON->PINSEL0,0,5*2,2);
;;;2289   SET_REG(LPC_GPIO0->FIODIR,1,5,1);
;;;2290   //SET_REG(LPC_GPIO0->FIOSET,1,5,1);
;;;2291   
;;;2292   if(RELE_LOG_CURR==0)
;;;2293   	{
;;;2294   	SET_REG(LPC_GPIO0->FIOPIN,1,5,1);
;;;2295   	}
;;;2296   else if(RELE_LOG_CURR==1)
;;;2297   	{
;;;2298   	if(bCURRENT_STAB==0)SET_REG(LPC_GPIO0->FIOPIN,0,5,1);
;;;2299   	else SET_REG(LPC_GPIO0->FIOPIN,1,5,1);
;;;2300   	}
;;;2301   else
;;;2302   	{
;;;2303   	if(bCURRENT_STAB==0)SET_REG(LPC_GPIO0->FIOPIN,1,5,1);
;;;2304   	else SET_REG(LPC_GPIO0->FIOPIN,0,5,1);
;;;2305   	}*/
;;;2306   
;;;2307   }
0019e8  e8bd9ff0          POP      {r4-r12,pc}
;;;2308   
                          ENDP

                  rele_hndl PROC
;;;2332   //-----------------------------------------------
;;;2333   void rele_hndl(void)
0019ec  e92d4ff0          PUSH     {r4-r11,lr}
;;;2334   {
;;;2335   //Реле1
;;;2336   if(RELE_FUNC[0]==0)rele_stat[0]=rsOFF; 		//Выключено
;;;2337   else if(RELE_FUNC[0]==1)					//Реверс
;;;2338   	{
;;;2339   	if(work_stat==wsCAP) 
0019f0  483c              LDR      r0,|L4.6884|
;;;2340   		{
;;;2341   		if(bRAZR) rele_stat[0]=rsOFF;
;;;2342   		else 	rele_stat[0]=rsON;
;;;2343   		} 
;;;2344   	else 
;;;2345   		{
;;;2346   		if(REV_STAT==rsREW)	rele_stat[0]=rsOFF;
;;;2347   		else 			rele_stat[0]=rsON;
;;;2348   		}
;;;2349   	}
;;;2350   else if(RELE_FUNC[0]==2)					//Токоограничение
;;;2351   	{
;;;2352   	if(RELE_LOG_CURR==0)
0019f2  4b55              LDR      r3,|L4.6984|
0019f4  f8dfe144          LDR      lr,|L4.6972|
0019f8  f890c000          LDRB     r12,[r0,#0]           ;2339
0019fc  4850              LDR      r0,|L4.6976|
0019fe  f9b36000          LDRSH    r6,[r3,#0]
;;;2353   		{
;;;2354   		if(bCURRENT_STAB==0)	rele_stat[0]=rsON;
;;;2355   		else 				rele_stat[0]=rsOFF;
;;;2356   		}
;;;2357   	else if(RELE_LOG_CURR==1)
;;;2358   		{
;;;2359   		if(bCURRENT_STAB==0)	rele_stat[0]=rsOFF;
;;;2360   		else 				rele_stat[0]=rsON;
;;;2361   		}
;;;2362   	}									
;;;2363   else if(RELE_FUNC[0]==3)					//Напряжение в норме
;;;2364   	{
;;;2365   	if(RELE_LOG_VOLT==0)
001a02  4b52              LDR      r3,|L4.6988|
001a04  7800              LDRB     r0,[r0,#0]            ;2341
001a06  f9be4000          LDRSH    r4,[lr,#0]            ;2336  ; RELE_FUNC
001a0a  4682              MOV      r10,r0                ;2341
001a0c  484d              LDR      r0,|L4.6980|
001a0e  2100              MOVS     r1,#0                 ;2336
001a10  f9b33000          LDRSH    r3,[r3,#0]
001a14  7800              LDRB     r0,[r0,#0]            ;2346
001a16  4683              MOV      r11,r0                ;2346
001a18  4847              LDR      r0,|L4.6968|
001a1a  7805              LDRB     r5,[r0,#0]            ;2354
;;;2366   		{
;;;2367   		if(bVOLT_IS_NORM==0)	rele_stat[0]=rsON;
001a1c  4830              LDR      r0,|L4.6880|
001a1e  7b87              LDRB     r7,[r0,#0xe]
;;;2368   		else 				rele_stat[0]=rsOFF;
;;;2369   		}
;;;2370   	else if(RELE_LOG_VOLT==1)
;;;2371   		{
;;;2372   		if(bVOLT_IS_NORM==0)	rele_stat[0]=rsOFF;
;;;2373   		else 				rele_stat[0]=rsON;
;;;2374   		}
;;;2375   	}
;;;2376   else if(RELE_FUNC[0]==4)					//Напряжение не выше
;;;2377   	{
;;;2378   	if(RELE_LOG_VOLT==0)
;;;2379   		{
;;;2380   		if(bVOLT_IS_NOT_UP==0)	rele_stat[0]=rsON;
001a20  f890800d          LDRB     r8,[r0,#0xd]
;;;2381   		else 				rele_stat[0]=rsOFF;
;;;2382   		}
;;;2383   	else if(RELE_LOG_VOLT==1)
;;;2384   		{
;;;2385   		if(bVOLT_IS_NOT_UP==0)	rele_stat[0]=rsOFF;
;;;2386   		else 				rele_stat[0]=rsON;
;;;2387   		}
;;;2388   	}
;;;2389   else if(RELE_FUNC[0]==5)					//Напряжение не ниже
;;;2390   	{
;;;2391   	if(RELE_LOG_VOLT==0)
;;;2392   		{
;;;2393   		if(bVOLT_IS_NOT_DOWN==0)	rele_stat[0]=rsON;
001a24  7b00              LDRB     r0,[r0,#0xc]
001a26  4681              MOV      r9,r0
001a28  482d              LDR      r0,|L4.6880|
001a2a  302a              ADDS     r0,r0,#0x2a           ;2336
001a2c  2201              MOVS     r2,#1                 ;2336
001a2e  b314              CBZ      r4,|L4.6774|
001a30  2c01              CMP      r4,#1                 ;2337
001a32  d008              BEQ      |L4.6726|
001a34  2c02              CMP      r4,#2                 ;2350
001a36  d011              BEQ      |L4.6748|
001a38  2c03              CMP      r4,#3                 ;2363
001a3a  d017              BEQ      |L4.6764|
001a3c  2c04              CMP      r4,#4                 ;2376
001a3e  d01d              BEQ      |L4.6780|
001a40  2c05              CMP      r4,#5                 ;2389
001a42  d027              BEQ      |L4.6804|
001a44  e032              B        |L4.6828|
                  |L4.6726|
001a46  f1bc0f03          CMP      r12,#3                ;2339
001a4a  d003              BEQ      |L4.6740|
001a4c  f1bb0f00          CMP      r11,#0                ;2346
001a50  d011              BEQ      |L4.6774|
001a52  e02a              B        |L4.6826|
                  |L4.6740|
001a54  f1ba0f00          CMP      r10,#0                ;2341
001a58  d17c              BNE      |L4.6996|
001a5a  e026              B        |L4.6826|
                  |L4.6748|
001a5c  b116              CBZ      r6,|L4.6756|
001a5e  2e01              CMP      r6,#1                 ;2357
001a60  d002              BEQ      |L4.6760|
001a62  e023              B        |L4.6828|
                  |L4.6756|
001a64  b30d              CBZ      r5,|L4.6826|
001a66  e075              B        |L4.6996|
                  |L4.6760|
001a68  b12d              CBZ      r5,|L4.6774|
001a6a  e01e              B        |L4.6826|
                  |L4.6764|
001a6c  b113              CBZ      r3,|L4.6772|
001a6e  2b01              CMP      r3,#1                 ;2370
001a70  d002              BEQ      |L4.6776|
001a72  e01b              B        |L4.6828|
                  |L4.6772|
001a74  b1cf              CBZ      r7,|L4.6826|
                  |L4.6774|
001a76  e06d              B        |L4.6996|
                  |L4.6776|
001a78  b35f              CBZ      r7,|L4.6866|
001a7a  e016              B        |L4.6826|
                  |L4.6780|
001a7c  b113              CBZ      r3,|L4.6788|
001a7e  2b01              CMP      r3,#1                 ;2383
001a80  d004              BEQ      |L4.6796|
001a82  e013              B        |L4.6828|
                  |L4.6788|
001a84  f1b80f00          CMP      r8,#0                 ;2380
001a88  d00f              BEQ      |L4.6826|
001a8a  e063              B        |L4.6996|
                  |L4.6796|
001a8c  f1b80f00          CMP      r8,#0                 ;2385
001a90  d060              BEQ      |L4.6996|
001a92  e00a              B        |L4.6826|
                  |L4.6804|
001a94  b113              CBZ      r3,|L4.6812|
;;;2394   		else 				rele_stat[0]=rsOFF;
;;;2395   		}
;;;2396   	else if(RELE_LOG_VOLT==1)
001a96  2b01              CMP      r3,#1
001a98  d004              BEQ      |L4.6820|
001a9a  e007              B        |L4.6828|
                  |L4.6812|
001a9c  f1b90f00          CMP      r9,#0                 ;2393
001aa0  d003              BEQ      |L4.6826|
001aa2  e057              B        |L4.6996|
                  |L4.6820|
;;;2397   		{
;;;2398   		if(bVOLT_IS_NOT_DOWN==0)	rele_stat[0]=rsOFF;
001aa4  f1b90f00          CMP      r9,#0
001aa8  d054              BEQ      |L4.6996|
                  |L4.6826|
;;;2399   		else 				rele_stat[0]=rsON;
001aaa  7002              STRB     r2,[r0,#0]
                  |L4.6828|
;;;2400   		}
;;;2401   	}
;;;2402   											
;;;2403   //Реле2
;;;2404   if(RELE_FUNC[1]==0)rele_stat[1]=rsOFF; 		//Выключено
001aac  f9be4002          LDRSH    r4,[lr,#2]  ; RELE_FUNC
001ab0  b184              CBZ      r4,|L4.6868|
;;;2405   else if(RELE_FUNC[1]==1)					//Реверс
001ab2  2c01              CMP      r4,#1
001ab4  d053              BEQ      |L4.7006|
;;;2406   	{
;;;2407   	if(work_stat==wsCAP) 
;;;2408   		{
;;;2409   		if(bRAZR) 		rele_stat[1]=rsOFF;
;;;2410   		else 			rele_stat[1]=rsON;
;;;2411   		} 
;;;2412   	else 
;;;2413   		{
;;;2414   		if(REV_STAT==rsREW)	rele_stat[1]=rsOFF;
;;;2415   		else 			rele_stat[1]=rsON;
;;;2416   		}
;;;2417   	}
;;;2418   else if(RELE_FUNC[1]==2)					//Токоограничение
001ab6  2c02              CMP      r4,#2
001ab8  d05d              BEQ      |L4.7030|
;;;2419   	{
;;;2420   	if(RELE_LOG_CURR==0)
;;;2421   		{
;;;2422   		if(bCURRENT_STAB==0)rele_stat[1]=rsON;
;;;2423   		else 			rele_stat[1]=rsOFF;
;;;2424   		}
;;;2425   	else if(RELE_LOG_CURR==1)
;;;2426   		{
;;;2427   		if(bCURRENT_STAB==0)rele_stat[1]=rsOFF;
;;;2428   		else 			rele_stat[1]=rsON;
;;;2429   		}
;;;2430   	}									
;;;2431   else if(RELE_FUNC[1]==3)					//Напряжение в норме
001aba  2c03              CMP      r4,#3
001abc  d064              BEQ      |L4.7048|
;;;2432   	{
;;;2433   	if(RELE_LOG_VOLT==0)
;;;2434   		{
;;;2435   		if(bVOLT_IS_NORM==0)	rele_stat[1]=rsON;
;;;2436   		else 				rele_stat[1]=rsOFF;
;;;2437   		}
;;;2438   	else if(RELE_LOG_VOLT==1)
;;;2439   		{
;;;2440   		if(bVOLT_IS_NORM==0)	rele_stat[1]=rsOFF;
;;;2441   		else 				rele_stat[1]=rsON;
;;;2442   		}
;;;2443   	}
;;;2444   else if(RELE_FUNC[1]==4)					//Напряжение не выше
001abe  2c04              CMP      r4,#4
001ac0  d06b              BEQ      |L4.7066|
;;;2445   	{
;;;2446   	if(RELE_LOG_VOLT==0)
;;;2447   		{
;;;2448   		if(bVOLT_IS_NOT_UP==0)	rele_stat[1]=rsON;
;;;2449   		else 				rele_stat[1]=rsOFF;
;;;2450   		}
;;;2451   	else if(RELE_LOG_VOLT==1)
;;;2452   		{
;;;2453   		if(bVOLT_IS_NOT_UP==0)	rele_stat[1]=rsOFF;
;;;2454   		else 				rele_stat[1]=rsON;
;;;2455   		}
;;;2456   	}
;;;2457   else if(RELE_FUNC[1]==5)					//Напряжение не ниже
001ac2  2c05              CMP      r4,#5
001ac4  d149              BNE      |L4.7002|
;;;2458   	{
;;;2459   	if(RELE_LOG_VOLT==0)
001ac6  b133              CBZ      r3,|L4.6870|
;;;2460   		{
;;;2461   		if(bVOLT_IS_NOT_DOWN==0)	rele_stat[1]=rsON;
;;;2462   		else 				rele_stat[1]=rsOFF;
;;;2463   		}
;;;2464   	else if(RELE_LOG_VOLT==1)
001ac8  2b01              CMP      r3,#1
001aca  d146              BNE      |L4.7002|
;;;2465   		{
;;;2466   		if(bVOLT_IS_NOT_DOWN==0)	rele_stat[1]=rsOFF;
001acc  f1b90f00          CMP      r9,#0
001ad0  e03e              B        |L4.6992|
                  |L4.6866|
001ad2  e03f              B        |L4.6996|
                  |L4.6868|
001ad4  e040              B        |L4.7000|
                  |L4.6870|
001ad6  e06b              B        |L4.7088|
                  |L4.6872|
                          DCD      bps
                  |L4.6876|
                          DCD      net_av
                  |L4.6880|
                          DCD      ||area_number.24||
                  |L4.6884|
                          DCD      work_stat
                  |L4.6888|
                          DCD      T_DEL_REL_VOLT_START
                  |L4.6892|
                          DCD      REL_VOLT_UMIN
                  |L4.6896|
                          DCD      load_U
                  |L4.6900|
                          DCD      T_DEL_REL_VOLT_WRK
                  |L4.6904|
                          DCD      REL_VOLT_UMAX
                  |L4.6908|
                          DCD      delta_U_abs
                  |L4.6912|
                          DCD      load_I
                  |L4.6916|
                          DCD      delta_I_abs
                  |L4.6920|
                          DCD      delta_U_rel
                  |L4.6924|
                          DCD      delta_I_rel
                  |L4.6928|
                          DCD      cnt_del_rel
                  |L4.6932|
                          DCD      DELT_REL_CURR_U
                  |L4.6936|
                          DCD      DELT_REL_CURR_I
                  |L4.6940|
                          DCD      U_up
                  |L4.6944|
                          DCD      I_maxp
                  |L4.6948|
                          DCD      U_maxg
                  |L4.6952|
                          DCD      I_ug_temp
                  |L4.6956|
                          DCD      T_DEL_REL_CURR_WRK
                  |L4.6960|
                          DCD      time_proc
                  |L4.6964|
                          DCD      T_DEL_REL_CURR_START
                  |L4.6968|
                          DCD      bCURRENT_STAB
                  |L4.6972|
                          DCD      RELE_FUNC
                  |L4.6976|
                          DCD      bRAZR
                  |L4.6980|
                          DCD      REV_STAT
                  |L4.6984|
                          DCD      RELE_LOG_CURR
                  |L4.6988|
                          DCD      RELE_LOG_VOLT
                  |L4.6992|
001b50  d10b              BNE      |L4.7018|
001b52  e001              B        |L4.7000|
                  |L4.6996|
001b54  7001              STRB     r1,[r0,#0]            ;2398
001b56  e7a9              B        |L4.6828|
                  |L4.7000|
001b58  7041              STRB     r1,[r0,#1]            ;2404
                  |L4.7002|
;;;2467   		else 				rele_stat[1]=rsON;
;;;2468   		}
;;;2469   	}
;;;2470   	
;;;2471   
;;;2472   //rele_stat[0]=rsON;
;;;2473   //rele_stat[1]=rsON;
;;;2474   										
;;;2475   }
001b5a  e8bd8ff0          POP      {r4-r11,pc}
                  |L4.7006|
001b5e  f1bc0f03          CMP      r12,#3                ;2407
001b62  d004              BEQ      |L4.7022|
001b64  f1bb0f00          CMP      r11,#0                ;2414
001b68  d0f6              BEQ      |L4.7000|
                  |L4.7018|
001b6a  7042              STRB     r2,[r0,#1]            ;2415
001b6c  e7f5              B        |L4.7002|
                  |L4.7022|
001b6e  f1ba0f00          CMP      r10,#0                ;2409
001b72  d1f1              BNE      |L4.7000|
001b74  e7f9              B        |L4.7018|
                  |L4.7030|
001b76  b126              CBZ      r6,|L4.7042|
001b78  2e01              CMP      r6,#1                 ;2425
001b7a  d1ee              BNE      |L4.7002|
001b7c  2d00              CMP      r5,#0                 ;2427
001b7e  d1f4              BNE      |L4.7018|
001b80  e7ea              B        |L4.7000|
                  |L4.7042|
001b82  2d00              CMP      r5,#0                 ;2422
001b84  d0f1              BEQ      |L4.7018|
001b86  e7e7              B        |L4.7000|
                  |L4.7048|
001b88  b123              CBZ      r3,|L4.7060|
001b8a  2b01              CMP      r3,#1                 ;2438
001b8c  d1e5              BNE      |L4.7002|
001b8e  2f00              CMP      r7,#0                 ;2440
001b90  d1eb              BNE      |L4.7018|
001b92  e7e1              B        |L4.7000|
                  |L4.7060|
001b94  2f00              CMP      r7,#0                 ;2435
001b96  d0e8              BEQ      |L4.7018|
001b98  e7de              B        |L4.7000|
                  |L4.7066|
001b9a  b12b              CBZ      r3,|L4.7080|
001b9c  2b01              CMP      r3,#1                 ;2451
001b9e  d1dc              BNE      |L4.7002|
001ba0  f1b80f00          CMP      r8,#0                 ;2453
001ba4  d1e1              BNE      |L4.7018|
001ba6  e7d7              B        |L4.7000|
                  |L4.7080|
001ba8  f1b80f00          CMP      r8,#0                 ;2448
001bac  d0dd              BEQ      |L4.7018|
001bae  e7d3              B        |L4.7000|
                  |L4.7088|
001bb0  f1b90f00          CMP      r9,#0                 ;2461
001bb4  d0d9              BEQ      |L4.7018|
001bb6  e7cf              B        |L4.7000|
;;;2476    
                          ENDP

                  rele_drv PROC
;;;2477   //-----------------------------------------------
;;;2478   void rele_drv(void)
001bb8  4913              LDR      r1,|L4.7176|
;;;2479   {
;;;2480   #ifdef EXT_BOARD_V_1
;;;2481   SET_REG(LPC_PINCON->PINSEL0,0,4*2,2);
;;;2482   SET_REG(LPC_GPIO0->FIODIR,1,4,1);
;;;2483   
;;;2484   if(rele_stat[0]==rsON) SET_REG(LPC_GPIO0->FIOPIN,0,4,1);
;;;2485   else SET_REG(LPC_GPIO0->FIOPIN,1,4,1);
;;;2486   #endif
;;;2487   
;;;2488   #ifdef EXT_BOARD_V_2
;;;2489   SET_REG(LPC_PINCON->PINSEL0,0,7*2,2);
001bba  6808              LDR      r0,[r1,#0]
001bbc  f4204040          BIC      r0,r0,#0xc000
001bc0  6008              STR      r0,[r1,#0]
;;;2490   SET_REG(LPC_GPIO0->FIODIR,1,7,1);
001bc2  4812              LDR      r0,|L4.7180|
001bc4  6802              LDR      r2,[r0,#0]
001bc6  f0420280          ORR      r2,r2,#0x80
001bca  6002              STR      r2,[r0,#0]
;;;2491   
;;;2492   if(rele_stat[0]==rsON) SET_REG(LPC_GPIO0->FIOPIN,0,7,1);
001bcc  4a10              LDR      r2,|L4.7184|
001bce  7813              LDRB     r3,[r2,#0]  ; rele_stat
001bd0  2b01              CMP      r3,#1
;;;2493   else SET_REG(LPC_GPIO0->FIOPIN,1,7,1);
001bd2  6943              LDR      r3,[r0,#0x14]
001bd4  d012              BEQ      |L4.7164|
001bd6  f0430380          ORR      r3,r3,#0x80
                  |L4.7130|
001bda  6143              STR      r3,[r0,#0x14]
;;;2494   #endif
;;;2495   
;;;2496   SET_REG(LPC_PINCON->PINSEL0,0,5*2,2);
001bdc  680b              LDR      r3,[r1,#0]
001bde  f4236340          BIC      r3,r3,#0xc00
001be2  600b              STR      r3,[r1,#0]
;;;2497   SET_REG(LPC_GPIO0->FIODIR,1,5,1);
001be4  6801              LDR      r1,[r0,#0]
001be6  f0410120          ORR      r1,r1,#0x20
001bea  6001              STR      r1,[r0,#0]
;;;2498   
;;;2499   if(rele_stat[1]==rsON) SET_REG(LPC_GPIO0->FIOPIN,0,5,1);
001bec  7851              LDRB     r1,[r2,#1]  ; rele_stat
001bee  2901              CMP      r1,#1
;;;2500   else SET_REG(LPC_GPIO0->FIOPIN,1,5,1);
001bf0  6941              LDR      r1,[r0,#0x14]
001bf2  d006              BEQ      |L4.7170|
001bf4  f0410120          ORR      r1,r1,#0x20
                  |L4.7160|
001bf8  6141              STR      r1,[r0,#0x14]         ;2499
;;;2501   
;;;2502   
;;;2503   }
001bfa  4770              BX       lr
                  |L4.7164|
001bfc  f0230380          BIC      r3,r3,#0x80           ;2492
001c00  e7eb              B        |L4.7130|
                  |L4.7170|
001c02  f0210120          BIC      r1,r1,#0x20           ;2499
001c06  e7f7              B        |L4.7160|
;;;2504   
                          ENDP

                  |L4.7176|
                          DCD      0x4002c000
                  |L4.7180|
                          DCD      0x2009c000
                  |L4.7184|
                          DCD      ||area_number.24||+0x2a

                          AREA ||area_number.5||, CODE, READONLY, ALIGN=2

                          EXPORTAS ||area_number.5||, ||.text||
                  adc_drv6 PROC
;;;218    //-----------------------------------------------
;;;219    void kb_init(void)
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;220    {
;;;221    main_kb_cnt=(TBAT*60)-60/*120*/;
000004  4c77              LDR      r4,|L5.484|
000006  8860              LDRH     r0,[r4,#2]  ; adc_self_ch_buff
000008  8821              LDRH     r1,[r4,#0]  ; adc_self_ch_buff
00000a  1a40              SUBS     r0,r0,r1
00000c  b200              SXTH     r0,r0
00000e  f7fffffe          BL       abs_pal
000012  1da5              ADDS     r5,r4,#6
;;;222    }
000014  8028              STRH     r0,[r5,#0]
000016  88a0              LDRH     r0,[r4,#4]  ; adc_self_ch_buff
000018  8861              LDRH     r1,[r4,#2]  ; adc_self_ch_buff
00001a  1a40              SUBS     r0,r0,r1
00001c  b200              SXTH     r0,r0
00001e  f7fffffe          BL       abs_pal
000022  8068              STRH     r0,[r5,#2]
000024  88a0              LDRH     r0,[r4,#4]  ; adc_self_ch_buff
000026  8821              LDRH     r1,[r4,#0]  ; adc_self_ch_buff
000028  1a40              SUBS     r0,r0,r1
00002a  b200              SXTH     r0,r0
00002c  f7fffffe          BL       abs_pal
000030  f44f7296          MOV      r2,#0x12c
000034  80a8              STRH     r0,[r5,#4]
000036  f1a4012c          SUB      r1,r4,#0x2c
00003a  4290              CMP      r0,r2
00003c  da01              BGE      |L5.66|
00003e  88a0              LDRH     r0,[r4,#4]  ; adc_self_ch_buff
000040  e00a              B        |L5.88|
                  |L5.66|
000042  f9b50002          LDRSH    r0,[r5,#2]  ; adc_self_ch_disp
000046  4290              CMP      r0,r2
000048  da01              BGE      |L5.78|
00004a  8860              LDRH     r0,[r4,#2]  ; adc_self_ch_buff
00004c  e004              B        |L5.88|
                  |L5.78|
00004e  f9b50000          LDRSH    r0,[r5,#0]  ; adc_self_ch_disp
000052  4290              CMP      r0,r2
000054  da01              BGE      |L5.90|
000056  8820              LDRH     r0,[r4,#0]  ; adc_self_ch_buff
                  |L5.88|
000058  82c8              STRH     r0,[r1,#0x16]
                  |L5.90|
00005a  784e              LDRB     r6,[r1,#1]  ; adc_ch_net
00005c  2000              MOVS     r0,#0
00005e  b3f6              CBZ      r6,|L5.222|
000060  790c              LDRB     r4,[r1,#4]  ; adc_window_flag
000062  4a61              LDR      r2,|L5.488|
000064  b18c              CBZ      r4,|L5.138|
000066  f9b13016          LDRSH    r3,[r1,#0x16]  ; adc_result
00006a  6815              LDR      r5,[r2,#0]  ; main_power_buffer
00006c  eb0505a3          ADD      r5,r5,r3,ASR #2
000070  6015              STR      r5,[r2,#0]  ; main_power_buffer
000072  6855              LDR      r5,[r2,#4]  ; main_power_buffer
000074  eb0505a3          ADD      r5,r5,r3,ASR #2
000078  6055              STR      r5,[r2,#4]  ; main_power_buffer
00007a  6895              LDR      r5,[r2,#8]  ; main_power_buffer
00007c  eb0505a3          ADD      r5,r5,r3,ASR #2
000080  6095              STR      r5,[r2,#8]  ; main_power_buffer
000082  68d5              LDR      r5,[r2,#0xc]  ; main_power_buffer
000084  eb0503a3          ADD      r3,r5,r3,ASR #2
000088  60d3              STR      r3,[r2,#0xc]  ; main_power_buffer
                  |L5.138|
00008a  f9b13016          LDRSH    r3,[r1,#0x16]  ; adc_result
00008e  2b64              CMP      r3,#0x64
000090  da0e              BGE      |L5.176|
000092  8b4b              LDRH     r3,[r1,#0x1a]  ; adc_zero_cnt
000094  f44f65fa          MOV      r5,#0x7d0
000098  1c5b              ADDS     r3,r3,#1
00009a  b21b              SXTH     r3,r3
00009c  834b              STRH     r3,[r1,#0x1a]
00009e  42ab              CMP      r3,r5
0000a0  db08              BLT      |L5.180|
0000a2  834d              STRH     r5,[r1,#0x1a]
0000a4  6010              STR      r0,[r2,#0]  ; main_power_buffer
0000a6  6050              STR      r0,[r2,#4]  ; main_power_buffer
0000a8  6090              STR      r0,[r2,#8]  ; main_power_buffer
0000aa  60d0              STR      r0,[r2,#0xc]  ; main_power_buffer
0000ac  8288              STRH     r0,[r1,#0x14]
0000ae  e053              B        |L5.344|
                  |L5.176|
0000b0  8348              STRH     r0,[r1,#0x1a]
0000b2  e051              B        |L5.344|
                  |L5.180|
0000b4  2b05              CMP      r3,#5
0000b6  d14f              BNE      |L5.344|
0000b8  b1a4              CBZ      r4,|L5.228|
0000ba  8b0b              LDRH     r3,[r1,#0x18]  ; adc_gorb_cnt
0000bc  1c5b              ADDS     r3,r3,#1
0000be  b21b              SXTH     r3,r3
0000c0  830b              STRH     r3,[r1,#0x18]
0000c2  f5b37f00          CMP      r3,#0x200
0000c6  db00              BLT      |L5.202|
0000c8  8308              STRH     r0,[r1,#0x18]
                  |L5.202|
0000ca  f9b13018          LDRSH    r3,[r1,#0x18]  ; adc_gorb_cnt
0000ce  065d              LSLS     r5,r3,#25
0000d0  d108              BNE      |L5.228|
0000d2  11db              ASRS     r3,r3,#7
0000d4  f8525023          LDR      r5,[r2,r3,LSL #2]
0000d8  122d              ASRS     r5,r5,#8
0000da  828d              STRH     r5,[r1,#0x14]
0000dc  e000              B        |L5.224|
                  |L5.222|
0000de  e00f              B        |L5.256|
                  |L5.224|
0000e0  f8420023          STR      r0,[r2,r3,LSL #2]
                  |L5.228|
0000e4  f9b1201c          LDRSH    r2,[r1,#0x1c]  ; adc_window_cnt
0000e8  2a96              CMP      r2,#0x96
0000ea  dd01              BLE      |L5.240|
0000ec  b104              CBZ      r4,|L5.240|
0000ee  7108              STRB     r0,[r1,#4]
                  |L5.240|
0000f0  3a1f              SUBS     r2,r2,#0x1f
0000f2  2a27              CMP      r2,#0x27
0000f4  d230              BCS      |L5.344|
0000f6  790a              LDRB     r2,[r1,#4]  ; adc_window_flag
0000f8  bb72              CBNZ     r2,|L5.344|
0000fa  2201              MOVS     r2,#1
0000fc  710a              STRB     r2,[r1,#4]
0000fe  e02b              B        |L5.344|
                  |L5.256|
000100  4f3a              LDR      r7,|L5.492|
000102  788a              LDRB     r2,[r1,#2]  ; adc_ch
000104  f891c003          LDRB     r12,[r1,#3]  ; adc_ch_cnt
000108  eb0714c2          ADD      r4,r7,r2,LSL #7
00010c  f9b13016          LDRSH    r3,[r1,#0x16]  ; adc_result
000110  f844302c          STR      r3,[r4,r12,LSL #2]
000114  ea5f738c          LSLS     r3,r12,#30
000118  d110              BNE      |L5.316|
00011a  2400              MOVS     r4,#0
00011c  4623              MOV      r3,r4
00011e  eb0715c2          ADD      r5,r7,r2,LSL #7
000122  bf00              NOP      
                  |L5.292|
000124  f8557023          LDR      r7,[r5,r3,LSL #2]
000128  1c5b              ADDS     r3,r3,#1
00012a  b2db              UXTB     r3,r3
00012c  443c              ADD      r4,r4,r7
00012e  2b10              CMP      r3,#0x10
000130  d3f8              BCC      |L5.292|
000132  1123              ASRS     r3,r4,#4
000134  4c2c              LDR      r4,|L5.488|
000136  3c40              SUBS     r4,r4,#0x40
000138  f8243012          STRH     r3,[r4,r2,LSL #1]
                  |L5.316|
00013c  1c52              ADDS     r2,r2,#1
00013e  b2d2              UXTB     r2,r2
000140  708a              STRB     r2,[r1,#2]
000142  2a10              CMP      r2,#0x10
000144  d308              BCC      |L5.344|
000146  f10c0c01          ADD      r12,r12,#1
00014a  f00c02ff          AND      r2,r12,#0xff
00014e  7088              STRB     r0,[r1,#2]
000150  70ca              STRB     r2,[r1,#3]
000152  2a10              CMP      r2,#0x10
000154  d300              BCC      |L5.344|
000156  70c8              STRB     r0,[r1,#3]
                  |L5.344|
000158  7008              STRB     r0,[r1,#0]
00015a  1c76              ADDS     r6,r6,#1
00015c  f0160001          ANDS     r0,r6,#1
000160  4a23              LDR      r2,|L5.496|
000162  7048              STRB     r0,[r1,#1]
000164  d005              BEQ      |L5.370|
000166  6810              LDR      r0,[r2,#0]
000168  f02000ff          BIC      r0,r0,#0xff
00016c  1d00              ADDS     r0,r0,#4
00016e  6010              STR      r0,[r2,#0]
000170  e032              B        |L5.472|
                  |L5.370|
000172  7889              LDRB     r1,[r1,#2]  ; adc_ch
000174  0708              LSLS     r0,r1,#28
000176  2800              CMP      r0,#0
000178  6810              LDR      r0,[r2,#0]
00017a  f02000ff          BIC      r0,r0,#0xff
00017e  db01              BLT      |L5.388|
000180  1c40              ADDS     r0,r0,#1
000182  e000              B        |L5.390|
                  |L5.388|
000184  1c80              ADDS     r0,r0,#2
                  |L5.390|
000186  6010              STR      r0,[r2,#0]
000188  481a              LDR      r0,|L5.500|
00018a  6803              LDR      r3,[r0,#0]
00018c  f0435380          ORR      r3,r3,#0x10000000
000190  6003              STR      r3,[r0,#0]
000192  6a03              LDR      r3,[r0,#0x20]
000194  f0434380          ORR      r3,r3,#0x40000000
000198  6203              STR      r3,[r0,#0x20]
00019a  6e03              LDR      r3,[r0,#0x60]
00019c  f0436380          ORR      r3,r3,#0x4000000
0001a0  6603              STR      r3,[r0,#0x60]
0001a2  07cb              LSLS     r3,r1,#31
0001a4  6943              LDR      r3,[r0,#0x14]
0001a6  d008              BEQ      |L5.442|
0001a8  f0435380          ORR      r3,r3,#0x10000000
                  |L5.428|
0001ac  6143              STR      r3,[r0,#0x14]
0001ae  078b              LSLS     r3,r1,#30
0001b0  6b43              LDR      r3,[r0,#0x34]
0001b2  d405              BMI      |L5.448|
0001b4  f0234380          BIC      r3,r3,#0x40000000
0001b8  e004              B        |L5.452|
                  |L5.442|
0001ba  f0235380          BIC      r3,r3,#0x10000000
0001be  e7f5              B        |L5.428|
                  |L5.448|
0001c0  f0434380          ORR      r3,r3,#0x40000000
                  |L5.452|
0001c4  6343              STR      r3,[r0,#0x34]
0001c6  0749              LSLS     r1,r1,#29
0001c8  6f41              LDR      r1,[r0,#0x74]
0001ca  d402              BMI      |L5.466|
0001cc  f0216180          BIC      r1,r1,#0x4000000
0001d0  e001              B        |L5.470|
                  |L5.466|
0001d2  f0416180          ORR      r1,r1,#0x4000000
                  |L5.470|
0001d6  6741              STR      r1,[r0,#0x74]
                  |L5.472|
0001d8  6810              LDR      r0,[r2,#0]
0001da  f0407080          ORR      r0,r0,#0x1000000
0001de  6010              STR      r0,[r2,#0]
0001e0  e8bd81f0          POP      {r4-r8,pc}
;;;223    
                          ENDP

                  |L5.484|
                          DCD      ||area_number.24||+0x2c
                  |L5.488|
                          DCD      ||.bss||+0x840
                  |L5.492|
                          DCD      ||.bss||
                  |L5.496|
                          DCD      0x40034000
                  |L5.500|
                          DCD      0x2009c000

                          AREA ||area_number.6||, CODE, READONLY, ALIGN=2

                          EXPORTAS ||area_number.6||, ||.text||
                  zar_superviser_start PROC
;;;218    //-----------------------------------------------
;;;219    void kb_init(void)
000000  4903              LDR      r1,|L6.16|
;;;220    {
;;;221    main_kb_cnt=(TBAT*60)-60/*120*/;
000002  4a04              LDR      r2,|L6.20|
000004  2001              MOVS     r0,#1
000006  7008              STRB     r0,[r1,#0]
000008  7010              STRB     r0,[r2,#0]
00000a  7048              STRB     r0,[r1,#1]
00000c  7050              STRB     r0,[r2,#1]
00000e  4770              BX       lr
;;;222    }
;;;223    
                          ENDP

                  |L6.16|
                          DCD      sign_U
                  |L6.20|
                          DCD      sign_I

                          AREA ||area_number.7||, CODE, READONLY, ALIGN=2

                          EXPORTAS ||area_number.7||, ||.text||
                  revers_hndl PROC
;;;218    //-----------------------------------------------
;;;219    void kb_init(void)
000000  480e              LDR      r0,|L7.60|
;;;220    {
;;;221    main_kb_cnt=(TBAT*60)-60/*120*/;
000002  6801              LDR      r1,[r0,#0]
000004  f4217140          BIC      r1,r1,#0x300
000008  6001              STR      r1,[r0,#0]
00000a  480d              LDR      r0,|L7.64|
00000c  6801              LDR      r1,[r0,#0]
00000e  f0410110          ORR      r1,r1,#0x10
000012  6001              STR      r1,[r0,#0]
;;;222    }
000014  490b              LDR      r1,|L7.68|
000016  7809              LDRB     r1,[r1,#0]  ; work_stat
000018  2903              CMP      r1,#3
00001a  d003              BEQ      |L7.36|
00001c  490a              LDR      r1,|L7.72|
00001e  7809              LDRB     r1,[r1,#0]  ; REV_STAT
000020  b119              CBZ      r1,|L7.42|
000022  e007              B        |L7.52|
                  |L7.36|
000024  4909              LDR      r1,|L7.76|
000026  7809              LDRB     r1,[r1,#0]  ; bRAZR
000028  b121              CBZ      r1,|L7.52|
                  |L7.42|
00002a  6941              LDR      r1,[r0,#0x14]
00002c  f0210110          BIC      r1,r1,#0x10
                  |L7.48|
000030  6141              STR      r1,[r0,#0x14]
000032  4770              BX       lr
                  |L7.52|
000034  6941              LDR      r1,[r0,#0x14]
000036  f0410110          ORR      r1,r1,#0x10
00003a  e7f9              B        |L7.48|
;;;223    
                          ENDP

                  |L7.60|
                          DCD      0x4002c000
                  |L7.64|
                          DCD      0x2009c000
                  |L7.68|
                          DCD      work_stat
                  |L7.72|
                          DCD      REV_STAT
                  |L7.76|
                          DCD      bRAZR

                          AREA ||.bss||, DATA, NOINIT, ALIGN=2

                  adc_buff
                          %        2048
                  adc_buff_
                          %        32
                  adc_buff__
                          %        32
                  main_power_buffer
                          %        32

                          AREA ||area_number.10||, DATA, NOINIT, ALIGN=1

                          EXPORTAS ||area_number.10||, ||.bss||
                  adc_buff_max
                          %        24

                          AREA ||area_number.11||, DATA, NOINIT, ALIGN=1

                          EXPORTAS ||area_number.11||, ||.bss||
                  net_buff
                          %        64

                          AREA ||.constdata||, DATA, READONLY, ALIGN=0

                  sk_buff_KONTUR
000000  0d0b0f0e          DCB      0x0d,0x0b,0x0f,0x0e

                          AREA ||area_number.14||, DATA, READONLY, ALIGN=0

                          EXPORTAS ||area_number.14||, ||.constdata||
                  sk_buff_RSTKM
000000  0d0b0f0e          DCB      0x0d,0x0b,0x0f,0x0e

                          AREA ||area_number.15||, DATA, READONLY, ALIGN=0

                          EXPORTAS ||area_number.15||, ||.constdata||
                  sk_buff_GLONASS
000000  0b0d0f0e          DCB      0x0b,0x0d,0x0f,0x0e

                          AREA ||area_number.16||, DATA, READONLY, ALIGN=0

                          EXPORTAS ||area_number.16||, ||.constdata||
                  sk_buff_3U
000000  0b0d0f0e          DCB      0x0b,0x0d,0x0f,0x0e

                          AREA ||area_number.17||, DATA, READONLY, ALIGN=0

                          EXPORTAS ||area_number.17||, ||.constdata||
                  sk_buff_6U
000000  0b0d0f0e          DCB      0x0b,0x0d,0x0f,0x0e

                          AREA ||area_number.18||, DATA, READONLY, ALIGN=0

                          EXPORTAS ||area_number.18||, ||.constdata||
                  sk_buff_220
000000  0b0d0f0e          DCB      0x0b,0x0d,0x0f,0x0e

                          AREA ||.data||, DATA, ALIGN=1

                  adc_buff_min
000000  13881388          DCW      0x1388,0x1388
000004  13881388          DCW      0x1388,0x1388
000008  13881388          DCW      0x1388,0x1388
00000c  13881388          DCW      0x1388,0x1388
000010  13881388          DCW      0x1388,0x1388
                          DCDU     0x00000000

                          AREA ||area_number.20||, DATA, ALIGN=1

                          EXPORTAS ||area_number.20||, ||.data||
                  unet_buff_min
000000  1388              DCW      0x1388

                          AREA ||area_number.21||, DATA, ALIGN=0

                          EXPORTAS ||area_number.21||, ||.data||
                  adc_stat
000000  01                DCB      0x01

                          AREA ||area_number.22||, DATA, ALIGN=1

                          EXPORTAS ||area_number.22||, ||.data||
                  bat_ver_cnt
000000  0096              DCW      0x0096

                          AREA ||area_number.23||, DATA, ALIGN=0

                          EXPORTAS ||area_number.23||, ||.data||
                  vent_stat
000000  00                DCB      0x00

                          AREA ||area_number.24||, DATA, ALIGN=1

                          EXPORTAS ||area_number.24||, ||.data||
                  adc_self_ch_cnt
000000  00                DCB      0x00
                  adc_ch_net
000001  00                DCB      0x00
                  adc_ch
000002  00                DCB      0x00
                  adc_ch_cnt
000003  00                DCB      0x00
                  adc_window_flag
000004  00                DCB      0x00
                  sh_cnt0
000005  00                DCB      0x00
                  b1Hz_sh
000006  00                DCB      0x00
                  sh_cnt1
000007  00                DCB      0x00
                  bFAST_REG
000008  00                DCB      0x00
                  bU_VALID
000009  00                DCB      0x00
                  bU_VALID_VALID
00000a  00                DCB      0x00
                  bPRECESSION_REG
00000b  00                DCB      0x00
                  bVOLT_IS_NOT_DOWN
00000c  00                DCB      0x00
                  bVOLT_IS_NOT_UP
00000d  00                DCB      0x00
                  bVOLT_IS_NORM
00000e  0000              DCB      0x00,0x00
                  cntrl_stat_U
000010  03e8              DCW      0x03e8
                  cntrl_stat_I
000012  03e8              DCW      0x03e8
                  net_buff_
000014  0000              DCB      0x00,0x00
                  adc_result
000016  0000              DCB      0x00,0x00
                  adc_gorb_cnt
000018  0000              DCB      0x00,0x00
                  adc_zero_cnt
00001a  0000              DCB      0x00,0x00
                  adc_window_cnt
00001c  0000              DCB      0x00,0x00
                  adc_net_buff_cnt
00001e  0000              DCB      0x00,0x00
                  samokalibr_cnt
000020  0000              DCB      0x00,0x00
                  main_kb_cnt
000022  0000              DCB      0x00,0x00
                  cnt_volt_contr
000024  0000              DCB      0x00,0x00
                  cnt_rel_volt_umin
000026  0000              DCB      0x00,0x00
                  cnt_rel_volt_umax
000028  0000              DCB      0x00,0x00
                  rele_stat
00002a  0000              DCB      0x00,0x00
                  adc_self_ch_buff
                          DCDU     0x00000000
000030  0000              DCB      0x00,0x00
                  adc_self_ch_disp
000032  0000              DCB      0x00,0x00
                          DCDU     0x00000000

                          AREA ||area_number.25||, DATA, ALIGN=1

                          EXPORTAS ||area_number.25||, ||.data||
                  cntrl_stat_old
000000  0258              DCW      0x0258

                          AREA ||area_number.26||, DATA, ALIGN=1

                          EXPORTAS ||area_number.26||, ||.data||
                  unet_buff_max
000000  0000              DCB      0x00,0x00

                          AREA ||area_number.27||, DATA, ALIGN=0

                          EXPORTAS ||area_number.27||, ||.data||
                  adc_cnt
000000  00                DCB      0x00

                          AREA ||area_number.28||, DATA, ALIGN=0

                          EXPORTAS ||area_number.28||, ||.data||
                  adc_cnt1
000000  00                DCB      0x00

                          AREA ||area_number.29||, DATA, ALIGN=1

                          EXPORTAS ||area_number.29||, ||.data||
                  zero_cnt
000000  0000              DCB      0x00,0x00

                          AREA ||area_number.30||, DATA, ALIGN=0

                          EXPORTAS ||area_number.30||, ||.data||
                  net_buff_cnt
000000  00                DCB      0x00

                          AREA ||area_number.31||, DATA, ALIGN=1

                          EXPORTAS ||area_number.31||, ||.data||
                  ADWR
000000  0000              DCB      0x00,0x00

                          AREA ||area_number.32||, DATA, ALIGN=1

                          EXPORTAS ||area_number.32||, ||.data||
                  period_cnt
000000  0000              DCB      0x00,0x00

                          AREA ||area_number.33||, DATA, ALIGN=1

                          EXPORTAS ||area_number.33||, ||.data||
                  non_zero_cnt
000000  0000              DCB      0x00,0x00

                          AREA ||area_number.34||, DATA, ALIGN=0

                          EXPORTAS ||area_number.34||, ||.data||
                  bRELE_OUT
000000  00                DCB      0x00

                          AREA ||area_number.35||, DATA, ALIGN=2

                          EXPORTAS ||area_number.35||, ||.data||
                  main_power_buffer_
                          DCD      0x00000000

                          AREA ||area_number.36||, DATA, ALIGN=1

                          EXPORTAS ||area_number.36||, ||.data||
                  main_power_buffer_cnt
000000  0000              DCB      0x00,0x00

                          AREA ||area_number.37||, DATA, ALIGN=1

                          EXPORTAS ||area_number.37||, ||.data||
                  adc_buff_out_
                          DCDU     0x00000000
000004  0000              DCB      0x00,0x00

                          AREA ||area_number.38||, DATA, ALIGN=1

                          EXPORTAS ||area_number.38||, ||.data||
                  plazma_adc_cnt
000000  0000              DCB      0x00,0x00

                          AREA ||area_number.39||, DATA, ALIGN=1

                          EXPORTAS ||area_number.39||, ||.data||
                  plazma_sk
000000  0000              DCB      0x00,0x00

                          AREA ||area_number.40||, DATA, ALIGN=1

                          EXPORTAS ||area_number.40||, ||.data||
                  cntrl_stat_new
000000  0000              DCB      0x00,0x00

                          AREA ||area_number.41||, DATA, ALIGN=1

                          EXPORTAS ||area_number.41||, ||.data||
                  Ibmax
000000  0000              DCB      0x00,0x00

                          AREA ||area_number.42||, DATA, ALIGN=0

                          EXPORTAS ||area_number.42||, ||.data||
                  unh_cnt0
000000  00                DCB      0x00

                          AREA ||area_number.43||, DATA, ALIGN=0

                          EXPORTAS ||area_number.43||, ||.data||
                  unh_cnt1
000000  00                DCB      0x00

                          AREA ||area_number.44||, DATA, ALIGN=0

                          EXPORTAS ||area_number.44||, ||.data||
                  b1Hz_unh
000000  00                DCB      0x00

                          AREA ||area_number.45||, DATA, ALIGN=0

                          EXPORTAS ||area_number.45||, ||.data||
                  ch_cnt0
000000  00                DCB      0x00

                          AREA ||area_number.46||, DATA, ALIGN=0

                          EXPORTAS ||area_number.46||, ||.data||
                  b1Hz_ch
000000  00                DCB      0x00

                          AREA ||area_number.47||, DATA, ALIGN=0

                          EXPORTAS ||area_number.47||, ||.data||
                  i
000000  00                DCB      0x00

                          AREA ||area_number.48||, DATA, ALIGN=0

                          EXPORTAS ||area_number.48||, ||.data||
                  iiii
000000  00                DCB      0x00

                          AREA ||area_number.49||, DATA, ALIGN=1

                          EXPORTAS ||area_number.49||, ||.data||
                  IZMAX_
000000  0000              DCB      0x00,0x00

                          AREA ||area_number.50||, DATA, ALIGN=1

                          EXPORTAS ||area_number.50||, ||.data||
                  kb_cnt_1lev
000000  0000              DCB      0x00,0x00

                          AREA ||area_number.51||, DATA, ALIGN=1

                          EXPORTAS ||area_number.51||, ||.data||
                  kb_cnt_2lev
000000  0000              DCB      0x00,0x00

                          AREA ||area_number.52||, DATA, ALIGN=0

                          EXPORTAS ||area_number.52||, ||.data||
                  kb_full_ver
000000  00                DCB      0x00

                          AREA ||area_number.53||, DATA, ALIGN=0

                          EXPORTAS ||area_number.53||, ||.data||
                  kb_start
000000  0000              DCB      0x00,0x00

                          AREA ||area_number.54||, DATA, ALIGN=0

                          EXPORTAS ||area_number.54||, ||.data||
                  num_of_wrks_bps
000000  00                DCB      0x00

                          AREA ||area_number.55||, DATA, ALIGN=0

                          EXPORTAS ||area_number.55||, ||.data||
                  bps_all_off_cnt
000000  00                DCB      0x00

                          AREA ||area_number.56||, DATA, ALIGN=0

                          EXPORTAS ||area_number.56||, ||.data||
                  bps_mask_off_cnt
000000  00                DCB      0x00

                          AREA ||area_number.57||, DATA, ALIGN=0

                          EXPORTAS ||area_number.57||, ||.data||
                  bps_mask_on_off_cnt
000000  00                DCB      0x00

                          AREA ||area_number.58||, DATA, ALIGN=0

                          EXPORTAS ||area_number.58||, ||.data||
                  bps_hndl_2sec_cnt
000000  00                DCB      0x00

                          AREA ||area_number.59||, DATA, ALIGN=1

                          EXPORTAS ||area_number.59||, ||.data||
                  bps_on_mask
000000  0000              DCB      0x00,0x00

                          AREA ||area_number.60||, DATA, ALIGN=1

                          EXPORTAS ||area_number.60||, ||.data||
                  bps_off_mask
000000  0000              DCB      0x00,0x00

                          AREA ||area_number.61||, DATA, ALIGN=0

                          EXPORTAS ||area_number.61||, ||.data||
                  num_necc_up
000000  00                DCB      0x00

                          AREA ||area_number.62||, DATA, ALIGN=0

                          EXPORTAS ||area_number.62||, ||.data||
                  num_necc_down
000000  00                DCB      0x00

                          AREA ||area_number.63||, DATA, ALIGN=0

                          EXPORTAS ||area_number.63||, ||.data||
                  spc_stat
000000  00                DCB      0x00

                          AREA ||area_number.64||, DATA, ALIGN=0

                          EXPORTAS ||area_number.64||, ||.data||
                  spc_bat
000000  00                DCB      0x00

                          AREA ||area_number.65||, DATA, ALIGN=0

                          EXPORTAS ||area_number.65||, ||.data||
                  spc_phase
000000  00                DCB      0x00

                          AREA ||area_number.66||, DATA, ALIGN=1

                          EXPORTAS ||area_number.66||, ||.data||
                  vz_cnt_s
000000  0000              DCB      0x00,0x00

                          AREA ||area_number.67||, DATA, ALIGN=1

                          EXPORTAS ||area_number.67||, ||.data||
                  vz_cnt_s_
000000  0000              DCB      0x00,0x00

                          AREA ||area_number.68||, DATA, ALIGN=1

                          EXPORTAS ||area_number.68||, ||.data||
                  vz_cnt_h
000000  0000              DCB      0x00,0x00

                          AREA ||area_number.69||, DATA, ALIGN=1

                          EXPORTAS ||area_number.69||, ||.data||
                  vz_cnt_h_
000000  0000              DCB      0x00,0x00

                          AREA ||area_number.70||, DATA, ALIGN=0

                          EXPORTAS ||area_number.70||, ||.data||
                  bAVZ
000000  00                DCB      0x00

                          AREA ||area_number.71||, DATA, ALIGN=0

                          EXPORTAS ||area_number.71||, ||.data||
                  ke_start_stat
000000  00                DCB      0x00

                          AREA ||area_number.72||, DATA, ALIGN=1

                          EXPORTAS ||area_number.72||, ||.data||
                  cnt_end_ke
000000  0000              DCB      0x00,0x00

                          AREA ||area_number.73||, DATA, ALIGN=2

                          EXPORTAS ||area_number.73||, ||.data||
                  ke_date
                          %        8

                          AREA ||area_number.74||, DATA, ALIGN=1

                          EXPORTAS ||area_number.74||, ||.data||
                  __ee_vz_cnt
000000  0000              DCB      0x00,0x00

                          AREA ||area_number.75||, DATA, ALIGN=1

                          EXPORTAS ||area_number.75||, ||.data||
                  __ee_spc_stat
000000  0000              DCB      0x00,0x00

                          AREA ||area_number.76||, DATA, ALIGN=1

                          EXPORTAS ||area_number.76||, ||.data||
                  __ee_spc_bat
000000  0000              DCB      0x00,0x00

                          AREA ||area_number.77||, DATA, ALIGN=1

                          EXPORTAS ||area_number.77||, ||.data||
                  __ee_spc_phase
000000  0000              DCB      0x00,0x00

                          AREA ||area_number.78||, DATA, ALIGN=1

                          EXPORTAS ||area_number.78||, ||.data||
                  cntrl_stat_blok_cnt
000000  0000              DCB      0x00,0x00

                          AREA ||area_number.79||, DATA, ALIGN=1

                          EXPORTAS ||area_number.79||, ||.data||
                  cntrl_stat_blok_cnt_
000000  0000              DCB      0x00,0x00

                          AREA ||area_number.80||, DATA, ALIGN=1

                          EXPORTAS ||area_number.80||, ||.data||
                  cntrl_stat_blok_cnt_plus
                          DCDU     0x00000000

                          AREA ||area_number.81||, DATA, ALIGN=1

                          EXPORTAS ||area_number.81||, ||.data||
                  cntrl_stat_blok_cnt_minus
                          DCDU     0x00000000

                          AREA ||area_number.82||, DATA, ALIGN=0

                          EXPORTAS ||area_number.82||, ||.data||
                  plazma_inv
                          DCDU     0x00000000

                          AREA ||area_number.83||, DATA, ALIGN=0

                          EXPORTAS ||area_number.83||, ||.data||
                  plazma_bat
000000  00                DCB      0x00
